{"pages":[{"title":"å…³ äº","text":"Live in DaLian","link":"/about/index.html"},{"title":"æ ‡ ç­¾","text":"","link":"/tags/index.html"},{"title":"åˆ† ç±»","text":"","link":"/categories/index.html"}],"posts":[{"title":"è¦äº†å‘½çš„ç‰ˆæœ¬Druid/Mybatis/MybatisPlus","text":"é—®é¢˜ç°è±¡Druidæ˜¯alibabaçš„ä¸€æ¬¾å¼€æºæ•°æ®åº“è¿æ¥æ± ã€‚è¢«ç§°ä¸ºæ˜¯ä¸“é—¨ä¸ºç›‘æ§è€Œç”Ÿçš„æ•°æ®åº“è¿æ¥æ± é…ç½®ï¼Œä»–å¯ä»¥ç›‘æ§sqlçš„æ‰§è¡Œæƒ…å†µï¼Œä»¥åŠæ€§èƒ½ï¼Œç„¶åæ ¹æ®ç»“æœæ¥ä¼˜åŒ–sqlæˆ–è€…åšæ€§èƒ½è°ƒä¼˜ã€‚ ä¹‹å‰è‡ªå·±å†™é¡¹ç›®æ—¶å€™æ²¡æœ‰ç”¨åˆ°Druidçš„ç›‘æ§åŠŸèƒ½ã€‚æ˜¨å¤©è¯•äº†è¯•ç›‘æ§åŠŸèƒ½å°±å‡ºç°äº†å¦‚ä¸‹é”™è¯¯ï¼šjava.sql.SQLFeatureNotSupportedException,ä¸»è¦æ˜¯ä½¿ç”¨äº†LocalDateTimeç±»å‹å¯¹åº”äº†æ•°æ®åº“çš„timestampç±»å‹å­—æ®µå¼•å‘çš„é—®é¢˜ï¼Œjava8æ–°çš„æ—¶é—´ç±»éƒ½ä¼šå¼•å‘å¦‚ä¸‹é—®é¢˜ã€‚ å½“å‰ä½¿ç”¨ç‰ˆæœ¬çš„æ˜¯Mybatis-Plus 3.1.2å’Œdruid 1.1.20ã€‚ åœ¨Mybatis-Plusçš„3.1.1åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œå¼•ç”¨çš„mybatisç‰ˆæœ¬ä¸º3.5.1ã€‚ åœ¨æ²¡æœ‰å¯åŠ¨Druidçš„ç›‘æ§æ¨¡å—æ—¶å€™druid 1.1.19åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒmybatis 3.5.1ï¼Œjava8æ–°çš„æ—¶é—´ç±»å‹å¯¹åº”æ•°æ®åº“æ—¶é—´ç±»å‹éƒ½æ­£å¸¸ã€‚ åŸå› å› ä¸ºmybatis 3.5.1ç‰ˆæœ¬å¯¹äºjava.timeåŒ…ä¸‹LocalDateTime,LocalDate,LocalTimeç±»å‹çš„è½¬æ¢äº¤ç”±äº†JDBCï¼Œè‹¥JDBCç»„ä»¶ä¸æ”¯æŒå¯¹äºLocalDateTimeç±»å‹çš„å¤„ç†åˆ™ä¼šæŠ¥é”™ã€‚Druidæ•°æ®åº“è¿æ¥æ± ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å°šä¸æ”¯æŒå¯¹äºLocalDateTimeçš„å¤„ç†ï¼Œä¼šthrow SQLFeatureNotSupportedExceptionï¼Œæè¯·æ³¨æ„ã€‚ è§£å†³æ–¹å¼é™ä½mybatisç‰ˆæœ¬Mybatis-Plusä½¿ç”¨3.1.0åŠä»¥ä¸‹ç‰ˆæœ¬12345&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt;&lt;/dependency&gt; Mybatisä½¿ç”¨mybatis 3.5.0åŠä»¥ä¸‹ç‰ˆæœ¬ mybatis-spring-boot-starter 12345&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt;&lt;/dependency&gt; mybatis 12345&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.0&lt;/version&gt;&lt;/dependency&gt; æ›´æ¢è¿æ¥æ± æ›´æ¢ä¸º hicaricp 3.3.1ï¼Œå¹¶å°†jdbcæ¢ä¸ºæœ€æ–°çš„ é™„å½•Druidé…ç½®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879spring: datasource: druid: url: jdbc:mysql://localhost:3306/videomall?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai username: root password: root driver-class-name: com.mysql.cj.jdbc.Driver # åˆå§‹åŒ–æ—¶å»ºç«‹ç‰©ç†è¿æ¥çš„ä¸ªæ•°ã€‚åˆå§‹åŒ–å‘ç”Ÿåœ¨æ˜¾ç¤ºè°ƒç”¨initæ–¹æ³•ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡getConnectionæ—¶ï¼Œé»˜è®¤0 initial-size: 3 # æœ€å¤§è¿æ¥æ± æ•°é‡ï¼Œé»˜è®¤8 max-active: 5 # æœ€å°è¿æ¥æ± æ•°é‡ min-idle: 1 # è·å–è¿æ¥æ—¶æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚é…ç½®äº†maxWaitä¹‹åï¼Œç¼ºçœå¯ç”¨å…¬å¹³é”ï¼Œå¹¶å‘æ•ˆç‡ä¼šæœ‰æ‰€ä¸‹é™ # å¦‚æœéœ€è¦å¯ä»¥é€šè¿‡é…ç½®useUnfairLockå±æ€§ä¸ºtrueä½¿ç”¨éå…¬å¹³é” max-wait: 30000 # æ˜¯å¦ç¼“å­˜preparedStatementï¼Œä¹Ÿå°±æ˜¯PSCache # PSCacheå¯¹æ”¯æŒæ¸¸æ ‡çš„æ•°æ®åº“æ€§èƒ½æå‡å·¨å¤§ï¼Œæ¯”å¦‚è¯´oracleã€‚åœ¨mysqlä¸‹å»ºè®®å…³é—­ã€‚é»˜è®¤false pool-prepared-statements: false # è¦å¯ç”¨PSCacheï¼Œå¿…é¡»é…ç½®å¤§äº0ï¼Œå½“å¤§äº0æ—¶ï¼ŒpoolPreparedStatementsè‡ªåŠ¨è§¦å‘ä¿®æ”¹ä¸ºtrue # åœ¨Druidä¸­ï¼Œä¸ä¼šå­˜åœ¨Oracleä¸‹PSCacheå ç”¨å†…å­˜è¿‡å¤šçš„é—®é¢˜ï¼Œå¯ä»¥æŠŠè¿™ä¸ªæ•°å€¼é…ç½®å¤§ä¸€äº›ï¼Œæ¯”å¦‚è¯´100ï¼Œé»˜è®¤-1 max-pool-prepared-statement-per-connection-size: 100 # ç”¨æ¥æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„sqlï¼Œè¦æ±‚æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå¸¸ç”¨select 'x' # å¦‚æœvalidationQueryä¸ºnullï¼ŒtestOnBorrowã€testOnReturnã€testWhileIdleéƒ½ä¸ä¼šèµ·ä½œç”¨ validation-query: SELECT 1 # å•ä½ï¼šç§’ï¼Œæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„è¶…æ—¶æ—¶é—´ã€‚åº•å±‚è°ƒç”¨jdbc Statementå¯¹è±¡çš„void setQueryTimeout(int seconds)æ–¹æ³• validation-query-timeout: 30000 # ç”³è¯·è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ï¼Œé»˜è®¤true test-on-borrow: true # å½’è¿˜è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ï¼Œé»˜è®¤false test-on-return: true # ç”³è¯·è¿æ¥çš„æ—¶å€™æ£€æµ‹ï¼Œå¦‚æœç©ºé—²æ—¶é—´å¤§äºtimeBetweenEvictionRunsMillisï¼Œæ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆ # å»ºè®®é…ç½®ä¸ºtrueï¼Œä¸å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”ä¿è¯å®‰å…¨æ€§ï¼Œé»˜è®¤false test-while-idle: true # è¿æ¥æ± ä¸­çš„minIdleæ•°é‡ä»¥å†…çš„è¿æ¥ï¼Œç©ºé—²æ—¶é—´è¶…è¿‡minEvictableIdleTimeMillisï¼Œåˆ™ä¼šæ‰§è¡ŒkeepAliveæ“ä½œï¼Œé»˜è®¤false keep-alive: true # æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š # 1) Destroyçº¿ç¨‹ä¼šæ£€æµ‹è¿æ¥çš„é—´éš”æ—¶é—´ï¼Œå¦‚æœè¿æ¥ç©ºé—²æ—¶é—´å¤§äºç­‰äºminEvictableIdleTimeMillisåˆ™å…³é—­ç‰©ç†è¿æ¥ # 2) testWhileIdleçš„åˆ¤æ–­ä¾æ®ï¼Œè¯¦ç»†çœ‹testWhileIdleå±æ€§çš„è¯´æ˜ # é»˜è®¤1åˆ†é’Ÿ time-between-eviction-runs-millis: 60000 # è¿æ¥ä¿æŒç©ºé—²è€Œä¸è¢«é©±é€çš„æœ€å°æ—¶é—´ min-evictable-idle-time-millis: 300000 filters: stat,wall filter: stat: log-slow-sql: true slow-sql-millis: 2000 # WebStatFilteré…ç½®ï¼Œè¯´æ˜è¯·å‚è€ƒDruid Wikiï¼Œé…ç½®_é…ç½®WebStatFilter web-stat-filter: # 1.1.10ä»¥åçš„ç‰ˆæœ¬éœ€è¦æŒ‡å®šä¸ºtrue ä¸ç„¶é»˜è®¤æ˜¯å…³é—­çš„å°±ä¼šå‡ºç°404 enabled: true # æ·»åŠ è¿‡æ»¤è§„åˆ™ url-pattern: /* # å¿½ç•¥è¿‡æ»¤æ ¼å¼ exclusions: \"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*\" # StatViewServleté…ç½® stat-view-servlet: #å±•ç¤ºDruidçš„ç»Ÿè®¡ä¿¡æ¯,StatViewServletçš„ç”¨é€”åŒ…æ‹¬ï¼š1.æä¾›ç›‘æ§ä¿¡æ¯å±•ç¤ºçš„htmlé¡µé¢2.æä¾›ç›‘æ§ä¿¡æ¯çš„JSON API #æ˜¯å¦å¯ç”¨StatViewServleté»˜è®¤å€¼true enabled: true #æ ¹æ®é…ç½®ä¸­çš„url-patternæ¥è®¿é—®å†…ç½®ç›‘æ§é¡µé¢ï¼Œå¦‚æœæ˜¯ä¸Šé¢çš„é…ç½®ï¼Œå†…ç½®ç›‘æ§é¡µé¢çš„é¦–é¡µæ˜¯/druid/index.htmlä¾‹å¦‚ï¼š #http://110.76.43.235:9000/druid/index.html #http://110.76.43.235:8080/mini-web/druid/index.html url-pattern: /druid/* #æ˜¯å¦å…è®¸æ¸…ç©ºç»Ÿè®¡æ•°æ® reset-enable: false login-username: admin login-password: admin #StatViewSerlvetå±•ç¤ºå‡ºæ¥çš„ç›‘æ§ä¿¡æ¯æ¯”è¾ƒæ•æ„Ÿï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œçš„å†…éƒ¨æƒ…å†µï¼Œå¦‚æœä½ éœ€è¦åšè®¿é—®æ§åˆ¶ï¼Œå¯ä»¥é…ç½®allowå’Œdenyè¿™ä¸¤ä¸ªå‚æ•° #denyä¼˜å…ˆäºallowï¼Œå¦‚æœåœ¨denyåˆ—è¡¨ä¸­ï¼Œå°±ç®—åœ¨allowåˆ—è¡¨ä¸­ï¼Œä¹Ÿä¼šè¢«æ‹’ç»ã€‚å¦‚æœallowæ²¡æœ‰é…ç½®æˆ–è€…ä¸ºç©ºï¼Œåˆ™å…è®¸æ‰€æœ‰è®¿é—® #é…ç½®çš„æ ¼å¼ #&lt;IP&gt; #æˆ–è€…&lt;IP&gt;/&lt;SUB_NET_MASK_size&gt;å…¶ä¸­128.242.127.1/24 #24è¡¨ç¤ºï¼Œå‰é¢24ä½æ˜¯å­ç½‘æ©ç ï¼Œæ¯”å¯¹çš„æ—¶å€™ï¼Œå‰é¢24ä½ç›¸åŒå°±åŒ¹é…,ä¸æ”¯æŒIPV6ã€‚ allow: deny: 128.242.127.1/24,128.242.128.1 # Springç›‘æ§AOPåˆ‡å…¥ç‚¹ï¼Œå¦‚x.y.z.service.*,é…ç½®å¤šä¸ªè‹±æ–‡é€—å·åˆ†éš” aop-patterns:","link":"/2019/09/11/DruidMybatisMybatisPlusVersion/"},{"title":"Docker åŸºç¡€","text":"å·¥ä½œå¿™äº†å°åŠå¹´ï¼Œç»ˆäºæœ‰æ—¶é—´å¼€å§‹æ›´æ–°äº†ï¼ï¼ï¼ï¼ ä¸ºä»€ä¹ˆä½¿ç”¨Dockerï¼šå¼€ç®±å³ç”¨ï¼Œå¿«é€Ÿéƒ¨ç½²ï¼Œå¯ç§»æ¤æ€§å¼ºï¼Œç¯å¢ƒéš”ç¦»æœ¬æ–‡ä¸»è¦ä»‹ç»Dockerçš„åŸºç¡€æ“ä½œ DockerfileåŸºç¡€ FROM åŸºäºå“ªä¸ªé•œåƒ MAINTAINER æ³¨æ˜ä½œè€… COPY ç®€å•å¤åˆ¶ï¼Œä¸ä¼šè§£å‹å¤åˆ¶çš„å‹ç¼©æ–‡ä»¶ ADD å¤åˆ¶ï¼Œä¼šè§£å‹è¦å¤åˆ¶çš„å‹ç¼©æ–‡ä»¶ ADD å¯ä»¥å¤åˆ¶å¹¶æ‰§è¡Œè¯­å¥ï¼Œä¾‹å¦‚ï¼šADD init.sql . WORKDIR å·¥ä½œè·¯å¾„ï¼ˆè¿›å…¥å®¹å™¨é»˜è®¤æ–‡ä»¶å¤¹ï¼‰ï¼Œä¸å­˜åœ¨ä¼šç›´æ¥æ–°å»º ENV è®¾ç½®ç¯å¢ƒå˜é‡ EXPOSE æš´éœ²å®¹å™¨ç«¯å£ RUN åœ¨æ„å»ºé•œåƒçš„æ—¶å€™æ‰§è¡Œï¼Œä½œç”¨äºé•œåƒå±‚é¢ ENTRYPOINT åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œï¼Œä½œç”¨äºå®¹å™¨å±‚ï¼Œdockerfileé‡Œæœ‰å¤šæ¡æ—¶åªå…è®¸æ‰§è¡Œæœ€åä¸€æ¡ CMD åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œï¼Œä½œç”¨äºå®¹å™¨å±‚ï¼Œdockerfileé‡Œæœ‰å¤šæ¡æ—¶åªå…è®¸æ‰§è¡Œæœ€åä¸€æ¡ å®¹å™¨å¯åŠ¨åæ‰§è¡Œé»˜è®¤çš„å‘½ä»¤æˆ–è€…å‚æ•°ï¼Œå…è®¸è¢«ä¿®æ”¹ å‘½ä»¤æ ¼å¼: shellå‘½ä»¤æ ¼å¼:RUN yum install -y net-tools execå‘½ä»¤æ ¼å¼:RUN [ â€œyumâ€,â€installâ€ ,â€-yâ€ ,â€net-toolsâ€] RUNä½œç”¨äºé•œåƒå±‚ï¼Œåœ¨æ„å»ºimageæ—¶å€™æ‰§è¡Œã€‚ CMDï¼ŒENTRYPOINTä½œç”¨äºå®¹å™¨å±‚ï¼Œåˆ›å»ºå®¹å™¨æ‰ä¼šæ‰§è¡Œã€‚ ä¾‹å­ï¼šè§£é‡Šcmd / entrypoint dockerfile æ— ä¼ å…¥å‚æ•° æœ‰ä¼ å…¥å‚æ•° å½“CMDæœ‰å‚æ•°ï¼Œå½“å¯åŠ¨å®¹å™¨æ—¶ä¼šå°†CMDå…¨éƒ¨å†…å®¹å½“æˆENTRYPOINTçš„å‚æ•°æ‰§è¡Œï¼Œå¦‚æœæƒ³è¦†ç›–entrypointï¼Œåœ¨docker runåå¸¦--entrypointå³å¯ï¼Œå½“entrypointåœ¨shellæ¨¡å¼ä¸‹ï¼Œcmdä»»ä½•å‚æ•°å†…å®¹éƒ½ä¸ä¼šä¼ å…¥åˆ°entrypointä¸­ã€‚ ä¸€èˆ¬è¯¥æ€ä¹ˆä½¿ç”¨ï¼šä¸€èˆ¬è¿˜æ˜¯ä¼šç”¨entrypointçš„ä¸­æ‹¬å·å½¢å¼ä½œä¸ºdockerå®¹å™¨å¯åŠ¨ä»¥åçš„é»˜è®¤æ‰§è¡Œå‘½ä»¤ï¼Œé‡Œé¢æ”¾çš„æ˜¯ä¸å˜çš„éƒ¨åˆ†ï¼Œå¯å˜éƒ¨åˆ†æ¯”å¦‚å‘½ä»¤å‚æ•°å¯ä»¥ä½¿ç”¨cmdçš„å½¢å¼æä¾›é»˜è®¤ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯runé‡Œé¢æ²¡æœ‰ä»»ä½•å‚æ•°æ—¶ä½¿ç”¨çš„é»˜è®¤å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬æƒ³ç”¨é»˜è®¤å‚æ•°ï¼Œå°±ç›´æ¥runï¼Œå¦åˆ™æƒ³ç”¨å…¶ä»–å‚æ•°ï¼Œå°±run é‡Œé¢åŠ å‚æ•°ã€‚ Docker ç½‘ç»œæ¨¡å¼Dockerçš„ç½‘ç»œæ¨¡å¼æºè‡ªCNMï¼ˆå®¹å™¨ç½‘ç»œæ¨¡å‹ï¼‰æ–¹æ¡ˆï¼ŒCNMæ˜¯å¼€æºä¸”æ”¯æŒæ’æ¥å¼è¿æ¥ã€‚ CNMä¸DockerCNMå®šä¹‰äº†3ä¸ªåŸºæœ¬è¦ç´ ï¼š æ²™ç›’ ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œæ ˆã€‚åŒ…æ‹¬ä»¥å¤ªç½‘æ¥å£ï¼Œç«¯å£ï¼Œè·¯ç”±è¡¨ä»¥åŠDNSé…ç½®ã€‚ ç»ˆç«¯ è™šæ‹Ÿç½‘æ¥å£ã€‚å°±åƒæ™®é€šç½‘ç»œæ¥å£ä¸€æ ·ï¼Œç»ˆç«¯ä¸»è¦èŒè´£æ˜¯è´Ÿè´£åˆ›å»ºè¿æ¥ï¼Œåœ¨CNMä¸­ï¼Œç»ˆç«¯è´Ÿè´£å°†æ²™ç›’è¿æ¥åˆ°ç½‘ç»œã€‚ ç½‘ç»œ æ˜¯801.1dç½‘æ¡¥ï¼ˆç±»ä¼¼äº¤æ¢æœºï¼‰çš„è½¯ä»¶å®ç°ã€‚å› æ­¤ç½‘ç»œå°±æ˜¯éœ€è¦äº¤æ¢çš„ç»ˆç«¯çš„é›†åˆï¼Œå¹¶ä¸”ç»ˆç«¯ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚ å¦‚æœä¸€ä¸ªå®¹å™¨è¦ä¸å¦ä¸€ä¸ªå®¹å™¨è¿æ¥éœ€è¦ï¼Œåˆ™è¦è®²ä¸¤ä¸ªå®¹å™¨è¿æ¥åˆ°ç›¸åŒçš„ç½‘æ¡¥ã€‚å½“ä¸¤ä¸ªå®¹å™¨è¿æ¥åˆ°ç›¸åŒçš„ç½‘æ¡¥æ—¶å€™ï¼Œå¯ä»¥ç”¨å¯¹æ–¹å®¹å™¨çš„åå­—ç›´æ¥pingé€šï¼Œå› ä¸ºå®¹å™¨éƒ½æ³¨å†Œåˆ°äº†æŒ‡å®šçš„Docker DNSæœåŠ¡ï¼Œæ‰€ä»¥ç›¸åŒç½‘ç»œçš„å®¹å™¨å¯ä»¥è§£æå…¶ä»–å®¹å™¨çš„åç§°ã€‚ä½†æ˜¯Linuxé»˜è®¤çš„Bridgeç½‘ç»œæ˜¯ä¸æ”¯æŒé€šè¿‡Docker DNSæœåŠ¡è¿›è¡ŒåŸŸåè§£æçš„ï¼Œè‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œå¯ä»¥ï¼ é»˜è®¤ç½‘ç»œæ¨¡å¼ bridge:æ¡¥æ¥æ¨¡å¼ host:ä¸»æœºæ¨¡å¼ none:æ— ç½‘ç»œæ¨¡å¼ æŸ¥çœ‹ç½‘ç»œæ¨¡å¼å‘½ä»¤docker network ls æ¡¥æ¥æ¨¡å¼Bridgeï¼ˆWinå«Natï¼‰Bridgeæ¨¡å¼æ˜¯Dockeré»˜è®¤çš„ç½‘ç»œè®¾ç½®ï¼Œå½“DockeræœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸ºdocker0çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªå’Œå®¿ä¸»æœºä¸åŒçš„IPåœ°å€å’Œå­ç½‘åˆ†é…ç»™docker 0ç½‘æ¡¥ã€‚ æŸ¥çœ‹æ¡¥æ¥æƒ…å†µï¼š 12yum install -y net-tools &amp;&amp; yum install -y bridge-utilsbtctl show ä¸»æœºæ¨¡å¼Hostè¯¥æ¨¡å¼ä¸‹ï¼Œå®¹å™¨ä¸ä¼šæœ‰è‡ªå·±çš„Ipåœ°å€ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPåœ°å€å’Œç«¯å£ã€‚æŸ¥çœ‹å®¿ä¸»æœºç«¯å£å ç”¨æƒ…å†µï¼š 12yum install -y net-tools &amp;&amp; yum install -y bridge-utilsnetstat -tunlp|grep &lt;port&gt; æ— ç½‘ç»œæ¨¡å¼Noneæ— æ³•è¿æ¥å¤–ç½‘ å®¹å™¨ä¹‹é—´çš„å•å‘åŒå‘è¿æ¥ å•å‘è¿æ¥ åœ¨å®¹å™¨å¯ä¸œå‘½ä»¤æ·»åŠ --link &lt;container name&gt; åŒå‘è¿æ¥ éœ€è¦åŒå‘è¿æ¥çš„å®¹å™¨æ·»åŠ åˆ°è‡ªå®šä¹‰çš„ç½‘æ¡¥ä¸Šå³å¯ã€‚ åˆ›å»ºç½‘æ¡¥æ–¹å¼docker network create -d bridge &lt;bridge name&gt; Docker-ComposeDocker-Composeçš„å‰èº«æ˜¯Figï¼ŒçŸ¥é“Dockeræ”¶è´­äº†Orchardå…¬å¸åï¼Œå°†Figæ›´åä¸ºDocker-Composeã€‚å‘½ä»¤è¡Œå·¥å…·ä¹Ÿä»figæ›´ä¸ºdocker-composeï¼Œå¹¶è‡ªæ­¤æˆä¸ºäº†ç»‘å®šåœ¨Dockerå¼•æ“ä¹‹ä¸Šçš„å¤–éƒ¨å·¥å…·ã€‚å†…éƒ¨å®ç°ä¸Šï¼ŒFigä¼šè§£æYAMLæ–‡ä»¶ï¼Œå¹¶é€šè¿‡Docker APIè¿›è¡Œåº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†ã€‚ å®‰è£…123yum install -y epel-release &amp;&amp; yum install -y python-pippip install -i https://pypi.tuna.tsinghua.edu.cn/simple docker-compose==1.24.1docker-compose version ç®€å•çš„docker-compose.ymlæ–‡ä»¶12345678910111213141516171819202122version: \"3\"services: web-fe: build: . command: python app.py ports: - target: 5000 published: 8080 networks: - counter-net volumes: - type: volume source: counter-vol target: /code redis: image: \"redis:5.0.5\" networks: counter-net:networks: counter-net:volumes: counter-vol: docker-compose.yml è§£æåŒ…å«å››ä¸ªä¸€çº§keyï¼šversionï¼Œservicesï¼Œnetworksï¼Œvolumes versionversionæ˜¯å¿…é¡»æŒ‡å®šçš„ï¼Œæ€»æ˜¯ä½äºæ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œå®šä¹‰äº†Composeæ–‡ä»¶æ ¼å¼ï¼ˆä¸»è¦æ˜¯APIï¼‰çš„ç‰ˆæœ¬ï¼Œè€Œéå®šä¹‰äº†Docker Composeæˆ–Dockerå¼•æ“çš„ç‰ˆæœ¬å·ï¼Œ==å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬==ã€‚ servicesåœ¨serviceé‡Œ/å®šä¹‰äº†ä¸¤ä¸ªæœåŠ¡ï¼šweb-feï¼Œredisã€‚ build:æŒ‡å®šDockeråŸºäºå½“å‰ç›®å½•ä¸‹çš„Dockerfileåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚ command:æŒ‡å®šåœ¨Dockerå®¹å™¨ä¸­æ‰§è¡Œapp.pyè„šæœ¬ï¼Œæ‰€ä»¥å®¹å™¨å†…å¿…é¡»æœ‰app.pyæ–‡ä»¶ï¼Œè¿™ä¸€ç‚¹åœ¨Dockerfileè¿›è¡Œè®¾ç½®ã€‚æ­¤commandæŒ‡ä»¤å¯ä»¥è¦†ç›–Dockerfileä¸­æŒ‡å®šçš„CMDæŒ‡ä»¤ã€‚ ports:è®²å®¹å™¨å†…5000ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº8080ç«¯å£ã€‚ networks:é“¾æ¥åˆ°å·²å­˜åœ¨çš„Dockerç½‘ç»œä¸­ï¼Œæˆ–è€…åœ¨networksä¸­å®šä¹‰çš„keyå€¼åå­—çš„ç½‘ç»œã€‚ volumes:å°†counter-volå·æŒ‚è½½åˆ°å®¹å™¨å†…/codeä¸Šï¼ŒåŒæ ·counter-volå¯ä»¥ä½¿å­˜åœ¨çš„æˆ–è€…æ˜¯CIAé¢volumesä¸­å®šä¹‰çš„ã€‚ images:ä½¿ç”¨è¯¥å€¼å¾—é•œåƒæ„å»ºï¼Œæœ¬åœ°æ²¡æœ‰ä¼šä»DockerHubè¿›è¡Œä¸‹è½½ã€‚ networksã€volumeså®šä¹‰æ–°çš„ç½‘ç»œæˆ–è€…å·ï¼Œç½‘ç»œé»˜è®¤æ˜¯Bridgeæ¨¡å¼ï¼Œå½“ç½‘ç»œæ¨¡å¼ä¸ºOverlayæ¨¡å¼æ—¶ï¼Œå…è®¸ç‹¬ç«‹çš„å®¹å™¨è¿æ¥ï¼ˆattachableï¼‰åˆ°è¯¥ç½‘ç»œ 1234networks: over-net: driver: over-lay attachable: true éƒ¨ç½²åº”ç”¨è¿›å…¥åˆ°docker-compose.ymlå’ŒDockerfileçš„æ–‡ä»¶å¤¹ã€‚ å¯åŠ¨åˆ›å»º æ­£å¸¸å¯åŠ¨docker-compose up æŒ‡å®šæ–‡ä»¶å¯åŠ¨docker-compose -f docker.yml up åå°å¯åŠ¨docker-compose -d up åˆ›å»ºçš„é•œåƒä½¿ç”¨é¡¹ç›®å+èµ„æºåç§°ä½œä¸ºæ–°çš„é•œåƒåç§°ï¼Œåˆ›å»ºçš„ç½‘ç»œå’Œå·åŒæ ·ä¼šä½¿ç”¨é¡¹ç›®åä½œä¸ºå‰ç¼€ã€‚ åœæ­¢/ç»ˆæ­¢ ç»ˆæ­¢docker-compose downï¼Œä¸ä¼šåˆ é™¤å¯åŠ¨æ—¶åˆ›å»ºæˆ–æ‹‰å–çš„é•œåƒï¼Œåˆ›å»ºçš„å·ï¼ˆå› ä¸ºæ•°æ®çš„é•¿æœŸæŒä¹…åŒ–ï¼‰ åœæ­¢dokcer-compose stop å…¶ä»–å‘½ä»¤ åˆ—å‡ºå„ä¸ªå®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹docker-compose top é‡å¯docker-compose restart åˆ—å‡ºComposeåº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨docker-compose ps å…¶ä»–ä¾‹å­1234567891011121314151617181920212223242526272829303132version: \"3\"services: db: # docker run -itd mysql:5.7 image: mysql:5.7 volumes: # é‡‡ç”¨çš„æ˜¯å·æ ‡çš„å½¢å¼æŒ‚è½½(æ³¨æ„:- db_dataæ˜¯å‚æ•°ï¼Œå¯ä»¥å˜ï¼Œè‡ªå®šä¹‰ï¼Œå¿…é¡»ä¸ä¸‹é¢å¯¹åº”) - db_data:/var/lib/mysql # è‡ªåŠ¨é‡å¯ï¼Œä¿è¯æœåŠ¡åœ¨çº¿ restart: always # æŒ‡å®šç¯å¢ƒå˜é‡ docker -itd -e environment: MYSQL_ROOT_PASSWORD: somewordpress MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress wordpress: depends_on: # - db æ˜¯å‚æ•°ï¼Œåˆèµ·æ¥çš„æ„æ€æ˜¯åªæœ‰å½“ä¸Šé¢çš„mysqlæ•°æ®åº“å®‰è£…æˆåŠŸåï¼Œè¿™ä¸ªwordpressæ‰å¯ä»¥è¢«å®‰è£…ï¼Œ # è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯docker --link å°†ä¸Šé¢çš„mysqlæ•°æ®åº“ï¼Œä¸è¿™ä¸ªwordpressåº”ç”¨è¿èµ·æ¥ - db image: wordpress:latest ports: - \"8000:80\" restart: always environment: WORDPRESS_DB_HOST: db:3306 WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress WORDPRESS_DB_NAME: wordpress volumes: db_data: {} è½½å…¥/å¯¼å‡ºé•œåƒ/å®¹å™¨é•œåƒ å¯¼å‡º 12docker save cd3ed0dfff7e -o /home/mysql.tardocker save mysql:5.7 &gt; /home/mysql.tar è½½å…¥ 1docker load -i mysql.tar å®¹å™¨ å¯¼å‡º 1docker export 974b919e1fdd -o /home/mysql-export.tar è½½å…¥ 1docker import mysql-export.tar dockerå®¹å™¨å¯¼å…¥ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒçš„é•œåƒIDè·Ÿç”Ÿæˆæ‰“åŒ…å®¹å™¨çš„é•œåƒIDä¸åŒ å…¶ä»–å¸¸ç”¨å‘½ä»¤/æ“ä½œé•œåƒ æŸ¥çœ‹æœ¬åœ°é•œåƒ:docker images æœç´¢é•œåƒ:docker search centos æœç´¢é•œåƒå¹¶è¿‡æ»¤æ˜¯å®˜æ–¹çš„: docker search --filter &quot;is-official=true&quot; centos æœç´¢é•œåƒå¹¶è¿‡æ»¤å¤§äºå¤šå°‘é¢—æ˜Ÿæ˜Ÿçš„:docker search --filter stars=10 centos ä¸‹è½½centos7é•œåƒ:docker pull centos:7 ä¿®æ”¹æœ¬åœ°é•œåƒåå­—(å°å†™):docker tag centos:7 mycentos:1 æœ¬åœ°é•œåƒçš„åˆ é™¤:docker rmi centos:7 å®¹å™¨ æ„å»ºå®¹å™¨:docker run -itd --name=mycentos centos:7 -i :è¡¨ç¤ºä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨(è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€) -d:è¡¨ç¤ºåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID -t:ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ â€“name:ä¸ºå®¹å™¨æŒ‡å®šåç§° æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰çš„å®¹å™¨:docker ps -a æŸ¥çœ‹æœ¬åœ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨:docker ps åœæ­¢å®¹å™¨:docker stop CONTAINER_ID / CONTAINER_NAME ä¸€æ¬¡æ€§åœæ­¢æ‰€æœ‰å®¹å™¨:docker stop $(docker ps -a -q) å¯åŠ¨å®¹å™¨:docker start CONTAINER_ID / CONTAINER_NAME é‡å¯å®¹å™¨:docker restart CONTAINER_ID / CONTAINER_NAME åˆ é™¤å®¹å™¨:docker rm CONTAINER_ID / CONTAINER_NAME å¼ºåˆ¶åˆ é™¤å®¹å™¨:docker rmi -f CONTAINER_ID / CONTAINER_NAME æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯:docker inspect CONTAINER_ID / CONTAINER_NAME è¿›å…¥å®¹å™¨:docker exec -it 0ad5d7b2c3a4 /bin/bash æ–‡ä»¶å¤åˆ¶ ä»å®¿ä¸»æœºå¤åˆ¶åˆ°å®¹å™¨:docker cp å®¿ä¸»æœºæœ¬åœ°è·¯å¾„ å®¹å™¨åå­—/ID:å®¹å™¨è·¯å¾„ docker cp /root/123.txt mycentos:/home/ ä»å®¹å™¨å¤åˆ¶åˆ°å®¿ä¸»æœº:docker cp å®¹å™¨åå­—/ID:å®¹å™¨è·¯å¾„ å®¿ä¸»æœºæœ¬åœ°è·¯å¾„ docker cp mycentos:/home/456.txt /root å®¿ä¸»æœºæ–‡ä»¶å¤¹æŒ‚è½½åˆ°å®¹å™¨é‡Œ:docker run -itd -v å®¿ä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„ é•œåƒID docker run -itd -v /root/xdclass/:/home centos:7 å®šä¹‰è‡ªå·±çš„é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿåˆ°è‡ªå·±é˜¿é‡Œäº‘æ‰¾åˆ°å¯¹åº”çš„åœ°å€ï¼ˆæ¯äººä¸ä¸€æ ·ï¼‰ä¿®æ”¹/etc/docker/daemon.json,é‡å¯DockeræœåŠ¡ã€‚ 123{ \"registry-mirrors\": [\"&lt;åœ°å€&gt;\"] } ç§æœ‰é•œåƒä»“åº“Httpsæ”¹Httpä¿®æ”¹/etc/docker/daemon.json,é‡å¯DockeræœåŠ¡ã€‚ 123{ \"insecure-registries\":[\"http://&lt;host:port&gt;\"] }","link":"/2020/04/04/Docker/"},{"title":"FreeMarkeræŒ‡ä»¤å¸¸ç”¨æ ‡ç­¾åŠè¯­æ³•","text":"å¤ä¹ FreeMarkerï¼Œç»“åˆç½‘ä¸Šèµ„æ–™æ•´ç†äº†ä¸€ä¸‹å¸¸ç”¨çš„æŒ‡ä»¤ä¸è¯­æ³•ï¼Œä»¥å¤‡æ—¥åæŸ¥çœ‹ã€‚ FreeMarker Template Language(FTL),æ–‡ä»¶ä¸€èˆ¬ä¿å­˜ä¸ºxxx.ftlã€‚ä¸¥æ ¼ä¾èµ–MVCæ¨¡å¼ï¼Œä¸ä¾èµ–Servletå®¹å™¨ï¼ˆä¸å ç”¨JVMå†…å­˜ï¼‰ï¼Œä½¿ç”¨å†…å»ºå‡½æ•°ã€‚ æ³¨æ„ï¼šä½¿ç”¨freemakerï¼Œè¦æ±‚æ‰€æœ‰æ ‡ç­¾å¿…é¡»é—­åˆï¼Œå¦åˆ™ä¼šå¯¼è‡´freemakeræ— æ³•è§£æã€‚freemakeræ³¨é‡Š:&lt;#â€“ æ³¨é‡Šå†…å®¹ â€“&gt;æ ¼å¼éƒ¨åˆ†,ä¸ä¼šè¾“å‡º åŸºç¡€è¯­æ³• å­—ç¬¦è¾“å‡º 1234${emp.name?if_exists} // å˜é‡å­˜åœ¨ï¼Œè¾“å‡ºè¯¥å˜é‡ï¼Œå¦åˆ™ä¸è¾“å‡º${emp.name!} // å˜é‡å­˜åœ¨ï¼Œè¾“å‡ºè¯¥å˜é‡ï¼Œå¦åˆ™ä¸è¾“å‡º${emp.name?default(&quot;xxx&quot;)} // å˜é‡ä¸å­˜åœ¨ï¼Œå–é»˜è®¤å€¼xxx ${emp.name!&quot;xxx&quot;} // å˜é‡ä¸å­˜åœ¨ï¼Œå–é»˜è®¤å€¼xxx å¸¸ç”¨å†…éƒ¨å‡½æ•°ï¼š 12345${&quot;123&lt;br&gt;456&quot;?html} // å¯¹å­—ç¬¦ä¸²è¿›è¡ŒHTMLç¼–ç ï¼Œå¯¹htmlä¸­ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ ${&quot;str&quot;?cap_first} // ä½¿å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ ${&quot;Str&quot;?lower_case} // å°†å­—ç¬¦ä¸²è½¬æ¢æˆå°å†™ ${&quot;Str&quot;?upper_case} // å°†å­—ç¬¦ä¸²è½¬æ¢æˆå¤§å†™ ${&quot;str&quot;?trim} // å»æ‰å­—ç¬¦ä¸²å‰åçš„ç©ºç™½å­—ç¬¦ å­—ç¬¦ä¸²çš„ä¸¤ç§æ‹¼æ¥æ–¹å¼æ‹¼æ¥ï¼š 12$ { â€œä½ å¥½$ {emp.nameï¼}â€} //è¾“å‡ºä½ å¥½+å˜é‡å $ {â€œhelloâ€+ emp.nameï¼} //ä½¿ç”¨+å·æ¥è¿æ¥ï¼Œè¾“å‡ºä½ å¥½+å˜é‡å å¯ä»¥é€šè¿‡å¦‚ä¸‹è¯­æ³•æ¥æˆªå–å­ä¸²ï¼š 12345678&lt;#assign str =â€œabcdefghijklmnâ€/&gt;//æ–¹æ³•1$ {str?substringï¼ˆ0,4ï¼‰} //è¾“å‡ºabcd//æ–¹æ³•2 $ {str[0]}${str[4]} //ç»“æœæ˜¯ae$ {str [1..4]} //ç»“æœæ˜¯bcde//è¿”å›æŒ‡å®šå­—ç¬¦çš„ç´¢å¼•$ {str?index_ofï¼ˆ&quot;n&quot;ï¼‰} æ—¥æœŸè¾“å‡º 1$ {emp.date?stringï¼ˆ&apos;yyyy -MM-dd&apos;ï¼‰} //æ—¥æœŸæ ¼å¼ æ•°å­—è¾“å‡ºï¼ˆä»¥æ•°å­—20ä¸ºä¾‹ï¼‰ 123456789101112131415161718192021222324252627$ {emp.name?string.number} //è¾“å‡º20 $ {emp.name?string.currency} //Â¥20.00 $ {emp.name?string.percent} // 20ï¼… $ {1.222ï¼Ÿint} //å°†å°æ•°è½¬ä¸ºintï¼Œè¾“å‡º1 &lt;#setting number_format =â€œpercentâ€/&gt; //è®¾ç½®æ•°å­—é»˜è®¤è¾“å‡ºæ–¹å¼ï¼ˆ&apos;percent&apos;ï¼Œç™¾åˆ†æ¯”ï¼‰ &lt;#assign answer = 42 /&gt; //å£°æ˜å˜é‡å›ç­”42 #{answer} //è¾“å‡º4,200ï¼…$ {answerï¼Ÿstring} //è¾“å‡º4,200ï¼…$ {answerï¼Ÿstring.number} //è¾“å‡º42$ {answerï¼Ÿstring.currency} //è¾“å‡ºÂ¥42.00 $ {answerï¼Ÿstring.percent} //è¾“å‡º4,200ï¼…#{answer} //è¾“å‡º42 æ•°å­—æ ¼å¼åŒ–æ’å€¼å¯é‡‡ç”¨ï¼ƒ{expr; format}å½¢å¼æ¥æ ¼å¼åŒ–æ•°å­—ï¼Œå…¶ä¸­æ ¼å¼å¯ä»¥æ˜¯ï¼šmXï¼šå°æ•°éƒ¨åˆ†æœ€å°Xä½MXï¼šå°æ•°éƒ¨åˆ†æœ€å¤§Xä½å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š&lt;#assign x = 2.582 /&gt; &lt;#assign y = 4 /&gt; ï¼ƒ {x; M2} //è¾“å‡º2.58 ï¼ƒ {y; M2} //è¾“å‡º4 ï¼ƒ {x; m2} //è¾“å‡º2.58 ï¼ƒ{Y; m2} //è¾“å‡º4.0ï¼ƒ {x; m1M2} //è¾“å‡º2.58 ï¼ƒ {x; m1M2} //è¾“å‡º4.0 ç”³æ˜å˜é‡ 12&lt;#assign foo = false /&gt; //å£°æ˜å˜é‡ï¼Œæ’å…¥å¸ƒå°”å€¼è¿›è¡Œæ˜¾ç¤ºï¼Œæ³¨æ„ä¸è¦ç”¨å¼•å·$ {fooï¼Ÿstringï¼ˆâ€œyesâ€ï¼Œâ€œnoâ€ï¼‰} //å½“ä¸ºçœŸæ—¶è¾“å‡ºâ€œyesâ€ï¼Œå¦åˆ™è¾“å‡ºâ€œnoâ€ ç”³æ˜å˜é‡çš„å‡ ç§æ–¹å¼ 1234567891011&lt;#assign name = value&gt; &lt;#assign name1 = value1 name2 = value2 ... nameN = valueN&gt; &lt;#assign same as above... in namespacehash&gt; &lt;#assign name&gt; capture this &lt;/ï¼ƒassign&gt; &lt;#assign name in namespacehash&gt; capture this &lt;/ï¼ƒassign&gt; æ¯”è¾ƒè¿ç®—ç®—ç¬¦ 12345è¡¨è¾¾å¼ä¸­æ”¯æŒçš„æ¯”è¾ƒè¿ç®—ç¬¦ç¬¦å¦‚ä¸‹å‡ ä¸ªï¼š=æˆ–==ï¼šåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚ï¼=ï¼šåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç­‰ã€‚&gt;æˆ–gtï¼šåˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºå³è¾¹å€¼&gt;&lt;=æˆ–lteï¼šåˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºç­‰äºå³è¾¹å€¼ ç®—æœ¯è¿ç®—ç¬¦ 123456FreeMarkerè¡¨è¾¾å¼ä¸­å®Œå…¨æ”¯æŒç®—æœ¯è¿ç®—ï¼ŒFreeMarkeræ”¯æŒçš„ç®—æœ¯è¿ç®—ç¬¦åŒ…æ‹¬ï¼š+ï¼Œ - ï¼Œ*ï¼Œ/ï¼Œï¼…æ³¨æ„ï¼šï¼ˆ1ï¼‰è¿ç®—ç¬¦ä¸¤è¾¹å¿…é¡»æ˜¯æ•°å­—ï¼ˆ2ï¼‰ä½¿ç”¨+è¿ç®—ç¬¦æ—¶ï¼Œå¦‚æœä¸€è¾¹æ˜¯æ•°å­—ï¼Œä¸€è¾¹æ˜¯å­—ç¬¦ä¸²ï¼Œå°±ä¼šè‡ªåŠ¨å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²å†è¿æ¥ï¼Œ å¦‚ï¼š$ {3 +â€œ5â€}ï¼Œç»“æœæ˜¯ï¼š35 é€»è¾‘è¿ç®—ç¬¦ 12345é€»è¾‘è¿ç®—ç¬¦æœ‰å¦‚ä¸‹å‡ ä¸ªï¼šé€»è¾‘ä¸ï¼š&amp;&amp; é€»è¾‘æˆ–ï¼š|| é€»è¾‘éï¼šï¼é€»è¾‘è¿ç®—ç¬¦åªèƒ½ä½œç”¨äºå¸ƒå°”å€¼ï¼Œå¦åˆ™å°†äº§ç”Ÿé”™è¯¯ FreeMarkerä¸­çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§å¦‚ä¸‹ï¼ˆç”±é«˜åˆ°ä½æ’åˆ—ï¼‰ï¼š 123456789â‘ ï¼Œä¸€å…ƒè¿ç®—ç¬¦ï¼šï¼â‘¡ï¼Œå†…å»ºå‡½æ•°ï¼šâ‘¢ï¼Œä¹˜é™¤æ³•ï¼š*ï¼Œ/ï¼Œï¼…â‘£ï¼ŒåŠ å‡æ³•ï¼š - ï¼Œ+ â‘¤ï¼Œæ¯”è¾ƒï¼š&gt;ï¼Œ&lt;ï¼Œ&gt; =ï¼Œ&lt;=ï¼ˆltï¼Œlteï¼Œgtï¼Œgteï¼‰â‘¥ï¼Œç›¸ç­‰ï¼š==ï¼Œ=ï¼Œ ï¼= â‘¦ï¼Œé€»è¾‘ä¸ï¼š&amp;&amp; â‘§ï¼Œé€»è¾‘æˆ–ï¼š|| â‘¨ï¼Œæ•°å­—èŒƒå›´ï¼š.. å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­åº”è¯¥ä½¿ç”¨æ‹¬å·æ¥ä¸¥æ ¼åŒºåˆ†ï¼Œè¿™æ ·çš„å¯è¯»æ€§å¥½ï¼Œå‡ºé”™å°‘ ifé€»è¾‘åˆ¤æ–­ï¼ˆæ³¨æ„ï¼šelseifä¸åŠ ç©ºæ ¼ï¼‰ 1234567891011121314151617181920&lt;#if condition&gt;...&lt;#elseif condition2&gt;...&lt;#elseif condition3&gt;...&lt;#else&gt;...&lt;/#if&gt;if ç©ºå€¼åˆ¤æ–­// å½“ photoList ä¸ä¸ºç©ºæ—¶&lt;#if photoList??&gt;...&lt;/#if&gt; å€¼å¾—æ³¨æ„çš„æ˜¯,${..}åªèƒ½ç”¨äºæ–‡æœ¬éƒ¨åˆ†,ä¸èƒ½ç”¨äºè¡¨è¾¾å¼,ä¸‹é¢çš„ä»£ç æ˜¯é”™è¯¯çš„:&lt;#if ${isBig}&gt;Wow!&lt;/#if&gt;&lt;#if &quot;${isBig}&quot;&gt;Wow!&lt;/#if&gt;// æ­£ç¡®å†™æ³•&lt;#if isBig&gt;Wow!&lt;/#if&gt; switch (æ¡ä»¶å¯ä¸ºæ•°å­—ï¼Œå¯ä¸ºå­—ç¬¦ä¸²) 12345678910111213&lt;#switch value&gt; &lt;#case refValue1&gt; ....&lt;#break&gt; &lt;#case refValue2&gt; ....&lt;#break&gt; &lt;#case refValueN&gt; ....&lt;#break&gt; &lt;#default&gt; .... &lt;/#switch&gt; é›†åˆ &amp; å¾ªç¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576// éå†é›†åˆ:&lt;#list empList! as emp&gt; ${emp.name!}&lt;/#list&gt;// å¯ä»¥è¿™æ ·éå†é›†åˆ:&lt;#list 0..(empList!?size-1) as i&gt; ${empList[i].name!}&lt;/#list&gt;// ä¸jstlå¾ªç¯ç±»ä¼¼,ä¹Ÿå¯ä»¥è®¿é—®å¾ªç¯çš„çŠ¶æ€ã€‚empList?size // å–é›†åˆçš„é•¿åº¦emp_index: // intç±»å‹ï¼Œå½“å‰å¯¹è±¡çš„ç´¢å¼•å€¼ emp_has_next: // booleanç±»å‹ï¼Œæ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå¯¹è±¡// ä½¿ç”¨&lt;#break&gt;è·³å‡ºå¾ªç¯&lt;#if emp_index = 0&gt;&lt;#break&gt;&lt;/#if&gt;// é›†åˆé•¿åº¦åˆ¤æ–­ &lt;#if empList?size != 0&gt;&lt;/#if&gt; // åˆ¤æ–­=çš„æ—¶å€™,æ³¨æ„åªè¦ä¸€ä¸ª=ç¬¦å·,è€Œä¸æ˜¯==&lt;#assign l=0..100/&gt; // å®šä¹‰ä¸€ä¸ªintåŒºé—´çš„0~100çš„é›†åˆï¼Œæ•°å­—èŒƒå›´ä¹Ÿæ”¯æŒåé€’å¢,å¦‚100..2&lt;#list 0..100 as i&gt; // ç­‰æ•ˆäºjava for(int i=0; i &lt;= 100; i++) ${i}&lt;/#list&gt;// æˆªå–å­é›†åˆï¼šempList[3..5] //è¿”å›empListé›†åˆçš„å­é›†åˆ,å­é›†åˆä¸­çš„å…ƒç´ æ˜¯empListé›†åˆä¸­çš„ç¬¬4-6ä¸ªå…ƒç´ // åˆ›å»ºé›†åˆï¼š&lt;#list [&quot;æ˜ŸæœŸä¸€&quot;, &quot;æ˜ŸæœŸäºŒ&quot;, &quot;æ˜ŸæœŸä¸‰&quot;, &quot;æ˜ŸæœŸå››&quot;, &quot;æ˜ŸæœŸäº”&quot;, &quot;æ˜ŸæœŸå…­&quot;, &quot;æ˜ŸæœŸå¤©&quot;] as x&gt;// é›†åˆè¿æ¥è¿ç®—,å°†ä¸¤ä¸ªé›†åˆè¿æ¥æˆä¸€ä¸ªæ–°çš„é›†åˆ&lt;#list [&quot;æ˜ŸæœŸä¸€&quot;,&quot;æ˜ŸæœŸäºŒ&quot;,&quot;æ˜ŸæœŸä¸‰&quot;] + [&quot;æ˜ŸæœŸå››&quot;,&quot;æ˜ŸæœŸäº”&quot;,&quot;æ˜ŸæœŸå…­&quot;,&quot;æ˜ŸæœŸå¤©&quot;] as x&gt;// é™¤æ­¤ä¹‹å¤–,é›†åˆå…ƒç´ ä¹Ÿå¯ä»¥æ˜¯è¡¨è¾¾å¼,ä¾‹å­å¦‚ä¸‹:[2 + 2, [1, 2, 3, 4], &quot;whatnot&quot;]// seq_containsï¼šåˆ¤æ–­åºåˆ—ä¸­çš„å…ƒç´ æ˜¯å¦å­˜åœ¨&lt;#assign x = [&quot;red&quot;, 16, &quot;blue&quot;, &quot;cyan&quot;]&gt; ${x?seq_contains(&quot;blue&quot;)?string(&quot;yes&quot;, &quot;no&quot;)} // yes${x?seq_contains(&quot;yellow&quot;)?string(&quot;yes&quot;, &quot;no&quot;)} // no${x?seq_contains(16)?string(&quot;yes&quot;, &quot;no&quot;)} // yes${x?seq_contains(&quot;16&quot;)?string(&quot;yes&quot;, &quot;no&quot;)} // no// seq_index_ofï¼šç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•&lt;#assign x = [&quot;red&quot;, 16, &quot;blue&quot;, &quot;cyan&quot;, &quot;blue&quot;]&gt; ${x?seq_index_of(&quot;blue&quot;)} // 2// sort_byï¼šæ’åºï¼ˆå‡åºï¼‰&lt;#list movies?sort_by(&quot;showtime&quot;) as movie&gt;&lt;/#list&gt;// sort_byï¼šæ’åºï¼ˆé™åºï¼‰&lt;#list movies?sort_by(&quot;showtime&quot;)?reverse as movie&gt;&lt;/#list&gt;// å…·ä½“ä»‹ç»ï¼š// ä¸æ’åºçš„æƒ…å†µï¼š&lt;#list movies as moive&gt; &lt;a href=&quot;${moive.url}&quot;&gt;${moive.name}&lt;/a&gt;&lt;/#list&gt;//è¦æ˜¯æ’åºï¼Œåˆ™ç”¨&lt;#list movies?sort as movie&gt; &lt;a href=&quot;${movie.url}&quot;&gt;${movie.name}&lt;/a&gt;&lt;/#list&gt;// è¿™æ˜¯æŒ‰å…ƒç´ çš„é¦–å­—æ¯æ’åºã€‚è‹¥è¦æŒ‰listä¸­å¯¹è±¡å…ƒç´ çš„æŸä¸€å±æ€§æ’åºçš„è¯ï¼Œåˆ™ç”¨&lt;#list moives?sort_by([&quot;name&quot;]) as movie&gt; &lt;a href=&quot;${movie.url}&quot;&gt;${movie.name}&lt;/a&gt;&lt;/#list&gt;//è¿™ä¸ªæ˜¯æŒ‰listä¸­å¯¹è±¡å…ƒç´ çš„[name]å±æ€§æ’åºçš„ï¼Œæ˜¯å‡åºï¼Œå¦‚æœéœ€è¦é™åºçš„è¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;#list movies?sort_by([&quot;name&quot;])?reverse as movie&gt; &lt;a href=&quot;${movie.url}&quot;&gt;${movie.name}&lt;/a&gt;&lt;/#list&gt; Mapå¯¹è±¡ 12345678910// åˆ›å»ºmap&lt;#assign scores = {&quot;è¯­æ–‡&quot;:86,&quot;æ•°å­¦&quot;:78}&gt;// Mapè¿æ¥è¿ç®—ç¬¦&lt;#assign scores = {&quot;è¯­æ–‡&quot;:86,&quot;æ•°å­¦&quot;:78} + {&quot;æ•°å­¦&quot;:87,&quot;Java&quot;:93}&gt;// Mapå…ƒç´ è¾“å‡º${emp.name} // å…¨éƒ¨ä½¿ç”¨ç‚¹è¯­æ³•${emp[&quot;name&quot;]} // ä½¿ç”¨æ–¹æ‹¬å·å¾ªç¯//éå†é›†åˆï¼š&lt;ï¼ƒlist empListï¼as emp&gt; $ {emp.nameï¼} FreeMarkeræ”¯æŒå¦‚ä¸‹è½¬ä¹‰å­—ç¬¦: 1234567891011121314151617\\&quot; ï¼šåŒå¼•å·(u0022)\\&apos; ï¼šå•å¼•å·(u0027)\\\\ ï¼šåæ–œæ (u005C)\\n ï¼šæ¢è¡Œ(u000A)\\r ï¼šå›è½¦(u000D)\\t ï¼šTab(u0009)\\b ï¼šé€€æ ¼é”®(u0008)\\f ï¼šForm feed(u000C)\\l ï¼š&lt;\\g ï¼š&gt;\\a ï¼š&amp;\\{ ï¼š{\\xCode ï¼šç›´æ¥é€šè¿‡4ä½çš„16è¿›åˆ¶æ•°æ¥æŒ‡å®šUnicodeç ,è¾“å‡ºè¯¥unicodeç å¯¹åº”çš„å­—ç¬¦.å¦‚æœæŸæ®µæ–‡æœ¬ä¸­åŒ…å«å¤§é‡çš„ç‰¹æ®Šç¬¦å·,FreeMarkeræä¾›äº†å¦ä¸€ç§ç‰¹æ®Šæ ¼å¼:å¯ä»¥åœ¨æŒ‡å®šå­—ç¬¦ä¸²å†…å®¹çš„å¼•å·å‰å¢åŠ ræ ‡è®°,åœ¨ræ ‡è®°åçš„æ–‡ä»¶å°†ä¼šç›´æ¥è¾“å‡º.çœ‹å¦‚ä¸‹ä»£ç :${r&quot;${foo}&quot;} // è¾“å‡º ${foo}${r&quot;C:/foo/bar&quot;} // è¾“å‡º C:/foo/bar includeæŒ‡ä»¤ 1234567// includeæŒ‡ä»¤çš„ä½œç”¨ç±»ä¼¼äºJSPçš„åŒ…å«æŒ‡ä»¤:&lt;#include &quot;/test.ftl&quot; encoding=&quot;UTF-8&quot; parse=true&gt;// åœ¨ä¸Šé¢çš„è¯­æ³•æ ¼å¼ä¸­,ä¸¤ä¸ªå‚æ•°çš„è§£é‡Šå¦‚ä¸‹:encoding=&quot;GBK&quot; // ç¼–ç æ ¼å¼parse=true // æ˜¯å¦ä½œä¸ºftlè¯­æ³•è§£æ,é»˜è®¤æ˜¯trueï¼Œfalseå°±æ˜¯ä»¥æ–‡æœ¬æ–¹å¼å¼•å…¥æ³¨æ„:åœ¨ftlæ–‡ä»¶é‡Œå¸ƒå°”å€¼éƒ½æ˜¯ç›´æ¥èµ‹å€¼çš„å¦‚parse=true,è€Œä¸æ˜¯parse=&quot;true&quot; importæŒ‡ä»¤ 123// ç±»ä¼¼äºjspé‡Œçš„import,å®ƒå¯¼å…¥æ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥åœ¨å½“å‰æ–‡ä»¶é‡Œä½¿ç”¨è¢«å¯¼å…¥æ–‡ä»¶é‡Œçš„å®ç»„ä»¶&lt;#import &quot;/libs/mylib.ftl&quot; as my&gt;// ä¸Šé¢çš„ä»£ç å°†å¯¼å…¥/lib/common.ftlæ¨¡æ¿æ–‡ä»¶ä¸­çš„æ‰€æœ‰å˜é‡,äº¤å°†è¿™äº›å˜é‡æ”¾ç½®åœ¨ä¸€ä¸ªåä¸ºcomçš„Mapå¯¹è±¡ä¸­ï¼Œ&quot;my&quot;åœ¨freemarkeré‡Œè¢«ç§°ä½œnamespace compress å‹ç¼© 1234567891011// ç”¨æ¥å‹ç¼©ç©ºç™½ç©ºé—´å’Œç©ºç™½çš„è¡Œ &lt;#compress&gt; ... &lt;/#compress&gt;&lt;#t&gt; // å»æ‰å·¦å³ç©ºç™½å’Œå›è½¦æ¢è¡Œ &lt;#lt&gt;// å»æ‰å·¦è¾¹ç©ºç™½å’Œå›è½¦æ¢è¡Œ &lt;#rt&gt;// å»æ‰å³è¾¹ç©ºç™½å’Œå›è½¦æ¢è¡Œ &lt;#nt&gt;// å–æ¶ˆä¸Šé¢çš„æ•ˆæœ escape,noescape å¯¹å­—ç¬¦ä¸²è¿›è¡ŒHTMLç¼–ç  123456789101112// escapeæŒ‡ä»¤å¯¼è‡´bodyåŒºçš„æ’å€¼éƒ½ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šescapeè¡¨è¾¾å¼,ä½†ä¸ä¼šå½±å“å­—ç¬¦ä¸²å†…çš„æ’å€¼, åªä¼šå½±å“åˆ°bodyå†…å‡ºç°çš„æ’å€¼,ä½¿ç”¨escapeæŒ‡ä»¤çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹:&lt;#escape x as x?html&gt; First name: ${firstName} &lt;#noescape&gt;Last name: ${lastName}&lt;/#noescape&gt; Maiden name: ${maidenName} &lt;/#escape&gt;// ç›¸åŒè¡¨è¾¾å¼First name: ${firstName?html} Last name: ${lastName} Maiden name: ${maidenName?html} é…ç½®æ–‡ä»¶1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950spring.freemarker.allow-request-overrideæŒ‡å®šHttpServletRequestçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerçš„modelçš„åŒåé¡¹spring.freemarker.allow-session-overrideæŒ‡å®šHttpSessionçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerçš„modelçš„åŒåé¡¹spring.freemarker.cacheæ˜¯å¦å¼€å¯template caching.spring.freemarker.charsetè®¾å®šTemplateçš„ç¼–ç .spring.freemarker.check-template-locationæ˜¯å¦æ£€æŸ¥templatesè·¯å¾„æ˜¯å¦å­˜åœ¨.spring.freemarker.content-typeè®¾å®šContent-Type.spring.freemarker.enabledæ˜¯å¦å…è®¸mvcä½¿ç”¨freemarker.spring.freemarker.expose-request-attributesè®¾å®šæ‰€æœ‰requestçš„å±æ€§åœ¨mergeåˆ°æ¨¡æ¿çš„æ—¶å€™ï¼Œæ˜¯å¦è¦éƒ½æ·»åŠ åˆ°modelä¸­.spring.freemarker.expose-session-attributesè®¾å®šæ‰€æœ‰HttpSessionçš„å±æ€§åœ¨mergeåˆ°æ¨¡æ¿çš„æ—¶å€™ï¼Œæ˜¯å¦è¦éƒ½æ·»åŠ åˆ°modelä¸­.spring.freemarker.expose-spring-macro-helpersè®¾å®šæ˜¯å¦ä»¥springMacroRequestContextçš„å½¢å¼æš´éœ²RequestContextç»™Springâ€™s macro libraryä½¿ç”¨spring.freemarker.prefer-file-system-accessæ˜¯å¦ä¼˜å…ˆä»æ–‡ä»¶ç³»ç»ŸåŠ è½½templateï¼Œä»¥æ”¯æŒçƒ­åŠ è½½ï¼Œé»˜è®¤ä¸ºtruespring.freemarker.prefixè®¾å®šfreemarkeræ¨¡æ¿çš„å‰ç¼€.spring.freemarker.request-context-attributeæŒ‡å®šRequestContextå±æ€§çš„å.spring.freemarker.settingsè®¾å®šFreeMarker keys.spring.freemarker.suffixè®¾å®šæ¨¡æ¿çš„åç¼€.spring.freemarker.template-loader-pathè®¾å®šæ¨¡æ¿çš„åŠ è½½è·¯å¾„ï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤: [&quot;classpath:/templates/&quot;]spring.freemarker.view-namesæŒ‡å®šä½¿ç”¨æ¨¡æ¿çš„è§†å›¾åˆ—è¡¨.","link":"/2019/03/03/FreeMarker/"},{"title":"æ­å»ºä¸ªäººåšå®¢ ä¹‹ HexoåŸºç¡€","text":"ä¸€ç›´æœ‰åœ¨æœ¬åœ°å†™mdç¬”è®°çš„ä¹ æƒ¯ï¼Œåˆæƒ³åŒæ­¥åˆ°è‡ªå·±çš„å„ä¸ªè®¾å¤‡éšæ—¶æŸ¥çœ‹ï¼ŒWinå¹³å°è¯•è¿‡é©¬å…‹é£è±¡åŒæ­¥åˆ°å°è±¡ç¬”è®°ï¼Œå°è±¡ç¬”è®°ç«¯ä¸èƒ½ç¼–è¾‘ï¼Œæ”¾å¼ƒâ€¦â€¦ä¹‹åä¸€ç›´ä½¿ç”¨typoraåœ¨æœ¬åœ°ä¿å­˜ï¼Œè‡ªä»18å¹´æ¢åˆ°MacOSå¹³å°åï¼Œå°è¯•è¿‡MWebï¼ŒQuiverï¼ŒBearï¼ŒUlyssesï¼Œæœ€åé€‰æ‹©MWebã€‚åæ¥æœ‰äº†è‡ªå·±çš„æœåŠ¡å™¨ï¼Œä½¿ç”¨äº†WordPressä¸€æ®µæ—¶é—´ï¼Œæ„Ÿè§‰æ¯”è¾ƒéº»çƒ¦ï¼Œé€Ÿåº¦ä¹Ÿä¸ç†æƒ³ã€‚æŠ˜è…¾å‘çš„æˆ‘åˆé€‰æ‹©äº†Hexoï¼Œæ‰€ä»¥æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œå“ˆå“ˆã€‚ç°åœ¨æ˜¯é‡‡ç”¨MWebç¼–è¾‘mdæ–‡ä»¶ï¼Œé€šè¿‡MWebå‘å¸ƒæœåŠ¡ç›´æ¥æ¨åˆ°æœåŠ¡å™¨ä¸Šï¼Œå›¾ç‰‡é€šè¿‡MWebä¸Šä¼ åˆ°ä¸ƒç‰›äº‘ï¼ŒæœåŠ¡å™¨ä½¿ç”¨Dockerå’ŒNginxæ¥å®ç°ã€‚è¿™æ ·ä¸€æ¥ï¼Œå†™å®Œmdæ–‡ä»¶åï¼Œç›´æ¥å‘å¸ƒï¼Œç›¸å½“æ–¹ä¾¿å“ˆå“ˆï¼ å®‰è£…HexoMacå·²ç»ä½¿ç”¨HomeBrewå®‰è£…äº†nodeå’Œgitï¼Œæ‰€ä»¥ç›´æ¥å®‰è£…Hexoã€‚1npm install -g hexo æ–°å»ºå¹¶è¿›å…¥Hexoç›®å½•ï¼Œå¹¶æ‰§è¡ŒHexoåˆå§‹åŒ–ã€‚ 1hexo init //hexoåˆå§‹åŒ– 123hexo g //é‡æ–°ç”Ÿæˆåšå®¢é™æ€æ–‡ä»¶hexo g --watch//é‡æ–°ç”Ÿæˆåšå®¢ä»£ç (åªå¯¹å˜åŠ¨çš„æ–‡ä»¶ç”Ÿæˆé™æ€æ–‡ä»¶)hexo s //å¯åŠ¨hexoæœåŠ¡ å¯ä»¥åœ¨http://localhost:4000çœ‹åˆ°æœ¬åœ°çš„hexoåšå®¢ã€‚ ä½¿ç”¨Hexoå†™ä½œ1hexo new [layout] &lt;title&gt; layoutæœ‰ä¸‰ç§å¸ƒå±€ï¼š post æ–‡ç«  page é¡µé¢ draft è‰ç¨¿ ä¸‰ç§å¸ƒå±€çš„æ¨¡ç‰ˆåœ¨Hexoç›®å½•/scaffolds/ä¸‹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œæ­£æ–‡éƒ¨åˆ†å¯ä»¥ä½¿ç”¨mdæ ¼å¼ä¹Ÿå¯ä»¥ä½¿ç”¨htmlæ ¼å¼ã€‚ é…ç½®Hexoç«™ç‚¹åœ¨Hexoç›®å½•ä¸‹çš„_config.ymlæ˜¯Hexoçš„ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„æ¯ä¸ªå†’å·åè¦æœ‰ç©ºæ ¼ï¼Œè¿™æ˜¯æˆ‘åšæ›´æ”¹çš„é…ç½®ï¼Œå…¶ä½™éƒ½ä¸ºé»˜è®¤ã€‚1234567891011121314151617181920212223242526# Sitetitle: Corden Web //ç½‘ç«™æ ‡é¢˜subtitle: Web developer, lifelong learner //ç½‘ç«™å‰¯æ ‡é¢˜description: //ç½‘ç«™æè¿°keywords: //ç½‘ç«™å…³é”®è¯author: MikeCorden //ä½œè€…language: zh-CN //è¯­è¨€timezone: //æ—¶åŒºï¼Œé»˜è®¤ä½ ç”µè„‘çš„æ—¶åŒº## Themes: https://hexo.io/themes/theme: next //ä½¿ç”¨nextä¸»é¢˜# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: //åŒæ—¶éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨å’Œgitä¸Š- type: sftp //éƒ¨ç½²æ–¹å¼ host: //æœåŠ¡å™¨ip user: //ç”¨æˆ·å pass: //å¯†ç  remotePath: //ä¸Šä¼ è·¯å¾„ port: //ç«¯å£ agent: $SSH_AUTH_SOCK- type: git //éƒ¨ç½²æ–¹å¼ repo: //gitä¸Šä»“åº“åœ°å€ branch: //åˆ†æ”¯åç§° message: //æäº¤ä¿¡æ¯ å¦‚æœåªéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š(æ›´å¤šæ–¹å¼è¯·å‚è€ƒ : hexo.io) ï¼š123deploy: type: sftp ... ä½¿ç”¨Hexoä¸»é¢˜ä¸»é¢˜å¯ä»¥åœ¨hexo.themesä¸Šé€‰æ‹©å¹¶ä¸‹è½½ï¼Œé»˜è®¤ä¸»é¢˜æ˜¯landscapeï¼Œæˆ‘ä¸‹è½½äº†Modernistå’ŒNexTã€‚ å®‰è£…NexTä¸»é¢˜è¿›å…¥Hexoç›®å½•ã€‚1git clone git@github.com:theme-next/hexo-theme-next.git themes/next ä¿®æ”¹Hexoè·¯å¾„ä¸‹ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlã€‚1theme: next //nextéœ€è¦ä¸themesä¸‹å¯¹åº”çš„ä¸»é¢˜æ–‡ä»¶å¤¹åŒå é…ç½®NexTä¸»é¢˜åœ¨Hexoç›®å½•ä¸‹cd themes/nextå¯ä»¥çœ‹åˆ°_config.ymlï¼Œè¿™ä¸ªæ˜¯NexTä¸»é¢˜çš„é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„ä¸è¦è·ŸHexoçš„ç«™ç‚¹é…ç½®æ–‡ä»¶ææ··ã€‚ ğŸ‘‡ç®€å•ä»‹ç»ä¸€äº›æˆ‘ä½¿ç”¨çš„é…ç½®ï¼š èœå•é…ç½®12345678910# Usage: `Key: /link/ || icon`menu: home: / || home archives: /archives/ || archive categories: /categories/ || th tags: /tags/ || tags about: /about/ || user #schedule: /schedule/ || calendar #sitemap: /sitemap.xml || sitemap #commonweal: /404/ || heartbeat è®¾ç½®åéœ€è¦åœ¨Hexoä¸»ç›®å½•ä¸‹åˆ›å»ºé¡µé¢ï¼š 1hexo new page tags å¦‚æœå¼•å…¥è¯„è®ºç³»ç»Ÿè¦åœ¨é¡µé¢åŠ ä¸Šcomments: falseï¼ˆåˆ†ç±»å’Œå…³äºé¡µé¢ä¹Ÿè¦åŠ ï¼‰ æ›´æ”¹ä¸»é¢˜å¸ƒå±€å››ç§å¸ƒå±€å¯é€‰ï¼Œæ‰“å¼€æ‰€éœ€å¸ƒå±€å³å¯ã€‚12345# Schemes#scheme: Muse#scheme: Mistscheme: Pisces#scheme: Gemini è”ç³»æ–¹å¼12345social: GitHub: https://github.com/yourname || github E-Mail: mailto:&lt;yourmail&gt; || envelope Instagram: https://instagram.com/&lt;ä½ çš„Insç”¨æˆ·å&gt; || instagram ... å¤´åƒ123456# Sidebar Avataravatar: url: #å¤´åƒåœ°å€ rounded: false #true--&gt;åœ†çš„ opacity: 1 #é€æ˜åº¦ rotated: false #true--&gt;é¼ æ ‡æ”¾ä¸Šæ—‹è½¬ urlå¯ä»¥æ˜¯OSSå¤–é“¾ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸»é¢˜ä¸‹çš„source/images/ä¸‹æ”¾ç½®å¤´åƒæ–‡ä»¶å³å¯ã€‚ è¾¹æ 123sidebar: # Sidebar Position, available values: left | right (only for Pisces | Gemini). position: left è‡ªå¸¦åŠ¨ç”»æ•ˆæœ123motion: enable: true #å¼€å¯ async: true #å¼€å¯å¼‚æ­¥ å¼€å¯åŠ¨ç”»ä¼šå½±å“æ‰“å¼€ç½‘ç«™é€Ÿåº¦ï¼Œå¯ä»¥å…³é—­ è‡ªå¸¦åŠ¨ç”»èƒŒæ™¯æ•ˆæœ1234567canvas_nest: enable: true #å¼€å¯ onmobile: false #æ‰‹æœºç«¯æ˜¯å¦æ˜¾ç¤º color: \"0,0,0\" #çº¿æ¡é¢œè‰² opacity: 0.5 #é€æ˜åº¦ zIndex: -1 #zè½´åæ ‡ count: 99 #çº¿çš„æ•°é‡ NexTä¸»é¢˜è‡ªå¸¦åŠ¨ç”»canvas_nestæˆ–three_wavesï¼Œæ ¹æ®éœ€æ±‚è®¾ç½®å€¼ä¸ºtrueæˆ–è€…falseå³å¯ã€‚ fancyboxå›¾ç‰‡æ”¾å¤§12git clone https://github.com/theme-next/theme-next-fancybox3 /themes/next/source/lib/fancybox åœ¨NexTä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­è®¾ç½®fancybox: trueå³å¯ã€‚ è‡ªå®šä¹‰è¡Œå†…ä»£ç æ ·å¼è¿›å…¥themes/next/source/css/_customä¿®æ”¹custom.stylæ–‡ä»¶å³å¯ã€‚12345678code { color: #c7254e; background: #f9f2f4; border: 1px solid #d6d6d6; padding:1px 4px; word-break: break-all; border-radius:4px;} ç™¾åº¦ç»Ÿè®¡åˆ†æ æ³¨å†Œç™¾åº¦ç»Ÿè®¡ï¼Œå¹¶æ–°å»ºç½‘ç«™åˆ—è¡¨ã€‚ å»ºç«‹æˆåŠŸåï¼Œè·å–æ–°ç‰ˆç»Ÿè®¡ä»£ç ã€‚ å°†ä¸Šå›¾ä¸­é»‘è‰²é®æŒ¡çš„IDå¤åˆ¶åˆ°NexTé…ç½®æ–‡ä»¶,å³å¯å¼€å¯ã€‚ 1baidu_analytics: Your Baidu Analytics ID ç™¾åº¦ç»Ÿè®¡çš„è‡ªåŠ¨ä»£ç æ£€æµ‹å¯èƒ½æ£€æµ‹ä¸åˆ°ä»£ç è£…è½½ï¼Œå¯ä»¥è¿›è¡Œæ‰‹åŠ¨æ£€æŸ¥ã€‚ ä¸è’œå­é˜…è¯»é‡ç»Ÿè®¡åœ¨NexTé…ç½®æ–‡ä»¶å¼€å¯å³å¯ã€‚12345678busuanzi_count: enable: true total_visitors: true total_visitors_icon: user total_views: true total_views_icon: eye post_views: true post_views_icon: eye è¯„è®ºç³»ç»ŸValineNexTå·²ç»é›†æˆäº†Valineï¼Œåœ¨ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ä¸­å°±å¯ä»¥æ‰¾åˆ°ã€‚Valineæ˜¯åŸºäºLeanCloudçš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆç”³è¯·LeanCloudã€‚ åœ¨LeanCloudåˆ›å»ºåº”ç”¨ã€‚ è·å–AppIdå’ŒAppKey åœ¨NexTä¸»é¢˜é…ç½®æ–‡ä»¶æ‰¾åˆ°valineå¹¶é…ç½® 12345678910111213valine: enable: true #å¼€å¯ appid: #leancloud appid appkey: #leancloud appkey notify: false #é‚®ä»¶é€šçŸ¥,å‚è€ƒ:https://github.com/xCss/Valine/wiki verify: false #éªŒè¯ç  placeholder: ãƒ¾ï¾‰â‰§âˆ€â‰¦)o æ¥å‘€ï¼å¿«æ´»å‘€ï¼~ #placeholderæ–‡æœ¬ avatar: mm #è¯„è®ºå¤´åƒï¼Œå‚è€ƒ:https://valine.js.org/avatar.html guest_info: nick,mail #è¯„è®ºæ ‡é¢˜ï¼Œlink(ç½‘å€) pageSize: 10 #æ¯é¡µæ•°é‡ language: #è¯­è¨€:en, zh-cn visitor: false #é˜…è¯»é‡ comment_count: true #trueé¦–é¡µæ˜¾ç¤ºæ¯ç¯‡æ–‡ç« è¯„è®ºæ•° ä½¿ç”¨Valineé˜…è¯»é‡ç»Ÿè®¡éœ€è¦æ³¨æ„ï¼šleancloud-counter-security is not supported for now. When visitor is set to be true, appid and appkey are recommended to be the same as leancloud_visitorsâ€™ for counter compatibility. Article reading statistic è¯„è®ºæ•ˆæœğŸ‘‡ï¼š æœ€ååˆ°æ­¤ï¼ŒHexoå’ŒNexTä¸»é¢˜é…ç½®ç»“æŸï¼Œä¸‹ä¸€ç¯‡æ–‡ç« å°†ä»‹ç»markdownç¼–è¾‘å™¨MWebå¿«é€Ÿéƒ¨ç½²Hexoæ–‡ç« ï¼ŒDockeråˆ›å»ºNginxå®¹å™¨ï¼Œä»¥åŠä¸ƒç‰›äº‘å›¾åºŠç”³è¯·ï¼Œsslè¯ä¹¦ç­‰è®¾ç½®ã€‚","link":"/2019/03/17/Hexo/"},{"title":"æ­å»ºä¸ªäººåšå®¢ ä¹‹ MWebï¼ŒæœåŠ¡å™¨å’Œå…¨ç«™Https","text":"MWebç•Œé¢ç®€æ´å’Œé«˜æ€§èƒ½ï¼Œæ”¯æŒå‘å¸ƒåè®®ï¼Œå¯ä»¥å¿«é€Ÿå‘å¸ƒå†™å¥½çš„æ–‡ç« ï¼ŒMWebå¤‡ä»½é…åˆDockeråŠä¸ƒç‰›ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé‡æ–°éƒ¨ç½²ä¹Ÿä¸ä¼šå¤ªéº»çƒ¦ï¼Œä¸‹é¢ä»‹ç»MWebå¿«é€Ÿéƒ¨ç½²Hexoæ–‡ç« ï¼ŒDockeråˆ›å»ºNginxå®¹å™¨å¹¶é…ç½®SSLè¯ä¹¦ï¼Œä¸ƒç‰›äº‘å›¾åºŠç”³è¯·åŠå¼€å¯Httpsã€‚ MWebä½¿ç”¨åœ¨é‚£ä¹ˆå¤šmdç¼–è¾‘å™¨é‡Œä¹‹æ‰€ä»¥å–œæ¬¢ç”¨MWebæœ‰è¿™å‡ ä¸ªåŸå› ï¼š å¯ä»¥è¾¹ç¼–è¾‘ã€é¢„è§ˆåŒå¼€ï¼ˆå…¶å®ä¹Ÿä¸çœ‹é¢„è§ˆï¼Œä½†æ˜¯å¿…é¡»è¦å¼€ï¼Œå“ˆå“ˆï½ï¼‰ å¯ä»¥å¤åˆ¶å›¾ç‰‡åˆ°æ­£åœ¨ç¼–è¾‘çš„mdæ–‡ä»¶ï¼Œä¼šåœ¨å¯¹åº”ç›®å½•æ·»åŠ å›¾ç‰‡å‰¯æœ¬ å¯ä»¥å°†å›¾ç‰‡ä¸Šä¼ åˆ°è‡ªå·±çš„å›¾åºŠ å¯ä»¥å¿«æ·å‘å¸ƒåˆ°å„ç§æœåŠ¡å•†ï¼šå°è±¡ï¼Œå°‘æ•°æ´¾â€¦â€¦æ”¯æŒè‡ªå®šä¹‰è„šæœ¬ æœ‰å¤–éƒ¨å¼•ç”¨æ¨¡å¼ æ“ä½œç®€æ´ é…ç½®ä¸ƒç‰›äº‘åœ¨åå¥½è®¾ç½®--&gt;å‘å¸ƒæœåŠ¡å¯ä»¥çœ‹åˆ°ï¼Œå¯¹åº”çš„å¡«å…¥ä¸ƒç‰›çš„ç©ºé—´åç§°ï¼ŒAccess Keyï¼ŒSecret Keyï¼Œå’ŒåŸŸåå³å¯ã€‚å¡«å†™å¥½åå¯ä»¥è¿›è¡ŒéªŒè¯ï¼Œä¸Šä¼ ä¸€å¼ å›¾ç‰‡çœ‹æ˜¯å¦æˆåŠŸã€‚ ä¸Šä¼ å›¾ç‰‡åˆ°ä¸ƒç‰›äº‘å†™æ–‡ç« æ—¶å€™ç›´æ¥å¤åˆ¶å›¾ç‰‡ç²˜åˆ°mdä¸­ï¼Œæ–‡ç« å…¨éƒ¨å†™å®Œåç‚¹å‡»å³ä¸Šè§’åˆ†äº«æŒ‰é’®ã€‚ é€‰æ‹©æŠŠæœ¬åœ°å›¾ç‰‡ä¼ è‡³å›¾åºŠã€‚ é€‰æ‹©å¤åˆ¶ Markdownï¼Œå›¾ç‰‡ä¼šä¸Šä¼ åˆ°æ‰€é€‰å›¾åºŠå¹¶ä¼šå¤åˆ¶å·²ç»æ›¿æ¢æˆå¯¹åº”åŸŸååœ°å€çš„mdæ–‡æœ¬ï¼Œå°†mdå¤åˆ¶åˆ°éœ€è¦éƒ¨ç½²çš„mdæ–‡ä»¶ä¸­å³å¯ã€‚ æ³¨ï¼šgitè¦æ‰‹åŠ¨ä¸Šä¼ å¤åˆ¶å¤–é“¾ é…ç½®å‘å¸ƒæœåŠ¡åœ¨åå¥½è®¾ç½®--&gt;å‘å¸ƒæœåŠ¡å¯ä»¥çœ‹åˆ°æ”¯æŒå’Œè¿è¡Œè„šæœ¬,ç„¶åå†™ä¸‹å¯¹åº”çš„hexoéƒ¨ç½²å‘½ä»¤å³å¯ã€‚ å‘å¸ƒæ–‡ç« åˆ°Hexoåœ¨éœ€è¦è¿›è¡Œéƒ¨ç½²çš„mdæ–‡ä»¶ç‚¹å‡»å³ä¸Šåˆ†äº«é€‰æ‹©å¯¹åº”çš„å‘å¸ƒæœåŠ¡ã€‚ MWebä¼šå¤åˆ¶å‘½ä»¤åˆ°å‰ªåˆ‡æ¿ï¼Œç›´æ¥åœ¨å¼¹å‡ºçš„ç»ˆç«¯é‡Œcommand + Vå›è½¦å°±å¯ä»¥è¿è¡Œå·²ç»å†™å¥½çš„éƒ¨ç½²å‘½ä»¤ã€‚ Docker + NginxDockeræ˜¯ä¸€ä¸ªè™šæ‹ŸåŒ–è½¯ä»¶ï¼Œä½ å¯ä»¥è®¤ä¸ºæ˜¯ç±»ä¼¼ï¼šVMwareã€Virtualboxã€‚å¯¹å¼€å‘æ¥è®²æ€»ç»“ä¸€ä¸ªæœ€ç®€å•çš„è¯´æ³•ï¼šåœ¨ Maven æœªäº§ç”Ÿçš„å¹´ä»£ï¼Œjar åŒ…è¦éšç€å¼€å‘é¡¹ç›®èµ°åˆ°å“ªé‡Œè·Ÿåˆ°å“ªé‡Œã€‚æœ‰äº† Maven å†™å¥½ pom.xml å³å¯ã€‚æ­¤æ—¶çš„ Docker å°±å¥½æ¯”å¦‚ Mavenï¼Œå¸®ä½ çœå»äº†å¼€å‘è¿‡ç¨‹ä¸­çš„éƒ¨ç½²ç¯å¢ƒå·®å¼‚ï¼Œä½ å†ä¹Ÿä¸èƒ½éšä¾¿è¯´ï¼šä½ çš„ç³»ç»Ÿå¯ä»¥è¿è¡Œï¼Œæˆ‘çš„ç³»ç»Ÿå°±ä¸è¡Œã€‚ç°åœ¨åˆ«äººè¿ç³»ç»Ÿéƒ½å¸®ä½ åšå¥½äº†~ Dockerå®‰è£…Nginxå®¹å™¨å®‰è£…å¯åŠ¨Dockerï¼ˆä»¥åä¼šæ›´æ–°Dockerè¯¦ç»†æ•™ç¨‹ï¼‰12sudo yum install docker-ce //å®‰è£…sudo systemctl start docker //å¯åŠ¨ æ¨èä¸€ä¸ªæ›¿ä»£docker statsçš„æ’ä»¶ ctop12sudo wget https://github.com/bcicen/ctop/releases/download/v0.7.2/ctop-0.7.2-linux-amd64 -O /usr/local/bin/ctopsudo chmod +x /usr/local/bin/ctop ä»Dockerä»“åº“æ‹‰å–æœ€æ–°nginxé•œåƒ1docker pull nginx åˆ›å»ºNginxå®¹å™¨12345678910docker run -v /var/dfile/nginx/nginx.conf:/etc/nginx/nginx.conf -v /var/dfile/nginx:/var/dfile/ -v /var/dfile/nginx/full_chain.pem:/etc/nginx/cert/full_chain.pem -v /var/dfile/nginx/private.key:/etc/nginx/cert/private.key -d -p 80:80 -p 443:443 --name=ng -i -t --restart=always bb7 /bin/bash è¿›å…¥å®¹å™¨1docker exec -it ng bash Nginxé…ç½®nginxçš„é…ç½®æ–‡ä»¶æ˜¯/etc/nginx/nginx.confï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼ˆsslï¼‰ï¼š123456789101112131415161718192021222324server { listen 443 ssl; server_name localhost; ssl_certificate /etc/nginx/cert/full_chain.pem;#sslé…ç½® ssl_certificate_key /etc/nginx/cert/private.key;#sslé…ç½® ssl_session_timeout 5m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; location / { root /var/dfile/hexo;#é™æ€èµ„æºæ–‡ä»¶å¤¹ index index.html index.htm;#é™æ€èµ„æºé¡µé¢ } error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } server { listen 80;#ç›‘å¬ç«¯å£ server_name www.mikecorden.com mikecorden.com; rewrite ^(.*) https://$server_name$1 permanent;#301æ°¸ä¹…é‡å®šå‘ } å¯åŠ¨nginx1/usr/local/sbin/nginx ä¿®æ”¹é…ç½®æ–‡ä»¶è¦é‡å¯nginx1/usr/local/sbin/nginx -s reload ç”¨vimä¿®æ”¹nginx.confå¤ªè´¹åŠ²ï¼Œä¸€èˆ¬ç›´æ¥æœ¬åœ°ä¿®æ”¹å®Œï¼ŒSFTPå·¥å…·æ‹–åˆ°æœåŠ¡å™¨nginxå®¹å™¨æŒ‚åœ¨ç›®å½•ï¼Œç„¶åé‡å¯ã€‚ é˜¿é‡Œäº‘æœ¬ç«™çš„åŸŸåå’ŒæœåŠ¡å™¨éƒ½æ˜¯åœ¨é˜¿é‡Œäº‘è´­ä¹°ã€‚é˜¿é‡Œäº‘çš„äº¤äº’è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œappåšçš„ä¹Ÿè¿˜è¡Œï¼Œç°åœ¨æ‰‹æœºä¹Ÿæœ‰å†…ç½®çš„æ§åˆ¶å°äº†ã€‚ åŸŸååŠè§£ææˆ‘æŠŠåšå®¢éƒ¨ç½²åˆ°äº†githubå’Œè‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œåœ¨åŸŸåè§£æçš„æ—¶å€™ï¼Œå¯¹äºå›½å†…çº¿è·¯è§£æåˆ°è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå›½å¤–çš„çº¿è·¯è§£æåˆ°è‡ªå·±çš„GitHubPagesä¸Šï¼Œæ¥æé«˜è®¿é—®é€Ÿåº¦ã€‚ SSLè¯ä¹¦ç”³è¯·ï¼Œå…¨ç«™HTTPSSSLè¯ä¹¦æ˜¯åœ¨é˜¿é‡Œäº‘ç”³è¯·çš„ï¼Œä¸‹è½½çš„æ—¶å€™ é€‰æ‹©nginxç‰ˆæœ¬ï¼Œåœ¨åˆ›å»ºnginxå®¹å™¨çš„æ—¶å€™è¦æ˜ å°„å®¿ä¸»æœºçš„443ç«¯å£ç”¨äºsslã€‚å…·ä½“é…ç½®çœ‹ğŸ‘†ã€‚å…¨ç«™Httpséœ€è¦æœ¬ç«™æ‰€æœ‰çš„å¤–é“¾å¿…é¡»ä¸ºHttpsï¼ŒåŒ…æ‹¬åŠ è½½çš„jsï¼Œcssç­‰ï¼Œæ‰€æœ‰çš„å›¾ç‰‡é“¾æ¥ä¹Ÿå¿…é¡»ä¸ºHttpsã€‚å› ä¸ºHexoå…¶å®å°±æ˜¯é™æ€é¡µé¢ï¼Œå®ç°èµ·æ¥ä¹Ÿç®€å•ã€‚ä¸‹é¢ä»‹ç»ä¸‹ä¸ƒç‰›äº‘å›¾åºŠå¼€å¯httpsã€‚ ä¸ƒç‰›äº‘ä¸ƒç‰›äº‘æä¾› 10 G/æœˆçš„æ ‡å‡†å­˜å‚¨ CDN å›æºæµé‡å…è´¹é¢åº¦ï¼Œ è¶…è¿‡æŒ‰0.15 å…ƒ/GB ä»·æ ¼è¿›è¡Œæ”¶è´¹ã€‚æ¯ä¸ªæœˆå…è´¹10Gå¯¹äºè¿™ç§æ²¡äººçœ‹çš„å°åšå®¢å¾ˆå¤Ÿç”¨äº†ï¼Œå“ˆå“ˆï½ é…ç½®ä¸ƒç‰›äº‘å›¾åºŠæ³¨å†Œä¸ƒç‰›äº‘è´¦å·ï¼Œç”³è¯·å¯¹è±¡å­˜å‚¨ç©ºé—´ï¼ˆå…¬å¼€ç©ºé—´ï¼‰ã€‚ è¿›å…¥æ‰€ç”³è¯·çš„ç©ºé—´ï¼Œç»‘å®šåŸŸåï¼ˆè‡ªåŠ¨è·³è½¬åŸŸåç®¡ç†ï¼‰ã€‚ è¾“å…¥åŸŸåï¼Œå…ˆç”³è¯·httpï¼Œä¿å­˜åè¿›å…¥åŸŸåç®¡ç†ï¼Œï¼ˆä¿å­˜æˆåŠŸåå†æ”¹ä¸ºhttpsï¼Œè¿™æ ·å¯ä»¥å…å»æ‰‹åŠ¨é…ç½®sslè¯ä¹¦ï¼‰ã€‚ çŠ¶æ€å˜ä¸ºæˆåŠŸåï¼ˆä¸€èˆ¬10åˆ†é’Ÿå·¦å³ï¼‰ï¼Œé€‰æ‹©å¯¹åº”çš„åŸŸåï¼Œè¿›å…¥é…ç½®ç•Œé¢ã€‚ é…ç½®é˜²ç›—é“¾ç™½åå•ï¼Œç„¶åé…ç½®Httpsï¼šé€‰æ‹©å…è´¹è¯ä¹¦ï¼ˆé˜¿é‡Œäº‘ç­‰å…¶ä»–ç½‘ç«™ç”³è¯·ï¼Œç‚¹å‡»å·²æœ‰è¯ä¹¦ï¼‰ï¼Œä¸ƒç‰›äº‘ä¼šè‡ªåŠ¨å¸®ä½ ç”³è¯·ä¸€å¹´æœ‰æ•ˆçš„å…è´¹sslè¯ä¹¦å¹¶é…ç½®å¥½ï¼Œæœ€åå¼€å¯å¼ºåˆ¶Httpså³å¯ã€‚ æœ€ååœ¨åŸŸåç®¡ç†æ‰¾åˆ°åŸŸåå¯¹åº”çš„CNAMEå€¼ï¼Œåœ¨é˜¿é‡Œäº‘ä¸Šé…ç½®åŸŸåè§£æï¼Œç±»å‹ä¸ºCNAMEã€‚ æœ€ååˆ°æ­¤ï¼Œæ•´ä¸ªæµç¨‹ç»“æŸï¼Œç°åœ¨åœ¨MWebçš„èµ„æºåº“å†™ç¬”è®°ï¼Œéœ€è¦å‘åˆ°åšå®¢ä¸Šçš„ç›´æ¥ä¸Šä¼ å›¾åºŠå¤åˆ¶åˆ°å¤–éƒ¨å¼•ç”¨æ¨¡å¼å¯¹åº”mdä¸­ï¼Œç›´æ¥éƒ¨ç½²ç”Ÿæ•ˆã€‚ä¹Ÿä¸éœ€è¦æ‹…å¿ƒå¤‡ä»½ç­‰çªå‘æƒ…å†µï¼ŒMWebæ”¯æŒ3ä¸ªåœ°æ–¹çš„å¤‡ä»½ï¼Œæˆ‘åœ¨Macæœ¬æœºæœ‰å¤‡ä»½ï¼Œåœ¨iCloudç½‘ç›˜ä¹Ÿæœ‰å¤‡ä»½ï¼Œæ°¸è¿œä¸ä¼šæ‹…å¿ƒèµ„æ–™ä¸¢å¤±äº†ï½","link":"/2019/03/18/Hexo2/"},{"title":"Mac IDEAå¯åŠ¨SpringBooté¡¹ç›®è¿‡æ…¢","text":"æœ€è¿‘æœ¬åœ°æ–°èµ·çš„SpringBooté¡¹ç›®è¿è¡Œéå¸¸æ…¢ï¼Œèƒ½æœ‰åå‡ ç§’ï¼Œæœ€åé€šè¿‡ä»¥ä¸‹æ–¹æ³•è¿›è¡Œè§£å†³ï¼Œè§£å†³åè¿è¡Œåœ¨ä¸‰å››ç§’å·¦å³ã€‚ é€šè¿‡hostnameå‘½ä»¤æŸ¥çœ‹æœ¬æœºhostname1$ hostname å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯1MacBook-Pro.local ä¿®æ”¹hostæ–‡ä»¶1sudo vim /etc/hosts ä¿®æ”¹æ¡ç›®å¦‚ä¸‹ï¼Œæ³¨æ„åˆ†éš”ç¬¦æ˜¯TABï¼Œä¸æ˜¯ç©ºæ ¼12127.0.0.1 localhost MacBook-Pro.local::1 localhost MacBook-Pro.local ä¹Ÿå¯ä»¥é€šè¿‡è½¯ä»¶è¿›è¡Œä¿®æ”¹","link":"/2019/05/06/IdeaSpringBoot/"},{"title":"MacOS JDKï¼Œä½¿ç”¨Jenvç®¡ç†æœ¬åœ°JDKç‰ˆæœ¬","text":"MacOSä¸Šé…ç½®JDKç¯å¢ƒï¼ˆé™„å¸¦ä¸‹è½½åœ°å€ï¼‰ï¼Œå¹¶ä½¿ç”¨Jenvå¿«é€Ÿé«˜æ•ˆçš„ç®¡ç†æœ¬åœ°ç¯å¢ƒå˜é‡JDKç‰ˆæœ¬ã€‚ Mac JDKä¸‹è½½ macç‰ˆæœ¬ jdk 1.6 éœ€è¦åˆ°è‹¹æœå¼€å‘è€…ç½‘ç«™ä¸‹è½½ macç‰ˆæœ¬ jdk 1.7 éœ€è¦åˆ°ç½‘ä¸Šæ‰¾èµ„æºï¼Œå®˜æ–¹å·²ç»åœæ­¢jdk 1.7çš„ä¸‹è½½é“¾æ¥ macç‰ˆæœ¬ jdk 1.8 ç›´æ¥åˆ°å®˜æ–¹ç½‘ç«™ä¸‹è½½å³å¯ homebrew ä½¿ç”¨brew install java å®‰è£…ä¼šç›´æ¥å®‰è£…jdk 10ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰ 1brew install java JDKå®‰è£…ç›®å½•å‘½ä»¤æŸ¥è¯¢1/usr/libexec/java_home -V å¸è½½JDKæ‰§è¡Œå‘½ä»¤ï¼š123456789sudo rm -fr ~/Library/Application\\ Support/Javasudo rm -rf /Library/Java/JavaVirtualMachines/jdk&lt;version&gt;.jdksudo rm -rf /Library/PreferencePanes/JavaControlPanel.prefPanesudo rm -fr /Library/PreferencesPanes/JavaControlPanel.prefpanesudo rm -rf /Library/Internet\\ Plug-Ins/JavaAppletPlugin.pluginsudo rm -rf /Library/LaunchAgents/com.oracle.java.Java-Updater.plistsudo rm -rf /Library/PrivilegedHelperTools/com.oracle.java.JavaUpdateHelpersudo rm -rf /Library/LaunchDaemons/com.oracle.java.Helper-Tool.plistsudo rm -rf /Library/Preferences/com.oracle.java.Helper-Tool.plist ä½¿ç”¨Jevnç®¡ç†MacOS JDKJenvæ¦‚è¿°jEnv is a command line tool to help you forget how to set the JAVA_HOME environment variable å®‰è£…ï¼ˆzshä¸‹ï¼‰ä½¿ç”¨homebrewå®‰è£…1brew install jenv æ·»åŠ ç¯å¢ƒå˜é‡12echo &apos;export PATH=&quot;$HOME/.jenv/bin:$PATH&quot;&apos; &gt;&gt; ~/.zshrcecho &apos;eval &quot;$(jenv init -)&quot;&apos; &gt;&gt; ~/.zshrc æ·»åŠ jdkç‰ˆæœ¬ä½¿ç”¨jevn add jdkå®‰è£…è·¯å¾„ï¼Œä¾‹å¦‚ï¼š1jenv add /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home å¸¸ç”¨æ“ä½œæŸ¥çœ‹æ‰€æœ‰æœ¬åœ°jdkç‰ˆæœ¬1$ jenv versions è®¾ç½®å…¨å±€jdkç‰ˆæœ¬1$ jenv global 1.7 è®¾ç½®æœ¬åœ°jdkç‰ˆæœ¬ (å¯ä»¥ä¸ºæ¯ä¸ªæ–‡ä»¶å¤¹å•ç‹¬è®¾ç½®ç‰ˆæœ¬)1$ jenv local 1.8 è®¾ç½®shellä¸­çš„jdkç‰ˆæœ¬1$ jenv shell 1.8 é…ç½®JVM Optionsï¼ˆå…¨å±€ï¼Œæœ¬åœ°ï¼Œshellï¼‰123jenv global-options &quot;-Xmx512m&quot;jenv local-options &quot;-Xmx512m&quot;jenv shell-options &quot;-Xmx512m&quot;","link":"/2018/07/16/MacJDK/"},{"title":"Launchpadå›¾æ ‡ä¿®æ”¹","text":"æœ€è¿‘ä¹°äº†34å¯¸æ›²é¢æ˜¾ç¤ºå™¨ï¼ŒLaunchpadçš„å›¾æ ‡æ˜¾ç¤ºæ¯”è¾ƒåˆ«æ‰­ï¼Œæ‰€ä»¥è°ƒæ•´æ˜¾ç¤ºçš„è¡Œæ•°ä¸åˆ—æ•°ã€‚ è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š è®¾ç½®è¡Œæ•°ä¸åˆ—æ•°123defaults write com.apple.dock springboard-rows -int 4defaults write com.apple.dock springboard-columns -int 7killall Dock æ¢å¤é»˜è®¤è¡Œæ•°ä¸åˆ—æ•°123defaults delete com.apple.dock springboard-rowsdefaults delete com.apple.dock springboard-columnskillall Dock åˆ é™¤å›¾æ ‡åˆ†ç»„è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤æ˜¯åˆ é™¤å›¾æ ‡åˆ†ç»„ï¼ˆçœŸå¿ƒè§‰å¾—è¿™å‘½ä»¤æ²¡å•¥ç”¨ï¼Œæ²¡äº‹å„¿åˆ«ä¹±è¯•ï¼Œé‡æ–°åˆ†ç»„è€éº»çƒ¦äº†ï¼ï¼‰12defaults write com.apple.dock ResetLaunchPad -bool TRUEkillall Dock","link":"/2019/06/05/LaunchpadIcon/"},{"title":"å¾®æœåŠ¡æ¦‚å¿µç±»çŸ¥è¯†","text":"å…³äºCAPç†è®ºCAPå®šç†æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒConsistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œä¸‰è€…ä¸å¯åŒæ—¶è·å¾—ã€‚ ä¸€è‡´æ€§ï¼šCåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»æ˜¯å¦åŒæ ·çš„å€¼ã€‚ï¼ˆæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œè¶Šå¤šèŠ‚ç‚¹ï¼Œæ•°æ®åŒæ­¥è¶Šè€—æ—¶ï¼‰ å¯ç”¨æ€§ï¼šAè´Ÿè½½è¿‡å¤§åï¼Œé›†ç¾¤æ•´ä½“æ˜¯å¦è¿˜èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚ï¼ˆæœåŠ¡ä¸€ç›´å¯ç”¨ï¼Œè€Œä¸”æ˜¯æ­£å¸¸å“åº”æ—¶é—´ï¼‰ åˆ†åŒºå®¹é”™æ€§ï¼šPåˆ†åŒºå®¹å¿æ€§ï¼Œå°±æ˜¯é«˜å¯ç”¨æ€§ï¼Œä¸€ä¸ªèŠ‚ç‚¹å´©äº†ï¼Œå¹¶ä¸å½±å“å…¶å®ƒçš„èŠ‚ç‚¹ï¼ˆ100ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‚äº†å‡ ä¸ªï¼Œä¸å½±å“æœåŠ¡ï¼Œè¶Šå¤šæœºå™¨è¶Šå¥½ï¼‰ CAPç†è®ºå°±æ˜¯è¯´åœ¨åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œæœ€å¤šåªèƒ½å®ç°ä¸Šé¢çš„ä¸¤ç‚¹ã€‚è€Œç”±äºå½“å‰çš„ç½‘ç»œç¡¬ä»¶è‚¯å®šä¼šå‡ºç°å»¶è¿Ÿä¸¢åŒ…ç­‰é—®é¢˜ï¼Œæ‰€ä»¥åˆ†åŒºå®¹å¿æ€§æ˜¯æˆ‘ä»¬å¿…é¡»éœ€è¦å®ç°çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´è¿›è¡Œæƒè¡¡ å…¶ä»–é—®é¢˜ æ»¡è¶³CAï¼Œä¸èƒ½æ»¡è¶³PåŸå› ï¼šæ•°æ®åŒæ­¥(C)éœ€è¦æ—¶é—´ï¼Œä¹Ÿè¦æ­£å¸¸çš„æ—¶é—´å†…å“åº”(A)ï¼Œé‚£ä¹ˆæœºå™¨æ•°é‡å°±è¦å°‘ï¼Œæ‰€ä»¥På°±ä¸æ»¡è¶³ æ»¡è¶³CPï¼Œä¸èƒ½æ»¡è¶³AåŸå› ï¼šæ•°æ®åŒæ­¥(C)éœ€è¦æ—¶é—´, æœºå™¨æ•°é‡ä¹Ÿå¤š(P)ï¼Œä½†æ˜¯åŒæ­¥æ•°æ®éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥ä¸èƒ½å†æ­£å¸¸æ—¶é—´å†…å“åº”ï¼Œæ‰€ä»¥Aå°±ä¸æ»¡è¶³ æ»¡è¶³APï¼Œä¸èƒ½æ»¡è¶³CåŸå› ï¼šæœºå™¨æ•°é‡ä¹Ÿå¤š(P)ï¼Œæ­£å¸¸çš„æ—¶é—´å†…å“åº”(A)ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸èƒ½åŠæ—¶åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œæ‰€ä»¥Cä¸æ»¡è¶³ æ³¨å†Œä¸­å¿ƒé€‰æ‹© Zookeeperï¼šCPè®¾è®¡ï¼Œä¿è¯äº†ä¸€è‡´æ€§ï¼Œé›†ç¾¤æ­å»ºçš„æ—¶å€™ï¼ŒæŸä¸ªèŠ‚ç‚¹å¤±æ•ˆï¼Œåˆ™ä¼šè¿›è¡Œé€‰ä¸¾è¡Œçš„leaderï¼Œæˆ–è€…åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™æ— æ³•æä¾›æœåŠ¡ï¼Œå› æ­¤å¯ç”¨æ€§æ²¡æ³•æ»¡è¶³ Eurekaï¼šAPåŸåˆ™ï¼Œæ— ä¸»ä»èŠ‚ç‚¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œè‡ªåŠ¨åˆ‡æ¢å…¶ä»–èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ï¼Œå»ä¸­å¿ƒåŒ– ç»“è®ºï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­P,è‚¯å®šè¦æ»¡è¶³ï¼Œæ‰€ä»¥åªèƒ½åœ¨CAä¸­äºŒé€‰ä¸€ã€‚æ²¡æœ‰æœ€å¥½çš„é€‰æ‹©ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯æ ¹æ®ä¸šåŠ¡åœºæ™¯æ¥è¿›è¡Œæ¶æ„è®¾è®¡ã€‚ å¦‚æœè¦æ±‚ä¸€è‡´æ€§ï¼Œåˆ™é€‰æ‹©zookeeperï¼Œå¦‚é‡‘èè¡Œä¸šå¦‚æœè¦å»å¯ç”¨æ€§ï¼Œåˆ™Eurekaï¼Œå¦‚ç”µå•†ç³»ç»Ÿ äº‘è®¡ç®—æ¨¡å¼:ä¸‰ç§ä¸»æµæ¨¡å¼ åç§° å…¨ç§° ç¿»è¯‘ PaaS Platform as a Service å¹³å°å³æœåŠ¡ IaaS Infrastructure sa a Service åŸºç¡€è®¾æ–½å³æœåŠ¡ SaaS Software as a Service è½¯ä»¶å³æœåŠ¡ ç»“åˆä¾‹å­ç†è§£åœ¨ã€ŠSpring Microservices in Actionã€‹æœ‰è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼šå½“ä½ æƒ³åƒé¥­æ—¶ï¼Œä½ æœ‰4ç§æ¨¡å¼ï¼š åœ¨å®¶åšé¥­ã€‚ å»æ‚è´§åº—ä¹°ä¸€é¡¿å…ˆåšå¥½çš„é£Ÿç‰©ï¼Œç„¶åä½ åŠ çƒ­å¹¶äº«ç”¨ã€‚ å«å¤–å–é€åˆ°å®¶é‡Œã€‚ å¼€è½¦å»é¤å…åƒé¥­ã€‚ è¿™äº›é€‰æ‹©ä¹‹é—´ä¸»è¦çš„åŒºåˆ«åœ¨äºï¼šè°è´Ÿè´£çƒ¹é¥ªï¼Œä»¥åŠåœ¨å“ªçƒ¹é¥ªã€‚ ä¸Šè¿°ç¬¬ä¸€æ¡ï¼Œæƒ³è¦åœ¨å®¶é‡Œåƒé¥­ï¼Œå°±éœ€è¦è‡ªå·±åšæ‰€æœ‰çš„å·¥ä½œï¼Œå®¶é‡Œçš„é£Ÿæï¼Œå™¨æã€‚ ä¸Šè¿°ç¬¬äºŒæ¡ï¼Œå»å•†åº—ä¹°ï¼Œè‡ªå·±åŠ çƒ­åƒï¼Œæ˜¯ä½¿ç”¨åº—å†…çš„å¨å¸ˆå’Œå™¨æå…ˆåšå¥½é¤ç‚¹ï¼Œä½†ä½ ä»æœ‰è´£ä»»è¦åŠ çƒ­ï¼Œé£Ÿç”¨ï¼Œæ¸…æ´—é¤å…·â€”â€”&gt;IaaSã€‚ ä¸Šè¿°ç¬¬ä¸‰æ¡ï¼Œå¤–å–ï¼Œè‡ªå·±æä¾›ç›˜å­ï¼Œå®¶å…·ï¼Œä½†é¤å…æä¾›çƒ¤ç®±ã€é£Ÿæã€å¨å¸ˆâ€”â€”&gt;PaaS ä¸Šè¿°ç¬¬å››æ¡ï¼Œä½ å»ä¸€ä¸ªé¤å…åƒé¥­ï¼Œä»€ä¹ˆéƒ½ä¸éœ€è¦åšï¼Œä½ å°±æ˜¯ä¾›åº”å•†æ‰€æä¾›æœåŠ¡çš„è¢«åŠ¨æ¶ˆè´¹è€…ï¼Œæ— æ³•å¯¹æŠ€æœ¯è¿›è¡Œé€‰æ‹©ï¼ŒåŒæ—¶æ²¡æœ‰è´£ä»»ç»´æŠ¤åº”ç”¨ç¨‹åºçš„åŸºç¡€è®¾æ–½â€”â€”&gt;SaaS IaaSä¹Ÿå°±æ˜¯åŸºç¡€è®¾æ–½å³æœåŠ¡ï¼ˆInfrastructure-as-a-Serviceï¼‰ï¼Œæ‹¥æœ‰äº†IaaSï¼Œå°±å¯ä»¥å°†å¼•èå¤–åŒ…åˆ°åˆ«çš„åœ°æ–¹å»ã€‚IaaSå…¬å¸ä¼šæä¾›åœºå¤–æœåŠ¡å™¨ï¼Œå­˜å‚¨å’Œç½‘ç»œç¡¬ä»¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç§Ÿç”¨ã€‚èŠ‚çœäº†ç»´æŠ¤æˆæœ¬å’ŒåŠå…¬åœºåœ°ï¼Œå…¬å¸å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åˆ©ç”¨è¿™äº›ç¡¬ä»¶æ¥è¿è¡Œå…¶åº”ç”¨ã€‚ç›®å‰æ¯”è¾ƒçŸ¥åçš„IaaSå…¬å¸æœ‰äºšé©¬é€Šã€Bluelockã€CSCã€GoGridã€IBMç­‰ã€‚ PaaSå³è½¯ä»¶å³æœåŠ¡ï¼ˆPlatform-as-a-Serviceï¼‰ï¼ŒæŸäº›æ—¶å€™ä¹Ÿè¢«å«ä½œä¸­é—´ä»¶ã€‚æ‰€æœ‰çš„å¼€å‘éƒ½å¯ä»¥åœ¨è¿™ä¸€å±‚è¿›è¡Œï¼ŒèŠ‚çœæ—¶é—´ä¸èµ„æºã€‚PaaSå…¬å¸å¯ä»¥æä¾›å„ç§å¼€å‘å’Œåˆ†å‘åº”ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚è™šæ‹ŸæœåŠ¡å™¨å’Œæ“ä½œç³»ç»Ÿç­‰ï¼Œå¯ä»¥èŠ‚çœç¡¬ä»¶ä¸Šçš„è´¹ç”¨ã€‚PaaSå…¬å¸ä¸IaaSå…¬å¸æœ‰è®¸å¤šé‡å ï¼Œé™¤äº†ä¸Šé¢åˆ—å‡ºçš„é‚£äº›ä¹‹å¤–ï¼Œè¿˜æœ‰Googleã€Microsoft Azureã€Force.comã€,Herokuã€Engine Yardç­‰ã€‚ æœ€ååˆ™æ˜¯SaaSï¼Œè½¯ä»¶å³æœåŠ¡ï¼ˆSoftware-as-a-Serviceï¼‰ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç›®å‰æ™®é€šç”¨æˆ·æ¥è§¦æœ€å¤šçš„å±‚é¢ï¼Œåœ¨ç½‘ç»œä¸Šä»»æ„ä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„åº”ç”¨éƒ½æ˜¯å±äºSaaSã€‚æ¯”å¦‚ç°åœ¨é˜¿é‡Œçš„é’‰é’‰ã€JIBUUä»¥åŠè‹¹æœçš„iCloudéƒ½å±äºè¿™ä¸€ç±»ã€‚æ¯”è¾ƒçŸ¥åçš„SaaSå…¬å¸æœ‰Salesforceã€workdayã€Slackç­‰ã€‚ æ–°å…´çš„äº‘å¹³å° FaaS å‡½æ•°å³æœåŠ¡ CaaS å®¹å™¨å³æœåŠ¡ï¼Œä¾‹å¦‚Dockerå¾®æœåŠ¡æ¦‚å¿µçš„é‡ç‚¹åœ¨äº æ„å»º æœ‰é™èŒè´£çš„ å°å‹æœåŠ¡ ï¼Œå¹¶ä½¿ç”¨åŸºäºHTTPçš„æ¥å£è¿›è¡Œé€šè®¯ã€‚FAASã€CaaSæ˜¯éƒ¨ç½²å¾®æœåŠ¡çš„æ›¿ä»£åŸºç¡€è®¾æ–½æœºåˆ¶","link":"/2019/02/01/MicroServices/"},{"title":"MyBatis-Plus","text":"åœ¨æ•´ç†MyBatisæ—¶å€™ï¼ŒMybatisçš„é€†å‘å·¥ç¨‹çš„xmlå®åœ¨æ‡’å¾—å†™ï¼Œæ‰¾ä»£ç ç”Ÿæˆå™¨çš„æ—¶å€™å¬è¯´äº†MyBatis-Plusï¼Œçœ‹äº†çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä»£ç ç”Ÿæˆå™¨æ·±å¾—æˆ‘å¿ƒï¼Œå¯¹ç…§æ–‡æ¡£å­¦ä¹ äº†ä¸‹ï¼Œæ„Ÿè§‰æ•ˆç‡æ¯”MyBatisæå‡ä¸å°‘ã€‚ ç®€ä»‹MyBatis-Plusï¼ˆä»¥ä¸‹ç®€ç§°MPï¼‰æ˜¯ä¸€ä¸ªMyBatisçš„å¢å¼ºå·¥å…·ï¼Œåœ¨MyBatisçš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚ ç‰¹æ€§ æ— ä¾µå…¥ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘ æŸè€—å°ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ å¼ºå¤§çš„ CRUD æ“ä½œï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚ æ”¯æŒ Lambda å½¢å¼è°ƒç”¨ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™ æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜ æ”¯æŒ ActiveRecord æ¨¡å¼ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰ å†…ç½®ä»£ç ç”Ÿæˆå™¨ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨ å†…ç½®åˆ†é¡µæ’ä»¶ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢ åˆ†é¡µæ’ä»¶æ”¯æŒå¤šç§æ•°æ®åº“ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer2005ã€SQLServer ç­‰å¤šç§æ•°æ®åº“ å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶ï¼šå¯è¾“å‡º Sql è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢ å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶ï¼šæä¾›å…¨è¡¨ delete ã€ update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ ä»£ç ç”Ÿæˆå™¨è¯¦ç»†é…ç½®å‚æ•°è¯¦è§ä»£ç ç”Ÿæˆå™¨é…ç½®ï¼Œä»¥ä¸‹ä¸ºæˆ‘çš„ å¸¸ç”¨çš„é…ç½®ã€‚ å…­ç§ConfigDataSourceConfig æ•°æ®æºé…ç½®12345678DataSourceConfig dataSource = new DataSourceConfig();dataSource.setUrl(\"jdbc:mysql://**:**/***?useUnicode=true&amp;characterEncoding=utf-8\") .setDriverName(\"com.mysql.jdbc.Driver\") .setUsername(\"**\") .setPassword(\"**\") //.setSchemaName(\"public\")//å¯ä»¥åœ¨Urlä¸­è®¾ç½® //.setTypeConvert()//è‡ªå®šä¹‰ç±»å‹è½¬æ¢ï¼ˆå†³å®šå¯¹åº”æ•°æ®åº“å†…ç½®å®ç°ï¼‰ .setDbType(DbType.MYSQL);//æ•°æ®åº“ç±»å‹ MPå†…ç½®çš„ç±»å‹è½¬æ¢åœ¨ï¼šcom.baomidou.mybatisplus.generator.config.convertsï¼Œé»˜è®¤æä¾›5ç§æ•°æ®åº“ï¼šä»¥MySqlä¸ºä¾‹å¯ä»¥çœ‹åˆ°æ•°æ®åº“å¯¹åº”ç±»å‹ä¸Javaç±»å‹çš„å¯¹åº”ï¼šå› ä¸ºjdk1.8å¼•å…¥java.time.*æ–°apiï¼Œåœ¨æ—¥æœŸçš„è½¬æ¢ä¸Šæœ‰ä¸ªé€šè¿‡GlobalConfig(å…¨å±€é…ç½®)çš„å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šæ•°æ®åº“æ—¥æœŸç±»å‹å¯¹åº”çš„javaç±»å‹è½¬æ¢ã€‚ StrategyConfig ç­–ç•¥é…ç½®123456789StrategyConfig strategy = new StrategyConfig();strategy.setNaming(NamingStrategy.underline_to_camel)//è¡¨åæ˜ å°„è§„åˆ™ .setColumnNaming(NamingStrategy.underline_to_camel)//å­—æ®µåæ˜ å°„è§„åˆ™ .setEntityLombokModel(false)//ã€å®ä½“ã€‘æ˜¯å¦ä¸ºlombokæ¨¡å‹ï¼ˆé»˜è®¤ false) .setEntityTableFieldAnnotationEnable(true)//å®ä½“ç”Ÿæˆå­—æ®µæ³¨è§£ .setTablePrefix(\"test_\")//è¡¨åå‰ç¼€ .setRestControllerStyle(true)//ç”Ÿæˆ @RestController æ§åˆ¶å™¨ //.setExclude() .setInclude(tableNames);//éœ€è¦åŒ…å«çš„è¡¨åï¼Œå…è®¸æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä¸excludeäºŒé€‰ä¸€é…ç½®)ï¼Œå‚æ•°String...tablename NamingStrategy.underline_to_camelä¸‹åˆ’çº¿è½¬é©¼å³°ï¼ŒNamingStrategy.no_changeä¸åšä»»ä½•æ”¹å˜ï¼ŒåŸæ ·è¾“å‡ºã€‚è¯¦ç»†é…ç½®è§è¿™é‡Œ PackageConfig åŒ…é…ç½®123456789PackageConfig pac = new PackageConfig();pac.setModuleName(modelName)//modelName .setParent(\"com.mkcorden.bootmybatisplus\")//çˆ¶åŒ…åã€‚å¦‚æœä¸ºç©ºï¼Œå°†ä¸‹é¢å­åŒ…åå¿…é¡»å†™å…¨éƒ¨ï¼Œ å¦åˆ™å°±åªéœ€å†™å­åŒ…å .setController(\"controller\") .setService(\"service\") .setServiceImpl(\"service.impl\") .setMapper(\"mapper\") .setEntity(\"domain\") .setXml(\"mapper\"); åŒ…é…ç½®æ—¶å€™å¦‚æœè¦æŒ‰ç…§æ¨¡å—è¿›è¡Œç”ŸæˆåŒºåˆ†ï¼Œä¸€å®šè®¾ç½®modelNameã€‚ServiceImplè®¾ç½®äºŒçº§çš„ç›®å½•éœ€è¦æ³¨æ„ã€‚ TemplateConfig æ¨¡ç‰ˆé…ç½®1234567TemplateConfig templateConfig = new TemplateConfig();// é…ç½®è‡ªå®šä¹‰è¾“å‡ºæ¨¡æ¿// æŒ‡å®šè‡ªå®šä¹‰æ¨¡æ¿è·¯å¾„ï¼Œæ³¨æ„ä¸è¦å¸¦ä¸Š.ftl/.vm, ä¼šæ ¹æ®ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“è‡ªåŠ¨è¯†åˆ«// templateConfig.setEntity(\"templates/entity2.java\");// templateConfig.setService();// templateConfig.setController();templateConfig.setXml(null); å› ä¸ºé™æ€çš„xmlæ–‡ä»¶ä¸€èˆ¬ç”Ÿæˆåœ¨resourcesç›®å½•ä¸‹ï¼Œä½†æ˜¯æŒ‰ä¸Šé¢çš„åŒ…é…ç½®ï¼Œ.xmlçš„mapperä¼šç›´æ¥ç”Ÿæˆåœ¨modelName/mapper/*ä¸‹ï¼Œåœ¨TemplateConfigä¸‹è®¾ç½®xmlä¸ºnullï¼Œåˆ™å¯ä»¥ä¸è¾“å‡ºxmlæ–‡ä»¶ï¼Œç„¶åç”¨è‡ªå®šä¹‰é…ç½®è¿›è¡Œå¯¹åº”è¾“å‡ºã€‚ è®¾ç½®Nullä¸è¾“å‡ºï¼š com.baomidou.mybatisplus.generator.config.builder.ConfigBuilderä¸­ï¼Œtemplate.getXml()ä¸ºNullï¼Œä¸ä¼šè®¾ç½®pathInfo(HashMap)ä¸­Key:xml_pathçš„valueã€‚ åœ¨com.baomidou.mybatisplus.generator.engine.AbstractTemplateEngineçš„batchOutput()æ–¹æ³•,pathInfo.get(ConstVal.XML_PATH)ä¸ºnullï¼Œæ‰€ä»¥ä¸è¿›è¡Œxmlæ–‡ä»¶çš„è¾“å‡ºã€‚ GlobalConfig å…¨å±€é…ç½®12345678910111213141516GlobalConfig gc = new GlobalConfig();gc.setFileOverride(false)//æ–‡ä»¶æ˜¯å¦è¦†ç›–ä¸Šä¸€æ¬¡ .setActiveRecord(false)// å¼€å¯ activeRecord æ¨¡å¼ .setEnableCache(true)// XML äºŒçº§ç¼“å­˜ .setBaseResultMap(true)// XML ResultMap .setBaseColumnList(true)// XML columListåŸºæœ¬çš„Sqlç‰‡æ®µ .setOutputDir(System.getProperty(\"user.dir\")+\"/src/main/java\") .setAuthor(\"MkCorden\") .setServiceName(\"%sService\") .setServiceImplName(\"%sServiceImpl\") .setControllerName(\"%sController\") .setMapperName(\"%sDao\") .setXmlName(\"%sDao\") .setIdType(IdType.UUID) .setOpen(false) .setDateType(DateType.ONLY_DATE);//æ—¥æœŸç±»å‹å­—æ®µå¯¹åº”çš„è½¬æ¢æ¨¡å¼ %sæ˜¯å ä½ç¬¦ DateTypeæœ‰ä¸‰ç§ ONLY_DATE åªä½¿ç”¨ java.util.date ä»£æ›¿ SQL_PACK ä½¿ç”¨ java.sql åŒ…ä¸‹çš„ TIME_PACK ä½¿ç”¨ java.time åŒ…ä¸‹çš„ InjectionConfig è‡ªå®šä¹‰é…ç½®1234567891011121314151617181920212223InjectionConfig cfg = new InjectionConfig() { @Override public void initMap() { //TODO }}; // è‡ªå®šä¹‰è¾“å‡ºé…ç½®List&lt;FileOutConfig&gt; focList = new ArrayList&lt;&gt;();//String projectPath = System.getProperty(\"user.dir\");// è‡ªå®šä¹‰é…ç½®ä¼šè¢«ä¼˜å…ˆè¾“å‡ºfocList.add(new FileOutConfig(\"/templates/mapper.xml.ftl\") { @Override public String outputFile(TableInfo tableInfo) { //é¦–å­—æ¯å°å†™ char[] cs = tableInfo.getEntityName().toCharArray(); cs[0] += 32; // è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å ï¼Œ å¦‚æœä½  Entity è®¾ç½®äº†å‰åç¼€ã€æ­¤å¤„æ³¨æ„ xml çš„åç§°ä¼šè·Ÿç€å‘ç”Ÿå˜åŒ–ï¼ï¼ return System.getProperty(\"user.dir\") + \"/src/main/resources/mapper/\" + String.valueOf(cs) + \"/\" + tableInfo.getEntityName() + \"Dao\" + StringPool.DOT_XML; }});cfg.setFileOutConfigList(focList); /templates/mapper.xml.ftlé»˜è®¤æ¨¡ç‰ˆè·¯å¾„ ä¸Druidé›†æˆé—®é¢˜ åœ¨Druid 1.1.19ç‰ˆæœ¬å·²ç»è§£å†³ ä½¿ç”¨Druidæ—§ç‰ˆæœ¬è¿æ¥æ± ï¼Œåœ¨ä½¿ç”¨MPä»£ç ç”Ÿæˆå™¨å°†æ—¶é—´ç±»å‹å­—æ®µæ˜ å°„åˆ°jdk1.8çš„java.time.*æ—¶ï¼Œè¿›è¡Œæ•°æ®åº“æ“ä½œå¯¹åº”å­—æ®µä¼šæŠ¥java.sql.SQLFeatureNotSupportedExceptionï¼ŒåŸå› å…·ä½“issueè§ druid:3393 / mybatis-plus:1245ï¼Œè§£å†³åŠæ³•åˆä¸¤ä¸ªï¼š åœ¨MPçš„GlobalConfigä¸­è®¾ç½®.setDateType(DateType.ONLY_DATE)ï¼Œå¼ºåˆ¶æŠŠæ‰€æœ‰æ—¶é—´ç±»å‹è½¬æ¢ä¸ºDateã€‚ å°†MPç‰ˆæœ¬å°†åˆ°3.1.0å³å¯ã€‚ å› ä¸ºåœ¨MP ver.3.1.1åŠ å…¥äº†åˆ†å¸ƒå¼äº‹åŠ¡ç‰¹æ€§ï¼Œå†ä¸€ä¸ªä½¿ç”¨æ–°çš„æ—¶é—´æ ¼å¼ä¼šé€ æˆä¸å¯çŸ¥çš„å…¶ä»–ç¬¬ä¸‰æ–¹æ’ä»¶ä¸æ”¯æŒï¼Œç»¼ä¸Šæˆ‘é€‰ç¬¬ä¸€ç§ï¼Œå“ˆå“ˆã€‚ æ³¨è§£ä½¿ç”¨MPè‡ªå¸¦ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆçš„Domainç±»ä¼šæœ‰@TableName @TableId @TableFieldæ³¨è§£ã€‚åŒæ—¶MPä¹Ÿæä¾›äº†å¦‚@Versionï¼ˆä¹è§‚é”ä¸­ä»£è¡¨ç‰ˆæœ¬ï¼‰@TableLogicï¼ˆé€»è¾‘åˆ é™¤ä¸­ä½¿ç”¨)ï¼Œä¸‹é¢ç®€å•ä»‹ç»å‡ ä¸ªæ³¨è§£ï¼Œè¯¦ç»†è¯·å‚è€ƒå®˜ç½‘æ–‡æ¡£ @TableName12@TableName(value = \"test_subject\",resultMap = \"BaseResultMap\")public class Subject implements Serializable { valueï¼šæŒ‡å®šæ•°æ®åº“ä¸­çš„è¡¨å resultMapï¼šæŒ‡å®šxmlä¸­ResultMapçš„id keepGlobalPrefixï¼š falseï¼ˆé»˜è®¤ï¼‰ï¼šå¦‚æœæ˜¯ false , å…¨å±€çš„ tablePrefix ä¸ç”Ÿæ•ˆ @TableId12@TableId(value = \"subject_id\", type = IdType.AUTO)private Long subjectId; ç”¨äºæ³¨è§£ä¸»é”®å¯¹åº”çš„å±æ€§å€¼ valueï¼šæŒ‡å®šä¸»é”®å­—æ®µå typeï¼šæŒ‡å®šä¸»é”®çš„ç±»å‹ AUTOï¼šæ•°æ®åº“è‡ªå¢ INPUTï¼šè‡ªè¡Œè¾“å…¥ ID_WORKERï¼šåˆ†å¸ƒå¼å…¨å±€å”¯ä¸€ID é•¿æ•´å‹ç±»å‹ UUIDï¼š32ä½UUIDå­—ç¬¦ä¸² NONEï¼šæ— çŠ¶æ€ ID_WORKER_STRï¼šåˆ†å¸ƒå¼å…¨å±€å”¯ä¸€ID å­—ç¬¦ä¸²ç±»å‹ @TableField12@TableField(value = \"sup_subject_id\", fill = FieldFill.INSERT)private String supSubjectId; ç”¨äºæ³¨è§£é™¤ä¸»é”®ä»¥å¤–å…¶ä»–å±æ€§ valueï¼šæŒ‡å®šå¯¹åº”æ•°æ®åº“å­—æ®µå fillï¼šè‡ªåŠ¨å¡«å……ç­–ç•¥ DEFAULTï¼šé»˜è®¤ä¸å¤„ç† INSERTï¼šæ’å…¥æ—¶å¡«å……å­—æ®µ UPDATEï¼šæ›´æ–°æ—¶å¡«å……å­—æ®µ INSERT_UPDATEï¼šæ’å…¥å’Œæ›´æ–°æ—¶å¡«å……å­—æ®µ å…¶ä»–é…ç½®è§å®˜æ–¹æ–‡æ¡£ ï¼ˆå…¬å…±å­—æ®µï¼‰é»˜è®¤å¡«å……ä½¿ç”¨é»˜è®¤å¡«å……ç‰¹æ€§ï¼Œé¦–å…ˆè¦åœ¨@TableFieldæ³¨è§£å†…é…ç½®fillå±æ€§ï¼Œç„¶åéœ€è¦å®ç°MetaObjectHandleræ¥å£ï¼Œè¿›è¡Œè‡ªå®šä¹‰è‡ªåŠ¨å¡«å……æ—¶å€™çš„èµ‹å€¼ã€‚ æ³¨æ„ï¼šå½“å­—æ®µä¸ä¸ºç©ºæ—¶ï¼Œé»˜è®¤å¡«å……çš„å€¼ä¼šè¦†ç›–åŸæœ‰å€¼ã€‚å¯ä»¥åœ¨å¡«å……æ—¶å€™è¿›è¡Œåˆ¤æ–­ï¼Œä¸ä¸ºç©ºæ—¶å€™è¿›è¡Œå¡«å……ï¼ˆæœ‰ç‚¹åƒæ•°æ®åº“é»˜è®¤å€¼ï¼‰ï¼Œä½†æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšã€‚å› ä¸ºæ¯æ¬¡insertå’Œupdateæ“ä½œéƒ½ä¼šæ‰§è¡Œæˆ‘ä»¬å®ç°çš„æ¥å£ï¼Œæ‰€ä»¥è¯¥ç‰¹æ€§æœ€å¥½ç”¨äºå…¬å…±å­—æ®µçš„é»˜è®¤å¡«å……ã€‚ 12345678910111213141516171819202122232425@Componentpublic class MyMetaObjectHandler implements MetaObjectHandler { /** * æ’å…¥å…ƒå¯¹è±¡å­—æ®µå¡«å……ï¼ˆç”¨äºæ’å…¥æ—¶å¯¹å…¬å…±å­—æ®µçš„å¡«å……ï¼‰ * * @param metaObject å…ƒå¯¹è±¡ */ @Override public void insertFill(MetaObject metaObject) { System.out.println(\"-----------------æ’å…¥æ–¹æ³•å®ä½“å¡«å……INSERT----------------\"); setFieldValByName(\"classOverDate\", LocalDate.now().plusDays(60), metaObject); setFieldValByName(\"supSubjectId\", \"-1\", metaObject); } /** * æ›´æ–°å…ƒå¯¹è±¡å­—æ®µå¡«å……ï¼ˆç”¨äºæ›´æ–°æ—¶å¯¹å…¬å…±å­—æ®µçš„å¡«å……ï¼‰ * * @param metaObject å…ƒå¯¹è±¡ */ @Override public void updateFill(MetaObject metaObject) { System.out.println(\"-----------------æ’å…¥æ–¹æ³•å®ä½“å¡«å……UPDATE----------------\"); setFieldValByName(\"classOverDate\", LocalDate.now().plusDays(70), metaObject); }} åˆ†é¡µæ’ä»¶åˆ†é¡µæ—¶å€™å¦‚æœè®¾ç½®pageSize = -1åˆ™ä¸è¿›è¡Œåˆ†é¡µï¼Œå¦‚æœè¦è¿›è¡Œæ’åºåˆ†é¡µï¼Œä¼ å‚æ•°æ—¶ï¼Œå°†æ’åºæ¡ä»¶å°è£…å³å¯ï¼ŒMPåœ¨Pageå¯¹è±¡ä¸­å·²ç»å°è£…å¥½äº†1234 /** * æ’åºå­—æ®µä¿¡æ¯ */private List&lt;OrderItem&gt; orders = new ArrayList&lt;&gt;(); 12345678910public class OrderItem { /** * éœ€è¦è¿›è¡Œæ’åºçš„å­—æ®µ */ private String column; /** * æ˜¯å¦æ­£åºæ’åˆ—ï¼Œé»˜è®¤ true */ private boolean asc = true; è¯·æ±‚ï¼š å…·ä½“ä½¿ç”¨ é…ç½® 12345678910/** * åˆ†é¡µæ’ä»¶ */@Beanpublic PaginationInterceptor paginationInterceptor() { PaginationInterceptor paginationInterceptor = new PaginationInterceptor(); //ä½ çš„æœ€å¤§å•é¡µé™åˆ¶æ•°é‡ï¼Œé»˜è®¤ 500 æ¡ï¼Œå°äº 0 å¦‚ -1 ä¸å—é™åˆ¶ // paginationInterceptor.setLimit(500); return paginationInterceptor;} ä½¿ç”¨ 1234567891011121314 /** * åˆ†é¡µ * @return */@GetMapping(\"students/page\")public ResponseEntity searchByPage(Page&lt;Student&gt; student_page, boolean listMode){ if (listMode) { // size å°äº 0 ä¸åœ¨æŸ¥è¯¢ total åŠåˆ†é¡µï¼Œè‡ªåŠ¨è°ƒæ•´ä¸ºåˆ—è¡¨æ¨¡å¼ã€‚ // æ³¨æ„ï¼ï¼è¿™ä¸ªåœ°æ–¹è‡ªå·±æ§åˆ¶å¥½ï¼ï¼ student_page.setSize(-1); } IPage&lt;Student&gt; pageStudent = studentService.page(student_page); return ResponseUtil.pageSuccess(pageStudent.getTotal(),pageStudent.getRecords());} æ€§èƒ½åˆ†æå™¨12345678@Bean//@Profile({\"dev\",\"test\"})// è®¾ç½® dev test ç¯å¢ƒå¼€å¯public PerformanceInterceptor performanceInterceptor() { PerformanceInterceptor performanceInterceptor = new PerformanceInterceptor(); performanceInterceptor.setMaxTime(1000);// æœ€å¤§æ‰§è¡Œæ—¶é—´ performanceInterceptor.setFormat(true);// sqlæ˜¯å¦æ ¼å¼åŒ– return performanceInterceptor;} æ§åˆ¶å°æ•ˆæœï¼š é»˜è®¤æ¥å£CURDé€šè¿‡MPçš„ä»£ç æ„é€ å™¨ç”Ÿæˆçš„Serviceå’ŒDaoæ–‡ä»¶ï¼Œå·²ç»é»˜è®¤ç»§æ‰¿äº†com.baomidou.mybatisplus.extension.service.impl.ServiceImplå’Œcom.baomidou.mybatisplus.core.mapper.BaseMapper,åœ¨è¿™ä¸¤æ–‡ä»¶ä¸­MPå·²ç»é»˜è®¤å¸®æˆ‘ä»¬å®ç°äº†ä¸€äº›CRUDæ–¹æ³•ã€‚ Mapper CURDæ¥å£åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è§£æå®ä½“è¡¨å…³ç³»æ˜ å°„è½¬æ¢ä¸ºMybatiså†…éƒ¨å¯¹è±¡æ³¨å…¥å®¹å™¨ã€‚ Service CRUDæ¥å£è¿›ä¸€æ­¥å°è£…CRUDï¼Œé‡‡ç”¨getæŸ¥è¯¢å•è¡Œremoveåˆ é™¤listæŸ¥è¯¢é›†åˆpageåˆ†é¡µï¼Œå‰ç¼€å‘½åæ–¹å¼åŒºåˆ†Mapperå±‚é¿å…æ··æ·†ã€‚ ä¸šåŠ¡ServiceImplç»§æ‰¿äº†MPçš„ServiceImplï¼Œå¹¶æ³¨å…¥åˆ°Controllerå±‚ï¼Œæ‰€ä»¥åœ¨Controllerå±‚ï¼Œå¯¹äºç®€å•çš„ä¸šåŠ¡ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨å¯¹åº”æ–¹æ³•è¿›è¡Œè¿”å›ã€‚ æ¡ä»¶æ„é€ å™¨Wrapperå› ä¸ºä½¿ç”¨Jdk1.8ï¼Œæ”¯æŒlambdaè¡¨è¾¾å¼ï¼Œä¸»è¦æ˜¯ç”¨å„ç§LambdaWrapperã€‚å¯¹äºåœ¨RPCæ¨¡å¼ä¸­ï¼Œä¸å»ºè®®ä¼ è¾“Wrapperï¼Œå› ä¸ºWrapperå¾ˆé‡ã€‚æ­£ç¡®çš„æ–¹å¼æ˜¯å°è£…DTOè¿›è¡Œä¼ è¾“ï¼Œåœ¨æ¥æ”¶ç«¯æ ¹æ®æ¥æ”¶åˆ°çš„DTOè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ ä½¿ç”¨ä¸­å¦‚æœå…¥å‚çš„Mapæˆ–è€…Listä¸ºç©º,åˆ™ä¸ä¼šåŠ å…¥æœ€åç”Ÿæˆçš„sqlä¸­!!! LambdaQueryWrapper123456789@GetMapping(\"students/search\")public ResponseEntity searchByCondition(@ModelAttribute StudentModel student_model){ //æœ€å¥½ä½¿ç”¨LambdaQueryWrapper,è¿™æ ·å¯ä»¥é€šè¿‡Student::getTrueNameæ–¹å¼è·å–æ•°æ®åº“å­—æ®µå //ä½¿ç”¨æ­£å¸¸çš„QueryWrapperï¼Œéœ€è¦å†™æ­»å­—æ®µåå¦‚\"true_name\"æ‰å¯ä»¥ return ResponseUtil.success(studentService.list(new QueryWrapper&lt;Student&gt;() .lambda() .like(Student::getTrueName,student_model.getTrueName()) .between(Student::getBirthday,student_model.getBeginDate(),student_model.getEndDate())));} ä¸Šé¢ä»£ç ä¸­Student::getBirthdayï¼ŒStudentä¸ºå®ä½“ç±»ï¼ŒgetBirthdayæ˜¯birthdayå­—æ®µçš„getMethod é€šè¿‡QueryWrapperçš„.lambda()æ–¹æ³•è½¬æ¢ä¸ºLambdaQueryWrapperï¼Œè¿™æ ·å¯ä»¥ä¸ç”¨å°†å­—æ®µåå†™æ­»ï¼Œå› ä¸ºMPåœ¨å¤„ç†LambdaQueryWrapperæ—¶å€™ä¼šé€šè¿‡columnToString()æ¥è½¬æ¢ä¸ºæ•°æ®åº“ä¸­çš„å­—æ®µåã€‚ å¦‚æœä¸èƒ½ä½¿ç”¨Lambdaç‰¹æ€§ï¼ŒæŒ‡å®šå­—æ®µæ—¶å€™ï¼Œä¸€å®šè¦å†™æ•°æ®åº“ä¸­çš„å­—æ®µåã€‚ä¸è¦å†™å®ä½“ç±»çš„å±æ€§åã€‚ LambdaUpdateWrapperè·ŸQueryWrapperç›¸ä¼¼ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œåœ¨è®¾ç½®SETæ—¶å€™ï¼Œè¦è¿›è¡Œéç©ºåˆ¤æ–­ï¼ˆæœ€å¥½ç›´æ¥ä½¿ç”¨å·²ç»å°è£…çš„UpdateByIDï¼‰ï¼Œå› ä¸ºï¼š ä¾‹: set(â€œnameâ€, â€œâ€)â€”&gt;æ•°æ®åº“å­—æ®µå€¼å˜ä¸ºç©ºå­—ç¬¦ä¸² ä¾‹: set(â€œnameâ€, null)â€”&gt;æ•°æ®åº“å­—æ®µå€¼å˜ä¸ºnull SQLæ³¨å…¥å™¨ ä¸ åˆ†è¡¨åˆ†åº“å¾…å®Œæˆâ€¦ æ€»ç»“Mybatis-Plusçš„è¯¸å¤šç‰¹æ€§ï¼Œåœ¨å¼€å‘ä¸­å¤§å¤§å‡å°‘äº†æ— æ„ä¹‰Codingçš„æ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›ä¸ç¡®å®šæ€§ï¼Œå’Œå°‘é‡çš„å­¦ä¹ æˆæœ¬ã€‚æœ¬æ–‡å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä»£ç å·²å°†ä¸Šä¼ åˆ°GitHubä¸Šï¼Œé“¾æ¥åœ¨è¿™â€”â€”&gt;","link":"/2019/08/13/MabtisPlus/"},{"title":"Redis Cluster","text":"ä»Redis 3.0ä»¥åå®˜æ–¹æ¨å‡ºäº†Clusterçš„é›†ç¾¤æ–¹æ¡ˆï¼Œå¤§å¤§å¢å¼ºäº†Redisæ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚åœ¨æ­¤ä¹‹å‰å·²ç»æœ‰ç¬¬ä¸‰æ–¹Redisé›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œå¦‚Twemproxyï¼ˆTwitterå¼€æºï¼‰ï¼ŒCodisç­‰ã€‚Clusterä¸è¿™äº›åŒºåˆ«æ˜¯å¹¶éä½¿ç”¨Porxyæ¨¡å¼æ¥è¿æ¥é›†ç¾¤èŠ‚ç‚¹ï¼Œè€Œæ˜¯ä½¿ç”¨æ— ä¸­å¿ƒèŠ‚ç‚¹çš„æ¨¡å¼æ¥ç»„å»ºé›†ç¾¤ï¼Œåœ¨Clusterä¹‹å‰ï¼Œåªæœ‰Sentienlä¿è¯äº†Redisçš„é«˜å¯ç”¨æ€§ã€‚ Clusterå®ç°äº†å¤šä¸ªèŠ‚ç‚¹çš„æ•°æ®å…±äº«ï¼Œå³ä½¿éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼ŒClusterä»å¯ä»¥ç»§ç»­å¤„ç†è¯·æ±‚ã€‚æ¯ä¸ªä¸»èŠ‚ç‚¹è‡³å°‘æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå½“ä¸»æœºèŠ‚ç‚¹å®•æœºç­‰ä¸å¯ç”¨æƒ…å†µï¼Œä»èŠ‚ç‚¹ä¼šæå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶è‡ªåŠ¨å¼€å§‹æä¾›æœåŠ¡ã€‚ Clusterçš„èŠ‚ç‚¹åˆ†é…æ˜¯é€šè¿‡å“ˆå¸Œæ§½å®ç°çš„ï¼ˆHash Slotï¼‰ï¼Œæ‰€æœ‰keyå€¼éƒ½å±äº16384ä¸ªå“ˆå¸Œæ§½å…¶ä¸­ä¸€ä¸ªï¼ŒClusteræ¨¡å¼ä¸­ï¼Œæ¯ä¸€ä¸ªä¸»èŠ‚ç‚¹éƒ½ä¼šåˆ†é…å¤„ç†ä¸€å®šèŒƒå›´çš„slotã€‚ Redis ClusterCAP CAPå®šç†ï¼šæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒConsistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œä¸‰è€…ä¸å¯åŒæ—¶è·å¾—ã€‚ä¸€è‡´æ€§(C)ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»æ˜¯å¦åŒæ ·çš„å€¼ã€‚ï¼ˆæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œè¶Šå¤šèŠ‚ç‚¹ï¼Œæ•°æ®åŒæ­¥è¶Šè€—æ—¶ï¼‰å¯ç”¨æ€§(A)ï¼šè´Ÿè½½è¿‡å¤§åï¼Œé›†ç¾¤æ•´ä½“æ˜¯å¦è¿˜èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚ï¼ˆæœåŠ¡ä¸€ç›´å¯ç”¨ï¼Œè€Œä¸”æ˜¯æ­£å¸¸å“åº”æ—¶é—´ï¼‰åˆ†åŒºå®¹é”™æ€§(P)ï¼šåˆ†åŒºå®¹å¿æ€§ï¼Œå°±æ˜¯é«˜å¯ç”¨æ€§ï¼Œä¸€ä¸ªèŠ‚ç‚¹å´©äº†ï¼Œå¹¶ä¸å½±å“å…¶å®ƒçš„èŠ‚ç‚¹ï¼ˆ100ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‚äº†å‡ ä¸ªï¼Œä¸å½±å“æœåŠ¡ï¼Œè¶Šå¤šæœºå™¨è¶Šå¥½ï¼‰ å¯¹äºå•ä¸€èŠ‚ç‚¹çš„Redisï¼Œä¿è¯äº†CPç‰ºç‰²äº†Aï¼Œå³Redisèƒ½å¤Ÿä¿è¯æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°ç›¸åŒçš„æ•°æ®ï¼ˆä¸€è‡´æ€§ï¼Œå› ä¸ºRedisä¸è‡ªåŠ¨å†—ä½™æ•°æ®ï¼‰å’Œç½‘ç»œé€šä¿¡å‡ºé—®é¢˜æ—¶ï¼Œæš‚æ—¶éš”ç¦»å¼€çš„å­ç³»ç»Ÿèƒ½ç»§ç»­è¿è¡Œï¼ˆåˆ†åŒºå®¹å¿æ€§ï¼Œå› ä¸ºMasterä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä¸éœ€è¦é€šä¿¡ï¼‰ï¼Œä½†æ˜¯ä¸ä¿è¯æŸäº›ç»“ç‚¹æ•…éšœæ—¶ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½èƒ½è¢«å“åº”ï¼ˆå¯ç”¨æ€§ï¼ŒæŸä¸ªMasterç»“ç‚¹æŒ‚äº†çš„è¯ï¼Œé‚£ä¹ˆå®ƒä¸Šé¢åˆ†ç‰‡çš„æ•°æ®å°±æ— æ³•è®¿é—®äº†ï¼‰ã€‚ å¯¹äºClusterï¼ŒRedisä»å•ä¸€NOSQLå†…å­˜æ•°æ®åº“å˜ä¸ºåˆ†å¸ƒå¼NOSQLæ•°æ®åº“ï¼Œä»CPå˜æˆäº†APã€‚å³é€šè¿‡è‡ªåŠ¨åˆ†ç‰‡å’Œå†—ä½™æ•°æ®ï¼ŒRediså…·æœ‰äº†çœŸæ­£çš„åˆ†å¸ƒå¼èƒ½åŠ›ï¼ŒæŸä¸ªç»“ç‚¹æŒ‚äº†çš„è¯ï¼Œå› ä¸ºæ•°æ®åœ¨å…¶ä»–ç»“ç‚¹ä¸Šæœ‰å¤‡ä»½ï¼Œæ‰€ä»¥å…¶ä»–ç»“ç‚¹é¡¶ä¸Šæ¥å°±å¯ä»¥ç»§ç»­æä¾›æœåŠ¡ï¼Œä¿è¯äº†Availabilityã€‚ç„¶è€Œï¼Œä¹Ÿæ­£å› ä¸ºè¿™ä¸€ç‚¹ï¼ŒRedisæ— æ³•ä¿è¯æ›¾ç»çš„å¼ºä¸€è‡´æ€§äº†ã€‚ Redis Clusterç‰¹ç‚¹ å»ä¸­å¿ƒã€å»ä¸­é—´ä»¶ï¼Œå„èŠ‚ç‚¹å¹³ç­‰ï¼Œä¿å­˜å„è‡ªæ•°æ®å’Œé›†ç¾¤çŠ¶æ€ï¼ŒèŠ‚ç‚¹é—´æ´»è·ƒäº’è¿ã€‚ ä¼ ç»Ÿç”¨ä¸€è‡´æ€§å“ˆå¸Œåˆ†é…æ•°æ®ï¼Œé›†ç¾¤ç”¨å“ˆå¸Œæ§½ï¼ˆhash slotï¼‰åˆ†é…ã€‚ ç®—æ³•ä¸ºCRC16ã€‚ é»˜è®¤åˆ†é…16384ä¸ªslotï¼Œ ç”¨CRC16ç®—æ³•å–æ¨¡{ CRC16(key)%16384 }è®¡ç®—æ‰€å±slotã€‚ æœ€å°‘3ä¸ªä¸»èŠ‚ç‚¹ Redis Clusterä¼˜ç‚¹ å®˜æ–¹è§£å†³æ–¹æ¡ˆ å¯ä»¥åœ¨çº¿æ°´å¹³æ‰©å±•ï¼ˆTwemproxyçš„ä¸€å¤§å¼Šç«¯å°±æ˜¯ä¸æ”¯æŒåœ¨çº¿æ‰©å®¹èŠ‚ç‚¹ï¼‰ å®¢æˆ·ç«¯ç›´è¿ï¼Œç³»ç»Ÿç“¶é¢ˆæ›´å°‘ æ— ä¸­å¿ƒæ¶æ„ æ”¯æŒæ•°æ®åˆ†ç‰‡ redis-cliä»£æ›¿redis-trib.rbredis 5.0ç‰ˆæœ¬åä¼šæŠ›å¼ƒredis-trib.rbã€‚ç›´æ¥ä½¿ç”¨redis-cliå®¢æˆ·ç«¯å®ç°é›†ç¾¤ç®¡ç†ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536redis-cli --cluster helpCluster Manager Commands: create host1:port1 ... hostN:portN #åˆ›å»ºé›†ç¾¤ --cluster-replicas &lt;arg&gt; #ä»èŠ‚ç‚¹ä¸ªæ•° check host:port #æ£€æŸ¥é›†ç¾¤ --cluster-search-multiple-owners #æ£€æŸ¥æ˜¯å¦æœ‰æ§½åŒæ—¶è¢«åˆ†é…ç»™äº†å¤šä¸ªèŠ‚ç‚¹ info host:port #æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ fix host:port #ä¿®å¤é›†ç¾¤ --cluster-search-multiple-owners #ä¿®å¤æ§½çš„é‡å¤åˆ†é…é—®é¢˜ reshard host:port #æŒ‡å®šé›†ç¾¤çš„ä»»æ„ä¸€èŠ‚ç‚¹è¿›è¡Œè¿ç§»slotï¼Œé‡æ–°åˆ†slots --cluster-from &lt;arg&gt; #éœ€è¦ä»å“ªäº›æºèŠ‚ç‚¹ä¸Šè¿ç§»slotï¼Œå¯ä»å¤šä¸ªæºèŠ‚ç‚¹å®Œæˆè¿ç§»ï¼Œä»¥é€—å·éš”å¼€ï¼Œä¼ é€’çš„æ˜¯èŠ‚ç‚¹çš„node idï¼Œè¿˜å¯ä»¥ç›´æ¥ä¼ é€’--from allï¼Œè¿™æ ·æºèŠ‚ç‚¹å°±æ˜¯é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥ --cluster-to &lt;arg&gt; #slotéœ€è¦è¿ç§»çš„ç›®çš„èŠ‚ç‚¹çš„node idï¼Œç›®çš„èŠ‚ç‚¹åªèƒ½å¡«å†™ä¸€ä¸ªï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥ --cluster-slots &lt;arg&gt; #éœ€è¦è¿ç§»çš„slotæ•°é‡ï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥ã€‚ --cluster-yes #æŒ‡å®šè¿ç§»æ—¶çš„ç¡®è®¤è¾“å…¥ --cluster-timeout &lt;arg&gt; #è®¾ç½®migrateå‘½ä»¤çš„è¶…æ—¶æ—¶é—´ --cluster-pipeline &lt;arg&gt; #å®šä¹‰cluster getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œä¸ä¼ çš„è¯ä½¿ç”¨é»˜è®¤å€¼ä¸º10 --cluster-replace #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹ rebalance host:port #æŒ‡å®šé›†ç¾¤çš„ä»»æ„ä¸€èŠ‚ç‚¹è¿›è¡Œå¹³è¡¡é›†ç¾¤èŠ‚ç‚¹slotæ•°é‡ --cluster-weight &lt;node1=w1...nodeN=wN&gt; #æŒ‡å®šé›†ç¾¤èŠ‚ç‚¹çš„æƒé‡ --cluster-use-empty-masters #è®¾ç½®å¯ä»¥è®©æ²¡æœ‰åˆ†é…slotçš„ä¸»èŠ‚ç‚¹å‚ä¸ï¼Œé»˜è®¤ä¸å…è®¸ --cluster-timeout &lt;arg&gt; #è®¾ç½®migrateå‘½ä»¤çš„è¶…æ—¶æ—¶é—´ --cluster-simulate #æ¨¡æ‹Ÿrebalanceæ“ä½œï¼Œä¸ä¼šçœŸæ­£æ‰§è¡Œè¿ç§»æ“ä½œ --cluster-pipeline &lt;arg&gt; #å®šä¹‰cluster getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œé»˜è®¤å€¼ä¸º10 --cluster-threshold &lt;arg&gt; #è¿ç§»çš„sloté˜ˆå€¼è¶…è¿‡thresholdï¼Œæ‰§è¡Œrebalanceæ“ä½œ --cluster-replace #æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹ add-node new_host:new_port existing_host:existing_port #æ·»åŠ èŠ‚ç‚¹ï¼ŒæŠŠæ–°èŠ‚ç‚¹åŠ å…¥åˆ°æŒ‡å®šçš„é›†ç¾¤ï¼Œé»˜è®¤æ·»åŠ ä¸»èŠ‚ç‚¹ --cluster-slave #æ–°èŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹ï¼Œé»˜è®¤éšæœºä¸€ä¸ªä¸»èŠ‚ç‚¹ --cluster-master-id &lt;arg&gt; #ç»™æ–°èŠ‚ç‚¹æŒ‡å®šä¸»èŠ‚ç‚¹ del-node host:port node_id #åˆ é™¤ç»™å®šçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæˆåŠŸåå…³é—­è¯¥èŠ‚ç‚¹æœåŠ¡ call host:port command arg arg .. arg #åœ¨é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œç›¸å…³å‘½ä»¤ set-timeout host:port milliseconds #è®¾ç½®cluster-node-timeout import host:port #å°†å¤–éƒ¨redisæ•°æ®å¯¼å…¥é›†ç¾¤ --cluster-from &lt;arg&gt; #å°†æŒ‡å®šå®ä¾‹çš„æ•°æ®å¯¼å…¥åˆ°é›†ç¾¤ --cluster-copy #migrateæ—¶æŒ‡å®šcopy --cluster-replace #migrateæ—¶æŒ‡å®šreplace help Dockeréƒ¨ç½²é…ç½®æ–‡ä»¶redis.conf12345678910port 7001 # 3ä¸»3ä»åˆ†åˆ«ä¸º7000ï½7006requirepass 123456masterauth 123456daemonize no # dockeréƒ¨ç½²ä¸ºnocluster-enabled yescluster-config-file node-17-7001.conf # é›†ç¾¤é…ç½®æ–‡ä»¶ï¼Œé¦–æ¬¡å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆcluster-announce-ip 10.211.55.17cluster-announce-port 7001cluster-announce-bus-port 17001 å¯åŠ¨å®¹å™¨123456docker run -d -it --privileged=true -v /media/psf/Linux/df/redis/cluster-config/redis11.conf:/etc/redis/redis.conf --privileged=true -v /var/df/cluster-redis/cluster1/data:/data --restart always --name cluster11 --net=host --sysctl net.core.somaxconn=1024 redis:5.0.5 redis-server /etc/redis/redis.conf --appendonly yesdocker run -d -it --privileged=true -v /media/psf/Linux/df/redis/cluster-config/redis12.conf:/etc/redis/redis.conf --privileged=true -v /var/df/cluster-redis/cluster2/data:/data --restart always --name cluster12 --net=host --sysctl net.core.somaxconn=1024 redis:5.0.5 redis-server /etc/redis/redis.conf --appendonly yesdocker run -d -it --privileged=true -v /media/psf/Linux/df/redis/cluster-config/redis13.conf:/etc/redis/redis.conf --privileged=true -v /var/df/cluster-redis/cluster3/data:/data --restart always --name cluster13 --net=host --sysctl net.core.somaxconn=1024 redis:5.0.5 redis-server /etc/redis/redis.conf --appendonly yesdocker run -d -it --privileged=true -v /media/psf/Linux/df/redis/cluster-config/redis14.conf:/etc/redis/redis.conf --privileged=true -v /var/df/cluster-redis/cluster4/data:/data --restart always --name cluster14 --net=host --sysctl net.core.somaxconn=1024 redis:5.0.5 redis-server /etc/redis/redis.conf --appendonly yesdocker run -d -it --privileged=true -v /media/psf/Linux/df/redis/cluster-config/redis15.conf:/etc/redis/redis.conf --privileged=true -v /var/df/cluster-redis/cluster5/data:/data --restart always --name cluster15 --net=host --sysctl net.core.somaxconn=1024 redis:5.0.5 redis-server /etc/redis/redis.conf --appendonly yesdocker run -d -it --privileged=true -v /media/psf/Linux/df/redis/cluster-config/redis16.conf:/etc/redis/redis.conf --privileged=true -v /var/df/cluster-redis/cluster6/data:/data --restart always --name cluster16 --net=host --sysctl net.core.somaxconn=1024 redis:5.0.5 redis-server /etc/redis/redis.conf --appendonly yes è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ é˜²ç«å¢™è®¾ç½®12345678910111213firewall-cmd --permanent --add-port=7001/tcp firewall-cmd --permanent --add-port=7002/tcp firewall-cmd --permanent --add-port=7003/tcp firewall-cmd --permanent --add-port=7004/tcp firewall-cmd --permanent --add-port=7005/tcp firewall-cmd --permanent --add-port=7006/tcpfirewall-cmd --permanent --add-port=17001/tcp firewall-cmd --permanent --add-port=17002/tcp firewall-cmd --permanent --add-port=17003/tcp firewall-cmd --permanent --add-port=17004/tcp firewall-cmd --permanent --add-port=17005/tcp firewall-cmd --permanent --add-port=17006/tcp firewall-cmd --reload é€šè¿‡redis-cliå»ºç«‹é›†ç¾¤1/usr/local/bin/redis-cli -a 123456 --cluster create 10.211.55.17:7001 10.211.55.17:7002 10.211.55.17:7003 10.211.55.17:7004 10.211.55.17:7005 10.211.55.17:7006 --cluster-replicas 1 éªŒè¯è‡³æ­¤Clusterå°±æ­å»ºå®Œæ¯•äº†ã€‚ æŸ¥çœ‹Clusteræ‰€æœ‰èŠ‚ç‚¹ç™»é™†Clusterä»»æ„èŠ‚ç‚¹ï¼Œä½¿ç”¨cluster nodes ,åˆ—å‡ºé›†ç¾¤å½“å‰å·²çŸ¥çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆnodeï¼‰ï¼Œä»¥åŠè¿™äº›èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°7001èŠ‚ç‚¹çš„slotä¸º0-5460,7002ä¸º5461-10922ï¼Œ7003ä¸º10923-16383 Redis Clusterå¤„ç†æµç¨‹ æ£€æŸ¥Keyæ‰€åœ¨Slotæ˜¯å¦å±äºå½“å‰Nodeï¼Ÿ è®¡ç®—crc16(key) % 16384å¾—åˆ°Slot æŸ¥è¯¢clusterState.slotsè´Ÿè´£Slotçš„ç»“ç‚¹æŒ‡é’ˆ ä¸myselfæŒ‡é’ˆæ¯”è¾ƒ è‹¥ä¸å±äºï¼Œåˆ™å“åº”MOVEDé”™è¯¯é‡å®šå‘å®¢æˆ·ç«¯ è‹¥å±äºä¸”Keyå­˜åœ¨ï¼Œåˆ™ç›´æ¥æ“ä½œï¼Œè¿”å›ç»“æœç»™å®¢æˆ·ç«¯ è‹¥Keyä¸å­˜åœ¨ï¼Œæ£€æŸ¥è¯¥Slotæ˜¯å¦è¿å‡ºä¸­ï¼Ÿ(clusterState.migrating_slots_to) è‹¥Slotè¿å‡ºä¸­ï¼Œè¿”å›ASKé”™è¯¯é‡å®šå‘å®¢æˆ·ç«¯åˆ°è¿ç§»çš„ç›®çš„æœåŠ¡å™¨ä¸Š è‹¥Slotæœªè¿å‡ºï¼Œæ£€æŸ¥Slotæ˜¯å¦å¯¼å…¥ä¸­ï¼Ÿ(clusterState.importing_slots_from) è‹¥Slotå¯¼å…¥ä¸­ä¸”æœ‰ASKINGæ ‡è®°ï¼Œåˆ™ç›´æ¥æ“ä½œ å¦åˆ™å“åº”MOVEDé”™è¯¯é‡å®šå‘å®¢æˆ·ç«¯ Redis Clusterçš„failoveræ£€æµ‹ä¸€èˆ¬åœ°ï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘é€PINGæ•°æ®åŒ…ï¼ŒåŒæ—¶ä¹Ÿæ€»æ˜¯åº”ç­”ï¼ˆacceptï¼‰æ¥è‡ªé›†ç¾¤è¿æ¥ç«¯å£çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶å¯¹æ¥æ”¶åˆ°çš„PINGæ•°æ®åŒ…è¿›è¡Œå›å¤ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹å‘å¦ä¸€ä¸ªèŠ‚ç‚¹å‘PINGå‘½ä»¤ï¼Œä½†æ˜¯ç›®æ ‡èŠ‚ç‚¹æœªèƒ½åœ¨ç»™å®šçš„æ—¶é™ï¼ˆnode timeoutï¼‰å†…å›å¤æ—¶ï¼Œé‚£ä¹ˆå‘é€å‘½ä»¤çš„èŠ‚ç‚¹ä¼šå°†ç›®æ ‡èŠ‚ç‚¹æ ‡è®°ä¸ºPFAILï¼ˆpossible failureï¼‰ã€‚ ç”±äºèŠ‚ç‚¹é—´çš„äº¤äº’æ€»æ˜¯ä¼´éšç€ä¿¡æ¯ä¼ æ’­çš„åŠŸèƒ½ï¼Œæ­¤æ—¶æ¯æ¬¡å½“èŠ‚ç‚¹å¯¹å…¶ä»–èŠ‚ç‚¹å‘é€ PING å‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šå‘ŠçŸ¥ç›®æ ‡èŠ‚ç‚¹æ­¤æ—¶é›†ç¾¤ä¸­å·²ç»è¢«æ ‡è®°ä¸ºPFAILæˆ–è€…FAILæ ‡è®°çš„èŠ‚ç‚¹ã€‚ç›¸åº”çš„ï¼Œå½“èŠ‚ç‚¹æ¥æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹å‘æ¥çš„ä¿¡æ¯æ—¶ï¼Œ å®ƒä¼šè®°ä¸‹é‚£äº›è¢«å…¶ä»–èŠ‚ç‚¹æ ‡è®°ä¸ºå¤±æ•ˆçš„èŠ‚ç‚¹ã€‚ è¿™ç§°ä¸ºå¤±æ•ˆæŠ¥å‘Šï¼ˆfailure reportï¼‰ã€‚ å¦‚æœèŠ‚ç‚¹å·²ç»å°†æŸä¸ªèŠ‚ç‚¹æ ‡è®°ä¸ºPFAILï¼Œå¹¶ä¸”æ ¹æ®èŠ‚ç‚¹æ‰€æ”¶åˆ°çš„å¤±æ•ˆæŠ¥å‘Šæ˜¾å¼ï¼Œé›†ç¾¤ä¸­çš„å¤§éƒ¨åˆ†å…¶ä»–ä¸»èŠ‚ç‚¹ï¼ˆn/2+1ï¼‰ä¹Ÿè®¤ä¸ºé‚£ä¸ªèŠ‚ç‚¹è¿›å…¥äº†å¤±æ•ˆçŠ¶æ€ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ä¼šå°†é‚£ä¸ªPFAILèŠ‚ç‚¹çš„çŠ¶æ€æ ‡è®°ä¸ºFAILã€‚ ä¸€æ—¦æŸä¸ªèŠ‚ç‚¹è¢«æ ‡è®°ä¸ºFAILï¼Œå…³äºè¿™ä¸ªèŠ‚ç‚¹å·²å¤±æ•ˆçš„ä¿¡æ¯å°±ä¼šè¢«å¹¿æ’­åˆ°æ•´ä¸ªé›†ç¾¤ï¼Œæ‰€æœ‰æ¥æ”¶åˆ°è¿™æ¡ä¿¡æ¯çš„èŠ‚ç‚¹éƒ½ä¼šå°†å¤±æ•ˆèŠ‚ç‚¹æ ‡è®°ä¸ºFAILã€‚ é€‰ä¸¾ä¸€æ—¦æŸä¸ªä¸»èŠ‚ç‚¹è¿›å…¥ FAIL çŠ¶æ€ï¼Œ é›†ç¾¤å˜ä¸ºFAILçŠ¶æ€ï¼ŒåŒæ—¶ä¼šè§¦å‘failoverã€‚failoverçš„ç›®çš„æ˜¯ä»ä»èŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä½¿å¾—é›†ç¾¤æ¢å¤æ­£å¸¸ç»§ç»­æä¾›æœåŠ¡ã€‚æ•´ä¸ªä¸»èŠ‚ç‚¹é€‰ä¸¾çš„è¿‡ç¨‹å¯åˆ†ä¸ºç”³è¯·ã€æˆæƒã€å‡çº§ã€åŒæ­¥å››ä¸ªé˜¶æ®µï¼š ç”³è¯· æ–°çš„ä¸»èŠ‚ç‚¹ç”±åŸå·²å¤±æ•ˆçš„ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ä»èŠ‚ç‚¹ä¸­è‡ªè¡Œé€‰ä¸¾äº§ç”Ÿï¼Œä»èŠ‚ç‚¹çš„é€‰ä¸¾éµå¾ªä»¥ä¸‹æ¡ä»¶ï¼š è¿™ä¸ªèŠ‚ç‚¹æ˜¯å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼› å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹è´Ÿè´£å¤„ç†çš„å“ˆå¸Œæ§½æ•°é‡éç©ºï¼› ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„å¤åˆ¶è¿æ¥çš„æ–­çº¿æ—¶é•¿æœ‰é™ï¼Œä¸è¶…è¿‡ ( (node-timeout * slave-validity-factor) + repl-ping-slave-period ï¼‰ã€‚ å¦‚æœä¸€ä¸ªä»èŠ‚ç‚¹æ»¡è¶³äº†ä»¥ä¸Šçš„æ‰€æœ‰æ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªä»èŠ‚ç‚¹å°†å‘é›†ç¾¤ä¸­çš„å…¶ä»–ä¸»èŠ‚ç‚¹å‘é€æˆæƒè¯·æ±‚ï¼Œè¯¢é—®å®ƒä»¬æ˜¯å¦å…è®¸è‡ªå·±å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹å‘é€æˆæƒè¯·æ±‚çš„æ—¶æœºä¼šæ ¹æ®å„ä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹çš„æ•°æ®åå·®æ¥è¿›è¡Œæ’åºï¼Œè®©åå·®å°çš„ä»èŠ‚ç‚¹ä¼˜å…ˆå‘èµ·æˆæƒè¯·æ±‚ã€‚ æˆæƒå…¶ä»–ä¸»èŠ‚ç‚¹ä¼šéµä¿¡ä»¥ä¸‹ä¸‰ç‚¹æ ‡å‡†æ¥è¿›è¡Œåˆ¤æ–­ï¼š å‘é€æˆæƒè¯·æ±‚çš„æ˜¯ä»èŠ‚ç‚¹ï¼Œè€Œä¸”å®ƒæ‰€å±çš„ä¸»èŠ‚ç‚¹å¤„äºFAILçŠ¶æ€ ï¼› ä»èŠ‚ç‚¹çš„currentEpochã€‰è‡ªèº«çš„currentEpochï¼Œä»èŠ‚ç‚¹çš„configEpoch&gt;=è‡ªèº«ä¿å­˜çš„è¯¥ä»èŠ‚ç‚¹çš„configEpochï¼› è¿™ä¸ªä»èŠ‚ç‚¹å¤„äºæ­£å¸¸çš„è¿è¡ŒçŠ¶æ€ï¼Œæ²¡æœ‰è¢«æ ‡è®°ä¸ºFAILæˆ–PFAILçŠ¶æ€ï¼› å¦‚æœå‘é€æˆæƒè¯·æ±‚çš„ä»èŠ‚ç‚¹æ»¡è¶³ä»¥ä¸Šæ ‡å‡†ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å°†åŒæ„ä»èŠ‚ç‚¹çš„å‡çº§è¦æ±‚ï¼Œå‘ä»èŠ‚ç‚¹è¿”å›CLUSTERMSG_TYPE_FAILOVER_AUTH_ACKæˆæƒã€‚ å‡çº§ ä¸€æ—¦æŸä¸ªä»èŠ‚ç‚¹åœ¨ç»™å®šçš„æ—¶é™å†…å¾—åˆ°å¤§éƒ¨åˆ†ä¸»èŠ‚ç‚¹ï¼ˆn/2+1ï¼‰çš„æˆæƒï¼Œå®ƒå°±ä¼šæ¥ç®¡æ‰€æœ‰ç”±å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹è´Ÿè´£å¤„ç†çš„å“ˆå¸Œæ§½ï¼Œå¹¶ä¸»åŠ¨å‘å…¶ä»–èŠ‚ç‚¹å‘é€ä¸€ä¸ªPONGæ•°æ®åŒ…ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š å‘ŠçŸ¥å…¶ä»–èŠ‚ç‚¹è‡ªå·±ç°åœ¨æ˜¯ä¸»èŠ‚ç‚¹äº† å‘ŠçŸ¥å…¶ä»–èŠ‚ç‚¹è‡ªå·±æ˜¯ä¸€ä¸ªROMOTED SLAVEï¼Œå³å·²å‡çº§çš„ä»èŠ‚ç‚¹ï¼› å‘ŠçŸ¥å…¶ä»–èŠ‚ç‚¹éƒ½æ ¹æ®è‡ªå·±æ–°çš„èŠ‚ç‚¹å±æ€§ä¿¡æ¯å¯¹é…ç½®è¿›è¡Œç›¸åº”çš„æ›´æ–° åŒæ­¥ å…¶ä»–èŠ‚ç‚¹åœ¨æ¥æ”¶åˆ°ROMOTED SLAVEçš„å‘ŠçŸ¥åï¼Œä¼šæ ¹æ®æ–°çš„ä¸»èŠ‚ç‚¹å¯¹é…ç½®è¿›è¡Œç›¸åº”çš„æ›´æ–°ã€‚ç‰¹åˆ«åœ°ï¼Œå…¶ä»–ä»èŠ‚ç‚¹ä¼šå°†æ–°çš„ä¸»èŠ‚ç‚¹è®¾ä¸ºè‡ªå·±çš„ä¸»èŠ‚ç‚¹ï¼Œä»è€Œä¸æ–°çš„ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®åŒæ­¥ã€‚è‡³æ­¤ï¼Œfailoverç»“æŸï¼Œé›†ç¾¤æ¢å¤æ­£å¸¸çŠ¶æ€ã€‚ æ­¤æ—¶ï¼Œå¦‚æœåŸä¸»èŠ‚ç‚¹æ¢å¤æ­£å¸¸ï¼Œä½†ç”±äºå…¶çš„configEpochå°äºå…¶ä»–èŠ‚ç‚¹ä¿å­˜çš„configEpochï¼ˆfailoveräº†äº§ç”Ÿè¾ƒå¤§çš„configEpochï¼‰ï¼Œæ•…å…¶é…ç½®ä¼šè¢«æ›´æ–°ä¸ºæœ€æ–°é…ç½®ï¼Œå¹¶å°†è‡ªå·±è®¾æ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚ å¦å¤–ï¼Œåœ¨failoverè¿‡ç¨‹ä¸­ï¼Œå¦‚æœåŸä¸»èŠ‚ç‚¹æ¢å¤æ­£å¸¸ï¼Œfailoverä¸­æ­¢ï¼Œä¸ä¼šäº§ç”Ÿæ–°çš„ä¸»èŠ‚ç‚¹ã€‚ åœ¨çº¿è¿ç§»åœ¨10.211.55.19çš„7000ï½7006æœ‰ä¸€å¥—clusterï¼ˆ3ä¸»3ä»ï¼‰ï¼Œç°åœ¨è¿ç§»åˆ°10.211.55.17ä¸Š è¿ç§»å‰ï¼š ä¸» ä» 10.211.55.19:7001 10.211.55.19:7004 10.211.55.19:7002 10.211.55.19:7005 10.211.55.19:7003 10.211.55.19:7006 è¿ç§»åï¼š ä¸» ä» 10.211.55.17:7001 10.211.55.17:7004 10.211.55.17:7002 10.211.55.17:7005 10.211.55.17:7003 10.211.55.17:7006 è¿ç§»å‰çŠ¶æ€ æ·»åŠ ä¸»èŠ‚ç‚¹123./redis-cli -a 123456 --cluster add-node 10.211.55.17:7001 10.211.55.19:7001./redis-cli -a 123456 --cluster add-node 10.211.55.17:7002 10.211.55.19:7001./redis-cli -a 123456 --cluster add-node 10.211.55.17:7003 10.211.55.19:7001 ä½¿ç”¨./redis-cli -a 123456 --cluster check 10.211.55.19:7001æŸ¥çœ‹çŠ¶æ€å‘ç°å·²ç»å°†3ä¸ªèŠ‚ç‚¹åŠ å…¥clusteré›†ç¾¤ï¼Œä½†æ˜¯æ²¡æœ‰åˆ†é…ä»»ä½•slotã€‚ æ·»åŠ æ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹æˆ‘ä»¬åˆ†åˆ«ä¸º10.211.55.17ä¸Š7001ï½7003å¢åŠ ä»èŠ‚ç‚¹7004ï½700612345./redis-cli -a javaee12 --cluster add-node 10.211.55.17:7004 10.211.55.19:7001 --cluster-slave --cluster-master-id b13675b85b05d4fd2c430fb78b3998ebbf777295./redis-cli -a javaee12 --cluster add-node 10.211.55.17:7005 10.211.55.19:7001 --cluster-slave --cluster-master-id 3cf5fd50477d4a35931c18073967f672308712d7./redis-cli -a javaee12 --cluster add-node 10.211.55.17:7006 10.211.55.19:7001 --cluster-slave --cluster-master-id 1c3a2b8460e0a2d8abb3d716bcafe48d9644dba3 æŸ¥çœ‹ç°åœ¨é›†ç¾¤çŠ¶æ€ä¸‰ä¸ªslaveèŠ‚ç‚¹å·²ç»åŠ ä¸Š è¿›è¡Œè¿ç§»12345# åç»­å¡«çš„è¿ç§»slotä¼šä»ç°æœ‰èŠ‚ç‚¹éšæœºæŠ½å–./redis-cli -a javaee12 --cluster reshard 10.211.55.19:7001# å°†ä¸€ä¸ªèŠ‚ç‚¹çš„å®šé‡slotè¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹./redis-cli -a javaee12 --cluster reshard 10.211.55.19:7001 --cluster-from bd8be2765f1ea9be8abf86e55d72ce77eda59a70 --cluster-to 3cf5fd50477d4a35931c18073967f672308712d7 --cluster-slots 3641 --cluster-yes --cluster-timeout 5000 --cluster-pipeline 10 åˆ é™¤æ—§èŠ‚ç‚¹1./redis-cli -a 123456 --cluster del-node 10.211.55.19:7003 45e24c18dfd00d7f460faeb66ddbc6506612c8de åˆ é™¤masterä¸»èŠ‚ç‚¹æ—¶éœ€æ³¨æ„ä¸‹é¢å‡ ç‚¹ï¼š å¦‚æœä¸»èŠ‚ç‚¹æœ‰ä»èŠ‚ç‚¹ï¼Œéœ€è¦å°†ä»èŠ‚ç‚¹è½¬ç§»åˆ°å…¶ä»–ä¸»èŠ‚ç‚¹æˆ–æå‰åˆ é™¤ä»èŠ‚ç‚¹ã€‚ å¦‚æœä¸»èŠ‚ç‚¹æœ‰slotï¼Œå»æ‰åˆ†é…çš„slotï¼Œç„¶åå†åˆ é™¤ä¸»èŠ‚ç‚¹ã€‚ é‡æ–°åˆ†é…åˆ é™¤å®ŒèŠ‚ç‚¹åï¼Œå‘ç°slotå¹¶ä¸å¹³å‡ï¼Œæˆ‘ä»¬è¿›è¡Œrebalanceã€‚1./redis-cli -a 123456 --cluster rebalance 10.211.55.17:7001 SpringBootä½¿ç”¨Cluster Redisé…ç½®æ–‡ä»¶1234567891011121314spring: redis: jedis: pool: max-active: 10 max-wait: 10000 max-idle: 10 min-idle: 0 cluster: max-redirects: 3 nodes: 10.211.55.19:7001 10.211.55.19:7002 10.211.55.19:7003 10.211.55.19:7004 10.211.55.19:7005 10.211.55.19:7006 password: 123456 ssl: false timeout: 10000 RedisConfig.java1234@Value(\"${spring.redis.cluster.max-redirects}\")private int maxRedirects;@Value(\"${spring.redis.cluster.nodes}\")private String nodes; 1234567891011RedisClusterConfiguration redisConfig = new RedisClusterConfiguration();redisConfig.setMaxRedirects(maxRedirects);String[] cNodes = nodes.split(\" \");List&lt;RedisNode&gt; nodes = new ArrayList&lt;&gt;();for(String node : cNodes){ String[] hp = node.split(\":\"); nodes.add(new RedisNode(hp[0],Integer.parseInt(hp[1])));}redisConfig.setClusterNodes(nodes);redisConfig.setPassword(RedisPassword.of(password));","link":"/2019/10/24/RedisCluster/"},{"title":"åˆé‡Redis","text":"ä»€ä¹ˆæ˜¯Redisè®²åˆ°redisä¸å¾—ä¸è®²NoSql NoSQLæ˜¯ä¸åŒäºä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç»Ÿç§°ã€‚å…¶ä¸¤è€…æœ€é‡è¦çš„åŒºåˆ«æ˜¯NoSQLä¸ä½¿ç”¨SQLä½œä¸ºæŸ¥è¯¢è¯­è¨€ã€‚ NoSQLæ•°æ®å­˜å‚¨å¯ä»¥ä¸éœ€è¦å›ºå®šçš„è¡¨æ ¼æ¨¡å¼ã€‚NoSQLæ˜¯åŸºäºé”®å€¼å¯¹çš„ï¼Œå¯ä»¥æƒ³è±¡æˆè¡¨ä¸­çš„ä¸»é”®å’Œå€¼çš„å¯¹åº”å…³ç³»ã€‚ NoSQLï¼šredisã€memcachedã€mongodbã€guavaï¼ˆloadingCacheï¼‰ Redisæ˜¯ä»€ä¹ˆRedis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚ å®ƒæ”¯æŒå¤š ç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ã€æ•£åˆ—ï¼ˆhashesï¼‰ã€ åˆ—è¡¨ï¼ˆlistsï¼‰ã€ é›†åˆï¼ˆsetsï¼‰ã€ æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ç­‰ã€‚ å¯¹æ¯”Mysqlå…³ç³»å‹æ•°æ®åº“çš„ä¸€ä¸ªå¸¸è§ç”¨æ³•æ˜¯å­˜å‚¨é•¿æœŸçš„æŠ¥å‘Šæ•°æ®ï¼Œå¹¶å°†è¿™äº›æŠ¥å‘Šæ•°æ®ç”¨ä½œå›ºå®šæ—¶é—´èŒƒå›´å†…çš„èšåˆæ•°æ®ã€‚æ”¶é›†èšåˆæ•°æ®çš„å¸¸è§åšæ³•æ˜¯ï¼šå…ˆå°†å„ä¸ªè¡Œæ’å…¥ä¸€ä¸ªæŠ¥å‘Šè¡¨é‡Œé¢ï¼Œ ä¹‹åå†é€šè¿‡æ‰«æè¿™äº›è¡Œæ¥æ”¶é›†èšåˆæ•°æ®ï¼Œ å¹¶æ›´æ–°èšåˆè¡¨ä¸­å·³æœ‰çš„é‚£äº›è¡Œã€‚å…ˆæ¥çœ‹çœ‹Mysqlçš„æ‰§è¡Œæµç¨‹å›¾ï¼š æ·»åŠ ç´¢å¼•æ˜¯åœ¨æœ€åä¸€æ­¥ï¼šæ‰§è¡Œå¼•æ“ä¸­å‘æŒ¥ä½œç”¨ã€‚ å½“æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå‘½ä¸­ç¼“å­˜Cacheæ—¶å€™ï¼Œæ‰æ˜¯æœ€å¿«çš„ã€‚è€ŒRedisæ˜¯ä¸€ä¸ªå†…å­˜ç¼“å­˜å·¥å…·ï¼Œå¯ä»¥é€šè¿‡å†…å­˜è¿”å›æ•°æ®ç»“æœï¼Œä¸ç”¨è¿›è¡Œè¡¨æŸ¥è¯¢ï¼Œæ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚å› ä¸ºç£ç›˜è®¡ç®—æ˜¯è¿œè¿œæ¯”ä¸ä¸Šå†…å­˜è®¡ç®—çš„ã€‚ç£ç›˜æ˜¯è¦è¿›è¡Œä¸€ä¸ªå…¨è¡¨æ‰«æï¼Œæ•°æ®æ˜¯æŒä¹…åŒ–çš„ã€‚ å¯¹æ¯”Memcachedå†…å­˜ç®¡ç†æœºåˆ¶ Memcachedé»˜è®¤ä½¿ç”¨Slab Allocationæœºåˆ¶ç®¡ç†å†…å­˜ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯æŒ‰ç…§é¢„å…ˆè§„å®šçš„å¤§å°ï¼Œ å°†åˆ†é…çš„å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å— ä»¥å­˜å‚¨ç›¸åº”é•¿åº¦çš„key-valueæ•°æ®è®°å½•ï¼Œä»¥å®Œå…¨è§£å†³å†…å­˜ç¢ ç‰‡é—®é¢˜ã€‚ç©ºé—²åˆ—è¡¨è¿›è¡Œåˆ¤æ–­å­˜å‚¨çŠ¶æ€,ã€ç±»ä¼¼äºJavaè™šæ‹Ÿæœºå¯¹è±¡çš„åˆ†é…ï¼Œç©ºé—²åˆ—è¡¨ã€‘ Redisä½¿ç”¨ç°åœºç”³è¯·å†…å­˜çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”å¾ˆå°‘ä½¿ç”¨free-listç­‰æ–¹å¼æ¥ä¼˜åŒ–å†…å­˜åˆ†é…ï¼Œä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå­˜åœ¨å†…å­˜ç¢ç‰‡,ã€CPUå†…å­˜æ˜¯è¿ç»­ï¼Œç±»ä¼¼äºJavaè™šæ‹Ÿæœºå¯¹è±¡çš„åˆ†é…ï¼Œç›´æ¥å†…å­˜åˆ†é…ï¼ˆæŒ‡é’ˆç¢°æ’ï¼‰ã€‘ Memcachedä¸ªäººæ„Ÿè§‰å°±æ˜¯å°†å†…å­˜ç¢ç‰‡å˜æˆäº†å†…å­˜çš„æµªè´¹ã€‚ redisä½œè€…å¯èƒ½ä¸ºäº†æ›´é«˜çš„æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨redisä¸­å®ç°äº†è‡ªå·±çš„å†…å­˜åˆ†é…å™¨æ¥ç®¡ç†å†…å­˜ï¼Œä¸ä¼šé©¬ä¸Šè¿”è¿˜å†…å­˜ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å‘OSç”³è¯·äº†ï¼Œä»è€Œå®ç°é«˜æ€§èƒ½ã€‚ä½†æ˜¯redisçš„æ¯ä¸ªk-vå¯¹åˆå§‹åŒ–çš„å†…å­˜å¤§å°æ˜¯æœ€é€‚åˆçš„ï¼Œå½“è¿™ä¸ªvalueæ”¹å˜çš„å¹¶ä¸”åŸæ¥å†…å­˜å¤§å°ä¸é€‚ç”¨çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡æ–°åˆ†é…å†…å­˜äº†ã€‚ï¼ˆä½†æ˜¯valueå­˜æ¯”åŸæ¥å°ä¸çŸ¥é“ä¼šä¸ä¼šäº§ç”Ÿç¢ç‰‡ï¼‰ã€‚é‡æ–°åˆ†é…ä¹‹åï¼Œå°±ä¼šæœ‰ä¸€éƒ¨åˆ†å†…å­˜redisæ— æ³•æ­£å¸¸å›æ”¶ï¼Œä¸€ç›´å ç”¨ç€ã€‚è§£å†³æ–¹æ¡ˆï¼š é‡å¯redisæœåŠ¡ï¼Œç®€å•ç²—æš´ã€‚ 4.0ä»¥åæ¸…ç†ï¼šï¼ˆè‡ªåŠ¨ï¼‰redis-cli -p 6379 config set activedefrag yes 4.0ä»¥åæ¸…ç†ï¼šï¼ˆæ‰‹åŠ¨ï¼‰redis-cli -p 6379 memory purge æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ memcachedä¸æ”¯æŒå†…å­˜æ•°æ®çš„æŒä¹…åŒ–æ“ä½œï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä»¥in-memoryçš„å½¢å¼å­˜å‚¨ã€‚ redisæ”¯æŒæŒä¹…åŒ–æ“ä½œã€‚redisæä¾›äº†ä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹æ³•æ¥è®²æ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜é‡Œé¢ï¼Œ ç¬¬ä¸€ç§æ˜¯rdbå½¢å¼ï¼Œä¸€ç§æ˜¯aofå½¢å¼ rdbï¼šå±äºå…¨é‡æ•°æ®å¤‡ä»½ï¼Œå¤‡ä»½çš„æ˜¯æ•°æ® aofï¼šappend only if,å¢é‡æŒä¹…åŒ–å¤‡ä»½ï¼Œå¤‡ä»½çš„æ˜¯æŒ‡ä»¤ ç¼“å­˜æ•°æ®è¿‡æœŸæœºåˆ¶ æ¦‚å¿µï¼škeyï¼Œè®¾è®¡ä¸€ä¸ªå°æ—¶ä¹‹åè¿‡æœŸï¼Œè¶…è¿‡ä¸€ä¸ªå°æ—¶æŸ¥æ•°æ®å°±ä¼šæŸ¥ä¸åˆ° Memcached åœ¨åˆ é™¤å¤±æ•ˆä¸»é”®æ—¶ä¹Ÿæ˜¯é‡‡ç”¨çš„æ¶ˆææ–¹æ³•ï¼Œå³ Memcached å†…éƒ¨ä¹Ÿä¸ä¼šç›‘è§†ä¸»é”®æ˜¯å¦å¤±æ•ˆï¼Œè€Œæ˜¯åœ¨é€šè¿‡ Get è®¿é—®ä¸»é”®æ—¶æ‰ä¼šæ£€æŸ¥å…¶æ˜¯å¦å·²ç»å¤±æ•ˆ Redis å®šæ—¶ã€å®šæœŸç­‰å¤šç§ç¼“å­˜å¤±æ•ˆæœºåˆ¶ï¼Œå‡å°‘å†…å­˜æ³„æ¼ æ”¯æŒçš„æ•°æ®ç±»å‹ Memcachedæ”¯æŒå•ä¸€æ•°æ®ç±»å‹,[k,v] redisæ”¯æŒäº”ç§æ•°æ®ç±»å‹ Redisæ•°æ®ç±»å‹æ“ä½œKey/Valueç±»å‹ç®€ä»‹ï¼š Stringæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œæ™®é€šçš„key/valueå­˜å‚¨éƒ½å¯ä»¥å½’ä¸ºæ­¤ç±»ã€‚ set/get è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºStringç±»å‹çš„value è·å–keyå¯¹åº”çš„å€¼ mget æ‰¹é‡è·å–å¤šä¸ªkeyçš„å€¼ï¼Œå¦‚æœå¯ä»¥ä¸å­˜åœ¨åˆ™è¿”å›nil incr &amp;&amp; incrby incrå¯¹keyå¯¹åº”çš„å€¼è¿›è¡ŒåŠ åŠ æ“ä½œï¼Œå¹¶è¿”å›æ–°çš„å€¼;incrbyåŠ æŒ‡å®šå€¼ incr &amp;&amp; incrby incrå¯¹keyå¯¹åº”çš„å€¼è¿›è¡ŒåŠ åŠ æ“ä½œï¼Œå¹¶è¿”å›æ–°çš„å€¼;incrbyåŠ æŒ‡å®šå€¼ setnx è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºStringç±»å‹çš„valueï¼Œå¦‚æœkeyå·²ç»å­˜åœ¨åˆ™è¿”å›0 setex è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºStringç±»å‹çš„valueï¼Œå¹¶è®¾å®šæœ‰æ•ˆæœŸ å…¶ä»–å‘½ä»¤ getrange è·å–keyå¯¹åº”valueçš„å­å­—ç¬¦ä¸² mset æ‰¹é‡è®¾ç½®å¤šä¸ªkeyçš„å€¼ï¼Œå¦‚æœæˆåŠŸè¡¨ç¤ºæ‰€æœ‰å€¼éƒ½è¢«è®¾ç½®ï¼Œå¦åˆ™è¿”å›0è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼è¢«è®¾ç½® msetnxï¼ŒåŒmsetï¼Œä¸å­˜åœ¨å°±è®¾ç½®ï¼Œä¸ä¼šè¦†ç›–å·²æœ‰çš„key getset è®¾ç½®keyçš„å€¼ï¼Œå¹¶è¿”å›keyæ—§çš„å€¼ appendï¼šç»™æŒ‡å®škeyçš„valueè¿½åŠ å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›æ–°å­—ç¬¦ä¸²çš„é•¿åº¦ Hashç±»å‹ Hashæ˜¯ä¸€ä¸ªStringç±»å‹çš„fieldå’Œvalueä¹‹é—´çš„æ˜ å°„è¡¨ redisçš„Hashæ•°æ®ç±»å‹çš„keyï¼ˆhashè¡¨åç§°ï¼‰å¯¹åº”çš„valueå®é™…çš„å†…éƒ¨å­˜å‚¨ç»“æ„ä¸ºä¸€ä¸ªHashMap Hashç‰¹åˆ«é€‚åˆå­˜å‚¨å¯¹è±¡ ç›¸å¯¹äºæŠŠä¸€ä¸ªå¯¹è±¡çš„æ¯ä¸ªå±æ€§å­˜å‚¨ä¸ºStringç±»å‹ï¼Œå°†æ•´ä¸ªå¯¹è±¡å­˜å‚¨åœ¨Hashç±»å‹ä¸­ä¼šå ç”¨æ›´å°‘å†…å­˜ã€‚ æ‰€å­˜å‚¨çš„æˆå‘˜è¾ƒå°‘æ—¶æ•°æ®å­˜å‚¨ä¸ºzipmapï¼Œå½“æˆå‘˜æ•°é‡å¢å¤§æ—¶ä¼šè‡ªåŠ¨è½¬æˆçœŸæ­£çš„HashMap,æ­¤æ—¶encodingä¸ºhtã€‚ è¿ç”¨åœºæ™¯ï¼š å¦‚ç”¨ä¸€ä¸ªå¯¹è±¡æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ï¼Œè®¢å•ä¿¡æ¯ç­‰ç­‰ã€‚ Hashå‘½ä»¤è®²è§£ hsetâ€”â€”è®¾ç½®keyå¯¹åº”çš„HashMapä¸­çš„fieldçš„value hgetâ€”â€”è·å–keyå¯¹åº”çš„HashMapä¸­çš„fieldçš„value hgetallâ€”â€”è·å–keyå¯¹åº”çš„HashMapä¸­çš„æ‰€æœ‰fieldçš„value hlenâ€“è¿”å›keyå¯¹åº”çš„HashMapä¸­çš„fieldçš„æ•°é‡ Listç±»å‹ lpushâ€”â€”åœ¨keyå¯¹åº”çš„listçš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå…ƒç´  lrangeâ€”â€”è·å–keyå¯¹åº”çš„listçš„æŒ‡å®šä¸‹æ ‡èŒƒå›´çš„å…ƒç´ ï¼Œ-1è¡¨ç¤ºè·å–æ‰€æœ‰å…ƒç´  lpopâ€”â€”ä»keyå¯¹åº”çš„listçš„å°¾éƒ¨åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´  rpushâ€”â€”åœ¨keyå¯¹åº”çš„listçš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå…ƒç´  rpopâ€”â€”ä»keyå¯¹åº”çš„listçš„å°¾éƒ¨åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´  Setç±»å‹ saddâ€”â€”åœ¨keyå¯¹åº”çš„setä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´  smembersâ€”â€”è·å–keyå¯¹åº”çš„setçš„æ‰€æœ‰å…ƒç´  spopâ€”â€”éšæœºè¿”å›å¹¶åˆ é™¤keyå¯¹åº”çš„setä¸­çš„ä¸€ä¸ªå…ƒç´  suionâ€”â€”æ±‚ç»™å®škeyå¯¹åº”çš„setå¹¶é›† sinterâ€”â€”æ±‚ç»™å®škeyå¯¹åº”çš„setäº¤é›† SortSetç±»å‹ç®€ä»‹ï¼šsetçš„åŸºç¡€å¢åŠ é¡ºåºscoreï¼Œå†æ ¹æ®scoreè¿›è¡Œæ’åº å®æˆ˜ï¼šé€šè¿‡sortsetå®ç°æ’è¡Œæ¦œ zadd â€”â€”åœ¨keyå¯¹åº”çš„zsetä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´  zrangeâ€”â€”è·å–keyå¯¹åº”çš„zsetä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼Œ-1è¡¨ç¤ºè·å–æ‰€æœ‰å…ƒç´  zremâ€”â€”åˆ é™¤keyå¯¹åº”çš„zsetä¸­çš„ä¸€ä¸ªå…ƒç´  zrangebyscoreâ€”â€”è¿”å›æœ‰åºé›†keyä¸­ï¼ŒæŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ åˆ—è¡¨,æ’è¡Œæ¦œä¸­è¿ç”¨ zrankâ€”â€”è¿”å›keyå¯¹åº”çš„zsetä¸­æŒ‡å®šmemberçš„æ’åã€‚å…¶ä¸­memberæŒ‰scoreå€¼é€’å¢(ä»å°åˆ°å¤§ï¼‰ï¼› æ’åä»¥0ä¸ºåº•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œscoreå€¼æœ€å°çš„æˆå‘˜æ’åä¸º0,æ’è¡Œæ¦œä¸­è¿ç”¨ Setä¸SortSet setæ˜¯é€šè¿‡hashmapå­˜å‚¨ï¼Œkeyå¯¹åº”setçš„å…ƒç´ ï¼Œvalueæ˜¯ç©ºå¯¹è±¡ sortsetæ˜¯æ€ä¹ˆå­˜å‚¨å¹¶å®ç°æ’åºçš„å‘¢ï¼Œhashmapå­˜å‚¨ï¼Œè¿˜åŠ äº†ä¸€å±‚è·³è·ƒè¡¨ è·³è·ƒè¡¨ï¼šç›¸å½“äºåŒå‘é“¾è¡¨ï¼Œåœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ å‰å¾€æ¯”å½“å‰å…ƒç´ å¤§çš„è·³è½¬é“¾æ¥","link":"/2019/06/15/RedisFirstEncounter/"},{"title":"Redis SentinelåŸç†åˆ†æ","text":"ä¸»å¤‡åˆ‡æ¢è¿‡ç¨‹ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬äº†è§£äº†å¦‚ä½•éƒ¨ç½²Sentinelæ¨¡å¼Redisé›†ç¾¤ï¼Œæœ¬æ–‡åœ¨ä¸Šä¸€ç¯‡çš„åŸºç¡€ä¸Šï¼Œç»“åˆlogæ¥åˆ†æSentinelé›†ç¾¤æ¨¡å¼çš„ä¸€äº›åŸç†ã€‚ SDOWN ä¸»è§‚ä¸‹çº¿SDOWN(subjectively down)ï¼ŒæŒ‡çš„æ˜¯å•ä¸ªSentinelå®ä¾‹å¯¹æœåŠ¡å™¨åšå‡ºçš„ä¸‹çº¿åˆ¤æ–­ã€‚ å³æœåŠ¡å™¨åœ¨down-after-millisecondsæŒ‡å®šæ¯«ç§’æ•°å†…ï¼Œæ²¡æœ‰å“åº”Sentinelå®ä¾‹çš„PINGå‘½ä»¤ï¼Œæˆ–è€…å“åº”ç»“æœä¸ºé”™è¯¯æ—¶ï¼ŒSentinelå®ä¾‹å°†æ ‡è®°æ­¤æœåŠ¡å™¨ä¸ºSDOWNçŠ¶æ€ã€‚ Sentinelä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘æ‰€æœ‰ä¸å…¶å»ºç«‹äº†å‘½ä»¤è¿æ¥çš„å®ä¾‹ï¼ˆmasterï¼Œä»æœåŠ¡ï¼Œå…¶ä»–sentinelï¼‰å‘PINGå‘½ä»¤ã€‚ å¦‚æœå¤šä¸ªsentinelç›‘è§†ä¸€ä¸ªæœåŠ¡ï¼Œæœ‰å¯èƒ½å­˜åœ¨å¤šä¸ªsentinelçš„down-after-millisecondsé…ç½®ä¸åŒï¼Œè¿™ä¸ªåœ¨å®é™…ç”Ÿäº§ä¸­è¦æ³¨æ„ã€‚ ODOWN å®¢è§‚ä¸‹çº¿ODOWN(objectively down)ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªSentinelå®ä¾‹åœ¨å¯¹åŒä¸€ä¸ªæœåŠ¡å™¨åšå‡ºSDOWNåˆ¤æ–­ï¼Œ å¹¶ä¸”é€šè¿‡SENTINEL is-master-down-by-addrå‘½ä»¤äº’ç›¸äº¤æµä¹‹åï¼Œå¾—å‡ºçš„æœåŠ¡å™¨ä¸‹çº¿åˆ¤æ–­ã€‚ODOWNåæ‰ä¼šå¼€å¯failoverã€‚ å½“ä¸€ä¸ªSentinelå®ä¾‹æ ‡è®°masterä¸ºSDOWNåï¼Œä¼šè¯¢é—®å…¶ä»–ç›‘æ§è¯¥masterçš„Sentinelå®ä¾‹æ˜¯å¦ä¹Ÿè®¤ä¸ºmasteræ˜¯ä¸»è§‚ä¸‹çº¿ã€‚æ¥å—åˆ°è¶³å¤Ÿæ•°é‡ï¼ˆåˆ¤æ–­masteræ˜¯SDOWNï¼Œæ•°é‡ç”±sentinel monitor &lt;masterName&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;ä¸­&lt;quorum&gt;ç¡®å®šï¼‰åï¼Œmasterè¢«å®¢è§‚ä¸‹çº¿ï¼Œå‡†å¤‡è¿›è¡Œfailoverã€‚ åªæœ‰masteræœ‰ODOWNçŠ¶æ€ï¼Œslaveæ²¡æœ‰ODOWNçŠ¶æ€ã€‚ Sentinelä¹‹é—´å¦‚ä½•äº¤æµmasterçš„SDOWNå¹¶ç¡®å®šæ˜¯å¦ODOWNSentinelé€šè¿‡å‘é€SENTINEL is-master-down-by-addr &lt;ip&gt; &lt;port&gt; &lt;current_epoch&gt; &lt;runid&gt; ip: ä¸»è§‚ä¸‹çº¿çš„æœåŠ¡id port: ä¸»è§‚ä¸‹çº¿çš„æœåŠ¡ç«¯å£ current_epoch: sentinelçš„çºªå…ƒ runid: * è¡¨ç¤ºæ£€æµ‹æœåŠ¡ä¸‹çº¿çŠ¶æ€ sentinelè¿è¡Œidï¼Œè¡¨ç¤ºç”¨æ¥é€‰ä¸¾é¢†å¤´sentinel ä¸€ä¸ªsentinelæ¥æ”¶å¦ä¸€ä¸ªsentinelå‘æ¥çš„is-master-down-by-addråï¼Œæå–å‚æ•°ï¼Œæ ¹æ®ipå’Œç«¯å£ï¼Œæ£€æµ‹è¯¥æœåŠ¡æ—¶å€™åœ¨è¯¥sentinelä¸»è§‚ä¸‹çº¿ï¼Œå¹¶ä¸”å›å¤is-master-down-by-addrï¼Œå›å¤åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼š down_stateï¼ˆ1è¡¨ç¤ºå·²ä¸‹çº¿ï¼Œ0è¡¨ç¤ºæœªä¸‹çº¿ï¼‰ leader_runidï¼ˆé¢†å¤´sentinal idï¼‰ leader_epochï¼ˆé¢†å¤´sentinelçºªå…ƒï¼‰ Sentinelæ¥æ”¶åˆ°å›å¤åï¼Œæ ¹æ®é…ç½®è®¾ç½®çš„ä¸‹çº¿æœ€å°æ•°é‡ï¼Œè¾¾åˆ°è¿™ä¸ªå€¼ï¼Œæ—¢è®¤ä¸ºè¯¥æœåŠ¡å®¢è§‚ä¸‹çº¿ã€‚ SDOWN/ODOWNåˆ‡æ¢ä»SDOWNåˆ‡æ¢åˆ°ODOWNä¸éœ€è¦ä»»ä½•ä¸€è‡´æ€§ç®—æ³•ï¼Œåªéœ€è¦ä¸€ä¸ªgossipåè®®ï¼šå¦‚æœä¸€ä¸ªSentinelæ”¶åˆ°äº†è¶³å¤Ÿå¤šçš„Sentinelå‘æ¥æ¶ˆæ¯å‘Šè¯‰å®ƒæŸä¸ªmasterå·²ç»downæ‰äº†ï¼ŒSDOWNçŠ¶æ€å°±ä¼šå˜æˆODOWNçŠ¶æ€ã€‚å¦‚æœä¹‹åmasterå¯ç”¨äº†ï¼Œè¿™ä¸ªçŠ¶æ€å°±ä¼šç›¸åº”åœ°è¢«æ¸…ç†æ‰ã€‚ æ­£å¦‚ä¹‹å‰å·²ç»è§£é‡Šè¿‡äº†ï¼ŒçœŸæ­£è¿›è¡Œfailoveréœ€è¦ä¸€ä¸ªæˆæƒçš„è¿‡ç¨‹ï¼Œä½†æ˜¯æ‰€æœ‰çš„failoveréƒ½å¼€å§‹äºä¸€ä¸ªODOWNçŠ¶æ€ã€‚ODOWNçŠ¶æ€åªé€‚ç”¨äºmasterï¼Œå¯¹äºä¸æ˜¯masterçš„redisèŠ‚ç‚¹sentinelä¹‹é—´ä¸éœ€è¦ä»»ä½•åå•†ï¼Œslaveså’ŒSentinelä¸ä¼šæœ‰ODOWNçŠ¶æ€ã€‚ é…ç½®ç‰ˆæœ¬å·/çºªå…ƒepochåœ¨æ‰§è¡Œfailoverçš„æ—¶å€™ï¼ŒSentinelä¼šè‡ªåŠ¨è·å–ä¸€ä»½æ–°çš„é…ç½®ç‰ˆæœ¬å·ç”¨äºæœ¬æ¬¡çš„failoverã€‚å½“failoverç»“æŸåï¼Œæ–°çš„ç‰ˆæœ¬å·ä¼šè¢«ç”¨äºæœ€æ–°çš„é…ç½®ã€‚ æ¯ä¸ªç‰ˆæœ¬å·éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚ é…ç½®ä¼ æ’­ä¸€ä¸ªSentinelæˆåŠŸåœ°å¯¹ä¸€ä¸ªmasterè¿›è¡Œäº†failoverï¼Œå®ƒå°†ä¼šæŠŠå…³äºmasterçš„æœ€æ–°é…ç½®é€šè¿‡å¹¿æ’­å½¢å¼é€šçŸ¥å…¶å®ƒsentinelï¼Œå…¶å®ƒçš„Sentinelåˆ™æ›´æ–°å¯¹åº”masterçš„é…ç½®ã€‚ å½“å°†ä¸€ä¸ªslaveé€‰ä¸¾ä¸ºmasterå¹¶å‘é€SLAVEOF NO ONEåï¼Œå³ä½¿å…¶å®ƒçš„slaveè¿˜æ²¡é’ˆå¯¹æ–°masteré‡æ–°é…ç½®è‡ªå·±ï¼Œfailoverä¹Ÿè¢«è®¤ä¸ºæ˜¯æˆåŠŸäº†çš„ï¼Œç„¶åæ‰€æœ‰sentinelså°†ä¼šå‘å¸ƒæ–°çš„é…ç½®ä¿¡æ¯ã€‚ æ¯ä¸ªsentinelä½¿ç”¨##å‘å¸ƒ/è®¢é˜…##çš„æ–¹å¼æŒç»­åœ°ä¼ æ’­masterçš„é…ç½®ç‰ˆæœ¬ä¿¡æ¯ï¼Œé…ç½®ä¼ æ’­çš„##å‘å¸ƒ/è®¢é˜…##ç®¡é“æ˜¯ï¼šsentinel:helloã€‚å› ä¸ºæ¯ä¸€ä¸ªé…ç½®éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ‰€ä»¥ä»¥ç‰ˆæœ¬å·æœ€å¤§çš„é‚£ä¸ªä¸ºæ ‡å‡†ã€‚ Sentinelçš„é€‰ä¸¾ä¸€ä¸ªredisæœåŠ¡è¢«åˆ¤æ–­ä¸ºå®¢è§‚ä¸‹çº¿æ—¶ï¼Œå¤šä¸ªç›‘è§†è¯¥æœåŠ¡çš„sentinelåå•†ï¼Œé€‰ä¸¾ä¸€ä¸ªé¢†å¤´sentinelï¼Œå¯¹è¯¥redisæœåŠ¡è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œã€‚é€‰ä¸¾é¢†å¤´sentineléµå¾ªä»¥ä¸‹è§„åˆ™ï¼š æ‰€æœ‰çš„sentineléƒ½æœ‰å…¬å¹³è¢«é€‰ä¸¾æˆé¢†å¤´çš„èµ„æ ¼ã€‚ æ‰€æœ‰çš„sentineléƒ½æœ‰ä¸”åªæœ‰ä¸€æ¬¡å°†æŸä¸ªsentinelé€‰ä¸¾æˆé¢†å¤´çš„æœºä¼šï¼ˆåœ¨ä¸€è½®é€‰ä¸¾ä¸­ï¼‰ï¼Œä¸€æ—¦é€‰ä¸¾æŸä¸ªsentinelä¸ºé¢†å¤´ï¼Œä¸èƒ½æ›´æ”¹ã€‚ sentinelè®¾ç½®é¢†å¤´sentinelæ˜¯å…ˆåˆ°å…ˆå¾—ï¼Œä¸€æ—¦å½“å‰sentinelè®¾ç½®äº†é¢†å¤´sentinelï¼Œä»¥åè¦æ±‚è®¾ç½®sentinelä¸ºé¢†å¤´è¯·æ±‚éƒ½ä¼šè¢«æ‹’ç»ã€‚ æ¯ä¸ªå‘ç°æœåŠ¡å®¢è§‚ä¸‹çº¿çš„sentinelï¼Œéƒ½ä¼šè¦æ±‚å…¶ä»–sentinelå°†è‡ªå·±è®¾ç½®æˆé¢†å¤´ã€‚ å½“ä¸€ä¸ªsentinelï¼ˆæºsentinelï¼‰å‘å¦ä¸€ä¸ªsentinelï¼ˆç›®sentinelï¼‰å‘é€is-master-down-by-addr ip port current_epoch runidå‘½ä»¤çš„æ—¶å€™ï¼Œrunidå‚æ•°ä¸æ˜¯*ï¼Œè€Œæ˜¯sentinelè¿è¡Œidï¼Œå°±è¡¨ç¤ºæºsentinelè¦æ±‚ç›®æ ‡sentinelé€‰ä¸¾å…¶ä¸ºé¢†å¤´ã€‚ æºsentinelä¼šæ£€æŸ¥ç›®æ ‡sentinelå¯¹å…¶è¦æ±‚è®¾ç½®æˆé¢†å¤´çš„å›å¤ï¼Œå¦‚æœå›å¤çš„leader_runidå’Œleader_epochä¸ºæºsentinelï¼Œè¡¨ç¤ºç›®æ ‡sentinelåŒæ„å°†æºsentinelè®¾ç½®æˆé¢†å¤´ã€‚ å¦‚æœæŸä¸ªsentinelè¢«åŠæ•°ä»¥ä¸Šçš„sentinelè®¾ç½®æˆé¢†å¤´ï¼Œé‚£ä¹ˆè¯¥sentinelæ—¢ä¸ºé¢†å¤´ã€‚ å¦‚æœåœ¨é™å®šæ—¶é—´å†…ï¼Œæ²¡æœ‰é€‰ä¸¾å‡ºé¢†å¤´sentinelï¼Œæš‚å®šä¸€æ®µæ—¶é—´ï¼Œå†é€‰ä¸¾ã€‚ Slaveçš„é€‰ä¸¾å½“Sentinelå‡†å¤‡å¥½å¼€å§‹failoverï¼Œå¹¶å¾—åˆ°äº†æœ€ç»ˆçš„é€‰ä¸¾æˆæƒåï¼Œè¦å¼€å§‹è¿›è¡ŒSlaveçš„é€‰ä¸¾ï¼Œè¯„ä¼°æ–¹é¢æœ‰ï¼š ä¸masteræ–­å¼€è¿æ¥çš„æ¬¡æ•° Slaveçš„ä¼˜å…ˆçº§ æ•°æ®å¤åˆ¶çš„ä¸‹æ ‡(ç”¨æ¥è¯„ä¼°slaveå½“å‰æ‹¥æœ‰å¤šå°‘masterçš„æ•°æ®) è¿›ç¨‹ID å¦‚æœä¸€ä¸ªslaveä¸masterå¤±å»è”ç³»è¶…è¿‡10æ¬¡ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½è¶…è¿‡äº†é…ç½®çš„æœ€å¤§å¤±è”æ—¶é—´(down-after-milliseconds)ï¼Œå¦‚æœsentinelåœ¨è¿›è¡Œfailoveræ—¶å‘ç°slaveå¤±è”ï¼Œé‚£ä¹ˆè¿™ä¸ªslaveå°±ä¼šè¢«sentinelè®¤ä¸ºä¸é€‚åˆç”¨æ¥åšæ–°masterçš„ã€‚æ›´ä¸¥æ ¼çš„å®šä¹‰æ˜¯ï¼Œå¦‚æœä¸€ä¸ªslaveæŒç»­æ–­å¼€è¿æ¥çš„æ—¶é—´è¶…è¿‡(down-after-milliseconds * 10) + milliseconds_since_master_is_in_SDOWN_stateå°±ä¼šè¢«è®¤ä¸ºå¤±å»é€‰ä¸¾èµ„æ ¼ã€‚ ç¬¦åˆä¸Šè¿°æ¡ä»¶çš„slaveæ‰ä¼šè¢«åˆ—å…¥masterå€™é€‰äººåˆ—è¡¨ï¼Œå¹¶æ ¹æ®ä»¥ä¸‹é¡ºåºæ¥è¿›è¡Œæ’åºï¼š sentinelé¦–å…ˆä¼šæ ¹æ®slavesçš„ä¼˜å…ˆçº§æ¥è¿›è¡Œæ’åºï¼Œä¼˜å…ˆçº§è¶Šå°æ’åè¶Šé å‰ã€‚ å¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™æŸ¥çœ‹å¤åˆ¶çš„ä¸‹æ ‡ï¼Œå“ªä¸ªä»masteræ¥æ”¶çš„å¤åˆ¶æ•°æ®å¤šï¼Œå“ªä¸ªå°±é å‰ã€‚ å¦‚æœä¼˜å…ˆçº§å’Œä¸‹æ ‡éƒ½ç›¸åŒï¼Œå°±é€‰æ‹©è¿›ç¨‹IDè¾ƒå°çš„é‚£ä¸ªã€‚ ä¸€ä¸ªredisæ— è®ºæ˜¯masterè¿˜æ˜¯slaveï¼Œéƒ½å¿…é¡»åœ¨é…ç½®ä¸­æŒ‡å®šä¸€ä¸ªslaveä¼˜å…ˆçº§ã€‚è¦æ³¨æ„åˆ°masterä¹Ÿæ˜¯æœ‰å¯èƒ½é€šè¿‡failoverå˜æˆslaveçš„ã€‚å¦‚æœä¸€ä¸ªredisçš„slaveä¼˜å…ˆçº§é…ç½®ä¸º0ï¼Œé‚£ä¹ˆå®ƒå°†æ°¸è¿œä¸ä¼šè¢«é€‰ä¸ºmasterã€‚ä½†æ˜¯å®ƒä¾ç„¶ä¼šä»masterå“ªé‡Œå¤åˆ¶æ•°æ®ã€‚ Sentinelæ¨¡å¼ä¸»å¤‡åˆ‡æ¢æ€»ç»“Sentinelä¸»è¦è´Ÿè´£ä¸‰ä¸ªæ–¹é¢å·¥ä½œï¼š ç›‘æ§ï¼ˆMonitoringï¼‰ Sentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ æé†’ï¼ˆNotificationï¼‰ å½“è¢«ç›‘æ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œ Sentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰ å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œ Sentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œ å®ƒä¼šå°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œ å¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»æœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼› å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œ é›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œ ä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚ Sentinelé›†ç¾¤æ‚ä¹±çŸ¥è¯†æ€»ç»“ä¸ºä»€ä¹ˆè¦é›†ç¾¤å•ä¸ªSentinelèŠ‚ç‚¹ä¸å¯é ï¼Œå¯èƒ½å› ä¸ºå®•æœºï¼Œç½‘ç»œæ³¢åŠ¨é—®é¢˜å¯¼è‡´æ— æ³•è¿›è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œå¤šä¸ªSentinelï¼Œrediså®¢æˆ·ç«¯å¯ä»¥è¿æ¥ä»»æ„ä¸€ä¸ªSentinelèŠ‚ç‚¹è·å–redisé›†ç¾¤çš„ä¿¡æ¯ã€‚ Sentinelé›†ç¾¤æ³¨æ„ Sentinelé›†ç¾¤å¤§å¤šæ•°SentinelèŠ‚ç‚¹è®¤å®šmasterä¸»è§‚ä¸‹çº¿æ—¶ï¼Œmasteræ‰ä¼šè¢«å®¢è§‚ä¸‹çº¿ï¼Œå³ä½¿ä¸ç®¡æˆ‘ä»¬åœ¨sentinel monitorä¸­è®¾ç½®çš„æ•°æ˜¯å¤šå°‘ï¼Œå°±ç®—æ˜¯æ»¡è¶³äº†è¯¥å€¼ï¼Œåªè¦è¾¾ä¸åˆ°å¤§å¤šæ•°ï¼Œå°±ä¸ä¼šå‘ç”Ÿæ•…éšœè¿ç§»ã€‚ å®˜æ–¹å»ºè®®è‡³å°‘3å°SentinelèŠ‚ç‚¹ã€‚ sentinel.confä¸­IPä¸è¦å†™127.0.0.1/localhostï¼Œjediså’Œå®¢æˆ·ç«¯æ˜¯é€šè¿‡è¿™ä¸ªè·å–masterçš„IPï¼Œä¼šå¯¼è‡´è¿æ¥ä¸ä¸ŠmasterèŠ‚ç‚¹ã€‚ å½“sentinel å¯åŠ¨åä¼šè‡ªåŠ¨çš„ä¿®æ”¹sentinel.confæ–‡ä»¶ï¼Œå¦‚å·²å‘ç°çš„masterçš„slaveä¿¡æ¯ï¼Œå’Œé›†ç¾¤ä¸­å…¶å®ƒsentinel çš„ä¿¡æ¯ç­‰,è¿™æ ·å³ä½¿é‡å¯sentinelä¹Ÿèƒ½ä¿æŒåŸæ¥çš„çŠ¶æ€ã€‚æ³¨æ„ï¼Œå½“é›†ç¾¤æœåŠ¡å™¨è°ƒæ•´æ—¶ï¼Œå¦‚æ›´æ¢sentinelçš„æœºå™¨ï¼Œæˆ–è€…æ–°é…ç½®ä¸€ä¸ªsentinelï¼Œè¯·ä¸è¦ç›´æ¥å¤åˆ¶åŸæ¥è¿è¡Œè¿‡å¾—sentinelé…ç½®æ–‡ä»¶ï¼Œå› ä¸ºå…¶é‡Œé¢è‡ªåŠ¨ç”Ÿæˆäº†ä»¥ä¸Šè¯´çš„é‚£äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬åº”è¯¥å¤åˆ¶ä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶æˆ–è€…æŠŠè‡ªåŠ¨ç”Ÿæˆçš„ä¿¡æ¯ç»™åˆ æ‰ã€‚ å½“å‘ç”Ÿæ•…éšœè¿ç§»çš„æ—¶å€™ï¼Œmasterçš„å˜æ›´è®°å½•ä¸slaveæ›´æ¢masterçš„ä¿®æ”¹ä¼šè‡ªåŠ¨åŒæ­¥åˆ°redisçš„é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å³ä½¿é‡å¯redisä¹Ÿèƒ½ä¿æŒå˜æ›´åçš„çŠ¶æ€ã€‚ Sentinelå·¥ä½œæ–¹å¼ï¼ˆæ¯ä¸ªSentinelå®ä¾‹éƒ½æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ï¼‰ æ¯ä¸ªSentinelä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒæ‰€çŸ¥çš„Masterï¼ŒSlaveä»¥åŠå…¶ä»– Sentinel å®ä¾‹å‘é€ä¸€ä¸ªPINGå‘½ä»¤ã€‚ å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤PINGå‘½ä»¤çš„æ—¶é—´è¶…è¿‡ own-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œåˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢«Sentinelæ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚ å¦‚æœä¸€ä¸ªMasterè¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterçš„æ‰€æœ‰ Sentinel è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤Masterçš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚ å½“æœ‰è¶³å¤Ÿæ•°é‡çš„Sentinelï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterçš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼Œåˆ™Masterä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ªSentinel ä¼šä»¥æ¯10ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒå·²çŸ¥çš„æ‰€æœ‰Masterï¼ŒSlaveå‘é€ INFO å‘½ä»¤ã€‚ å½“Masterè¢«Sentinelæ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿æ—¶ï¼ŒSentinel å‘ä¸‹çº¿çš„ Master çš„æ‰€æœ‰Slaveå‘é€ INFOå‘½ä»¤çš„é¢‘ç‡ä¼šä»10ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚ è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„SentinelåŒæ„Masterå·²ç»ä¸‹çº¿ï¼ŒMasterçš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚ è‹¥ Masteré‡æ–°å‘Sentinel çš„PINGå‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMasterçš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚ Sentinelé›†ç¾¤èŠ‚ç‚¹/Slavesä¹‹é—´çš„å‘ç°æœºåˆ¶Sentinelé›†ç¾¤ä¸­æ¯ä¸€ä¸ªSentinelèŠ‚ç‚¹éƒ½ä¸éœ€è¦é…ç½®å…¶ä»–èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚å› ä¸ºSentinelåˆ©ç”¨äº†masterèŠ‚ç‚¹çš„å‘å¸ƒ/è®¢é˜…æœºåˆ¶å»è‡ªåŠ¨å‘ç°/ç›‘æ§åŒä¸€masterçš„sentinelèŠ‚ç‚¹ã€‚ åŒæ ·ï¼Œä½ ä¹Ÿä¸éœ€è¦åœ¨sentinelä¸­é…ç½®æŸä¸ªmasterçš„æ‰€æœ‰slaveçš„åœ°å€ï¼Œsentinelä¼šé€šè¿‡è¯¢é—®masteræ¥å¾—åˆ°è¿™äº›slaveçš„åœ°å€çš„ã€‚ ç®¡é“åï¼š__sentinel__:hello æ¯ä¸ªsentinelé€šè¿‡å‘æ¯ä¸ªmasterå’Œslaveçš„å‘å¸ƒ/è®¢é˜…é¢‘é“__sentinel__:helloæ¯ç§’å‘é€ä¸€æ¬¡æ¶ˆæ¯ï¼Œæ¥å®£å¸ƒå®ƒçš„å­˜åœ¨ã€‚ æ¯ä¸ªsentinelä¹Ÿè®¢é˜…äº†æ¯ä¸ªmasterå’Œslaveçš„é¢‘é“__sentinel__:helloçš„å†…å®¹ï¼Œæ¥å‘ç°æœªçŸ¥çš„sentinelï¼Œå½“æ£€æµ‹åˆ°äº†æ–°çš„sentinelï¼Œåˆ™å°†å…¶åŠ å…¥åˆ°è‡ªèº«ç»´æŠ¤çš„masterç›‘æ§åˆ—è¡¨ä¸­ã€‚ æ¯ä¸ªsentinelå‘é€çš„æ¶ˆæ¯ä¸­ä¹ŸåŒ…å«äº†å…¶å½“å‰ç»´æŠ¤çš„æœ€æ–°çš„masteré…ç½®ã€‚å¦‚æœæŸä¸ªsentinelå‘ç°è‡ªå·±çš„é…ç½®ç‰ˆæœ¬ä½äºæ¥æ”¶åˆ°çš„é…ç½®ç‰ˆæœ¬ï¼Œåˆ™ä¼šç”¨æ–°çš„é…ç½®æ›´æ–°è‡ªå·±çš„masteré…ç½®ã€‚ åœ¨ä¸ºä¸€ä¸ªmasteræ·»åŠ ä¸€ä¸ªæ–°çš„sentinelå‰ï¼Œsentinelæ€»æ˜¯æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰sentinelä¸æ–°çš„sentinelçš„è¿›ç¨‹å·æˆ–è€…æ˜¯åœ°å€æ˜¯ä¸€æ ·çš„ã€‚å¦‚æœæ˜¯é‚£æ ·ï¼Œè¿™ä¸ªsentinelå°†ä¼šè¢«åˆ é™¤ï¼Œè€ŒæŠŠæ–°çš„sentinelæ·»åŠ ä¸Šå»ã€‚ Sentinelæ¨¡å¼masterçš„é…ç½®æ³¨æ„å› ä¸ºmasteråœ¨ODOWNåæ¢å¤ï¼Œä¼šå˜æˆæ–°masterçš„slaveï¼Œæ‰€ä»¥åœ¨masterçš„redis.conf é…ç½®æ–‡ä»¶ä¸­åŒæ ·è¦é…ç½®masterauth &lt;password&gt;ï¼Œå¦åˆ™å˜ä¸ºslaveä¼šè¿æ¥ä¸ä¸Šæ–°çš„masterèŠ‚ç‚¹ã€‚ ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡ æ¯10ç§’æ¯ä¸ªsentinelä¼šå¯¹masterå’Œslaveæ‰§è¡Œinfoå‘½ä»¤ï¼Œè¿™ä¸ªä»»åŠ¡è¾¾åˆ°ä¸¤ä¸ªç›®çš„ï¼š å‘ç°slaveèŠ‚ç‚¹ ç¡®è®¤ä¸»ä»å…³ç³» æ¯2ç§’æ¯ä¸ªsentinelé€šè¿‡masterèŠ‚ç‚¹çš„channeläº¤æ¢ä¿¡æ¯ï¼ˆpub/subï¼‰ã€‚masterèŠ‚ç‚¹ä¸Šæœ‰ä¸€ä¸ªå‘å¸ƒè®¢é˜…çš„é¢‘é“(__sentinel__:hello)ã€‚sentinelèŠ‚ç‚¹é€šè¿‡__sentinel__:helloé¢‘é“è¿›è¡Œä¿¡æ¯äº¤æ¢(å¯¹èŠ‚ç‚¹çš„â€çœ‹æ³•â€å’Œè‡ªèº«çš„ä¿¡æ¯)ï¼Œè¾¾æˆå…±è¯†ã€‚ æ¯1ç§’æ¯ä¸ªsentinelå¯¹å…¶ä»–sentinelå’ŒredisèŠ‚ç‚¹æ‰§è¡Œpingæ“ä½œï¼ˆç›¸äº’ç›‘æ§ï¼‰ï¼Œè¿™ä¸ªå…¶å®æ˜¯ä¸€ä¸ªå¿ƒè·³æ£€æµ‹ï¼Œæ˜¯å¤±è´¥åˆ¤å®šçš„ä¾æ®ã€‚","link":"/2019/10/22/RedisSentinelAnalysis/"},{"title":"è½¯ä»¶æ¶æ„è®¾è®¡åŸåˆ™","text":"åšå¼€å‘æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ²¡æœ‰ç³»ç»Ÿçš„çœ‹è¿‡Javaçš„è½¯ä»¶è®¾è®¡åŸåˆ™ã€‚åœ¨å®é™…çš„å·¥ä½œä¸­ï¼Œå·²ç»å¯¹é€šè¿‡åˆç†çš„è½¯ä»¶è®¾æ¶æ„è®¡æ¥æå‡ç¼–ç å·¥ä½œçš„å¹¸ç¦æ„Ÿæ·±æœ‰ä½“ä¼šã€‚å¸Œæœ›é€šè¿‡æœ¬æ–‡å­¦ä¹ ï¼Œå¯¹Javaçš„è½¯ä»¶è®¾è®¡åŸåˆ™æœ‰ä¸ªå¤§ä½“çš„è®¤è¯†ã€‚åç»­ä¹Ÿä¼šç»“åˆSpringçš„æºç æ¥è¯æ˜ï¼Œè½¯ä»¶è®¾è®¡åŸåˆ™çš„é‡è¦æ€§ã€‚ å¼€é—­åŸåˆ™OCP(Open-Closed Principle)åŸåˆ™ï¼ŒæŒ‡ä¸€ä¸ªå®ä½“ï¼ˆç±»ï¼Œæ¨¡å—ï¼Œå‡½æ•°ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å³ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼ˆæ¥å£ï¼‰ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ï¼ˆå®ç°ç±»ï¼‰ã€‚ ä¾èµ–å€’ç½®åŸåˆ™DIP(Dependence Inversion Principle)åŸåˆ™ï¼ŒæŒ‡åœ¨è®¾è®¡ä»£ç ç»“æ„ï¼Œé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ã€‚æŠ½è±¡ä¸ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚ä¾èµ–æŠ½è±¡ã€‚ä½œç”¨åœ¨äºï¼Œå‡å°‘ç±»ä¹‹é—´çš„è€¦åˆï¼Œåˆ©äºç»´æŠ¤ã€‚ â€œä¾èµ–æ³¨å…¥â€å°±æ˜¯è¿™ç§æ–¹å¼ï¼Œé€šè¿‡å¼•ç”¨æ¥å£ï¼ˆæŠ½è±¡ï¼‰ï¼Œè¿™æ—¶è°ƒç”¨æ–¹å¯¹å®ç°ç±»æ˜¯æ— ä¾èµ–çš„ï¼Œè°ƒç”¨æ–¹ä¾èµ–çš„æ˜¯æŠ½è±¡æ¥å£ï¼Œå®ç°ç±»ä¹Ÿä¾èµ–äºæ¥å£ï¼ˆæ¯•ç«Ÿæ˜¯å®ç°ç±»ä¹ˆï¼‰ã€‚è¿™æ ·ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥è°ƒç”¨æ–¹ä¸å®ç°ç±»å°±è§£è€¦äº†ï¼ˆä¾èµ–æ³¨å…¥ä¸åŒçš„å®ç°ç±»ï¼Œè°ƒç”¨æ–¹è°ƒç”¨åŒä¸€æ¥å£å¯ä»¥æœ‰ä¸åŒçš„å®ç°ï¼‰ã€‚ å•ä¸€èŒè´£åŸåˆ™SRP(Simple Responsibility Principle)åŸåˆ™ï¼šç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªç±»ã€æ¥å£ã€æ–¹æ³•åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚å› ä¸ºéœ€æ±‚å˜æ›´æ”¹ï¼Œå¯¼è‡´ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªèŒè´£é€»è¾‘ä»£ç ï¼Œæœ‰å¯èƒ½å¯¼è‡´å¦ä¸€ä¸ªèŒè´£çš„åŠŸèƒ½å‘ç”Ÿæ•…éšœã€‚ æ¥å£éš”ç¦»åŸåˆ™ISP(Interface Segregation Principle)åŸåˆ™ï¼ŒæŒ‡å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸é€‚ç”¨å•ä¸€çš„æ€»æ¥å£ï¼Œå®¢æˆ·ç«¯ï¼ˆå®ç°ç±»ï¼‰ä¸åº”è¯¥ä¾èµ–å…¶ä¸éœ€è¦çš„æ¥å£ï¼ˆæˆ–è€…è¯´å®ç°ç±»æœ‰ä¸éœ€è¦å®ç°çš„æ–¹æ³•ï¼‰ã€‚ ä¸€ä¸ªç±»å¯¹åº”ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¹‹ä¸Šã€‚ å»ºè®®å•ä¸€æ¥å£ï¼Œä¸è¦å»ºç«‹åºå¤§è‡ƒè‚¿çš„æ¥å£ï¼ˆåœ¨ä¹‹å‰ä¸ç›¸å¹²æ¥å£è¿½åŠ æ–¹æ³•ï¼‰ã€‚ å°½é‡ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘ï¼ˆä¸æ˜¯è¶Šå°‘è¶Šå¥½ï¼Œé€‚é‡å³å¯ï¼‰ã€‚æ¥å£éš”ç¦»åŸåˆ™ç¬¦åˆé«˜å†…èšï¼Œä½è€¦åˆçš„è®¾è®¡æ€æƒ³ï¼Œä½¿ç±»æœ‰æ›´å¥½çš„å¯è¯»æ€§ï¼Œå¯æ‰©å±•æ€§ï¼Œç»´æŠ¤ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚å¯¹æŠ½è±¡å’Œä¸šåŠ¡æ¨¡å‹çš„æ·±å…¥ç†è§£æ‰èƒ½æ›´å¥½åœ°éµå¾ªæ­¤åŸåˆ™ã€‚ è¿ªç±³ç‰¹åŸåˆ™ï¼ˆæœ€å°‘çŸ¥é“åŸåˆ™ï¼‰LoD(Law of Demeter)åˆå«æœ€å°‘çŸ¥é“åŸåˆ™ï¼ˆLKP,Least Knowledge Principleï¼‰ï¼šä¸€ä¸ªå¯¹è±¡å¯¹äºå…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ã€‚å°½é‡é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ã€‚å¼ºè°ƒï¼š åªä¸æœ‹å‹ï¼ˆæˆå‘˜å˜é‡ï¼Œæ–¹æ³•çš„å…¥å‚ã€å‡ºå‚ä¸­çš„ç±»ï¼‰äº¤æµï¼Œä¸åŒé™Œç”Ÿäººï¼ˆä¾‹å¦‚æ–¹æ³•ä½“å†…éƒ¨çš„ç±»ï¼‰è¯´è¯ ä¸¾ä¸ªä¾‹å­ï¼Œä¸è¦å°†serviceå±‚ä»£ç é€»è¾‘å†™åˆ°controllerå±‚ï¼Œcontrolleråªéœ€è¦è°ƒç”¨å¯¹åº”æ¥å£å³å¯ï¼Œæ‰€æœ‰çš„å†…éƒ¨å®ç°ï¼Œåœ¨controlleræ˜¯æ— æ„ŸçŸ¥çš„ã€‚ é‡Œæ°åŸåˆ™LSP(Liskov Substitution Principle),æŒ‡æ¯ä¸ªT1ç±»å‹çš„å¯¹è±¡O1ï¼Œéƒ½æœ‰T2ç±»å‹çš„å¯¹è±¡O2ï¼Œä½¿å¾—T1å®šä¹‰çš„æ‰€æœ‰ç¨‹åºPä¸­æ‰€æœ‰å¯¹è±¡O1éƒ½æ›¿æ¢æˆO2ï¼Œç¨‹åºPçš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç±»å‹T2æ˜¯ç±»å‹T1çš„å­ç±»ã€‚ ç®€å•æ¥è¯´ï¼šä¸€ä¸ªç¨‹åºï¼Œé€‚ç”¨äºçˆ¶ç±»å¯¹è±¡ï¼Œä¸€å®šé€‚ç”¨äºå…¶å­ç±»ã€‚æ‰€æœ‰å¼•ç”¨çˆ¶ç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ï¼Œå­ç±»å¯¹è±¡èƒ½åœ¨ç¨‹åºé€»è¾‘ä¸å˜çš„å‰æä¸‹æ›¿æ¢çˆ¶ç±»å¯¹è±¡ã€‚æˆ–è€…è¯´ï¼šå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚ å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•ã€‚ å­ç±»å¯ä»¥å¢åŠ è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•ã€‚ å½“å­ç±»çš„æ–¹æ³•é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„å‰ç½®æ¡ä»¶ï¼ˆæ–¹æ³•çš„å…¥å‚ï¼‰è¦æ¯”çˆ¶ç±»æ–¹æ³•çš„å…¥å‚æ›´å®½æ¾ã€‚ å½“å­ç±»æ–¹æ³•å®ç°çˆ¶ç±»æ–¹æ³•æ—¶ï¼ˆé‡å†™ï¼Œé‡è½½ï¼Œå®ç°ï¼‰ï¼Œæ–¹æ³•çš„åç½®æ¡ä»¶ï¼ˆæ–¹æ³•çš„è¾“å‡ºã€è¿”å›å€¼ï¼‰è¦æ¯”çˆ¶ç±»æ›´ä¸¥æ ¼æˆ–ä¸€æ ·ã€‚ ä¼˜åŠ¿ï¼š çº¦æŸç»§æ‰¿æ³›æ»¥ï¼Œæ˜¯å¼€é—­åŸåˆ™çš„ä¸€ç§ä½“ç°ã€‚ åŠ å¼ºç¨‹åºçš„å¥å£®æ€§ï¼ŒåŒæ—¶å˜æ›´æ—¶ä¹Ÿå¯ä»¥åšåˆ°éå¸¸å¥½çš„å…¼å®¹æ€§ï¼Œæé«˜ç¨‹åºçš„å¯ç»´æŠ¤æ€§ï¼Œæ‰©å±•æ€§ï¼Œé™ä½éœ€æ±‚å˜æ›´æ—¶å¼•å…¥çš„é£é™©ã€‚ LSPæ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“å­ç±»å¯ä»¥æ›¿æ¢æ‰çˆ¶ç±»ï¼ŒåŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼Œçˆ¶ç±»æ‰èƒ½çœŸæ­£çš„è¢«å¤ç”¨ï¼Œå­ç±»ä¹Ÿèƒ½åœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°è¡Œä¸ºã€‚LSPæ˜¯å¯¹â€œå¼€é—­åŸåˆ™â€çš„è¡¥å……ï¼Œå®ç°â€œå¼€é—­åŸåˆ™â€çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ã€‚è€Œçˆ¶ç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥LSPæ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚ åˆæˆå¤ç”¨åŸåˆ™CRP(Composite Reuse Principle)åŸåˆ™ï¼ŒæŒ‡å°½é‡å…ˆä½¿ç”¨ç»„åˆæˆ–è€…èšåˆç­‰å…³è”å…³ç³»æ¥å®ç°ï¼Œå…¶æ¬¡æ‰è€ƒè™‘ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°ã€‚ ç»„åˆ/èšåˆï¼šé»‘ç®±å¤ç”¨ï¼Œæ— æ³•è·å–åˆ°ç±»ä»¥å¤–çš„å¯¹è±¡çš„å®ç°ç»†èŠ‚çš„ã€‚ ç»§æ‰¿ï¼šç™½ç®±å¤ç”¨ï¼ŒæŠŠæ‰€æœ‰çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ã€‚ ç¼ºç‚¹ï¼š ç ´åç±»çš„å°è£…æ€§ã€‚çˆ¶ç±»å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼Œå³çˆ¶ç±»å¯¹å­ç±»çš„é€æ˜çš„ï¼Œæ‰€ä»¥å«ç™½ç®±å¤ç”¨ã€‚ çˆ¶ç±»å­ç±»è€¦åˆåº¦é«˜ã€‚çˆ¶ç±»ä»»ä½•æ”¹å˜éƒ½ç›´æ¥å½±å“å­ç±»ã€‚ é™åˆ¶äº†å¤ç”¨çš„çµæ´»æ€§ã€‚ç»§æ‰¿æ˜¯é™æ€çš„ï¼Œç¼–è¯‘æ—¶å°±ä¼šå®šä¹‰å®Œæ¯•ï¼Œè¿è¡Œä¸èƒ½å‘ç”Ÿå˜åŒ–ã€‚ å¯¹è±¡ä¹‹é—´çš„ç»§æ‰¿ â€”è½¬å˜â€”&gt; å¼•ç”¨ä¸ºæˆå‘˜å˜é‡ å³ï¼šå°†å·²æœ‰å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ã€‚ å‚è€ƒä¾‹å­ æ€»ç»“å®é™…å¼€å‘ä¸­ï¼Œå¹¶ä¸è¦æ±‚æ‰€æœ‰ä»£ç éƒ½è¦éµå¾ªè®¾è®¡åŸåˆ™ï¼Œæˆ‘ä»¬è¦è€ƒè™‘äººåŠ›ï¼Œæ—¶é—´ï¼Œæˆæœ¬ï¼Œè´¨é‡ï¼Œä¸èƒ½åˆ»æ„è¿½æ±‚å®Œç¾ï¼Œä½†æ˜¯è¦åœ¨é€‚å½“çš„åœºæ™¯éµå¾ªè®¾è®¡åŸåˆ™ã€‚è¿™æ˜¯ä¸€ç§å¹³è¡¡å–èˆï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¾è®¡å‡ºæ›´åŠ ä¼˜é›…çš„ä»£ç ç»“æ„ã€‚","link":"/2020/04/07/SoftwarePrincipe/"},{"title":"Redis Sentinelæ¨¡å¼","text":"åœ¨æˆ‘ä»¬äº†è§£äº†Rediså•æœºç‰ˆæœ¬çš„Redisæ“ä½œï¼Œä½¿ç”¨åã€‚åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸å¯èƒ½ä½¿ç”¨å•æœºç‰ˆRedisï¼Œé€šå¸¸æœ€ç®€å•çš„å°±æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæœ‰ç‚¹ç±»ä¼¼mysqlçš„ä¸»ä»åº“ï¼Œè€Œå½“ä¸»Rediså€’äº†ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é€šè¿‡slaveof no one,slaveof new hostè¿›è¡Œåˆ‡æ¢,å·²ç»ä¸æ˜¯ç›‘æ§éº»çƒ¦çš„äº‹äº†ï¼Œæ‰€ä»¥Rediså®˜æ–¹æä¾›äº†Sentinelå‡ºç°äº†ï¼Œè§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚ æ¦‚è¿°Redis-Sentinelæ˜¯Rediså®˜æ–¹æ¨èçš„é«˜å¯ç”¨æ€§(HA)è§£å†³æ–¹æ¡ˆï¼Œå½“ç”¨RedisåšMaster-slaveçš„é«˜å¯ç”¨æ–¹æ¡ˆæ—¶ï¼Œå‡å¦‚masterå®•æœºäº†ï¼ŒRedisæœ¬èº«(åŒ…æ‹¬å®ƒçš„å¾ˆå¤šå®¢æˆ·ç«¯)éƒ½æ²¡æœ‰å®ç°è‡ªåŠ¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œè€ŒRedis-sentinelæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„è¿›ç¨‹ï¼Œå®ƒèƒ½ç›‘æ§å¤šä¸ªmaster-slaveé›†ç¾¤ï¼Œå‘ç°masterå®•æœºåèƒ½è¿›è¡Œè‡ªåŠ¨åˆ‡æ¢ã€‚Sentinelç”±ä¸€ä¸ªæˆ–å¤šä¸ªSentinel å®ä¾‹ ç»„æˆçš„Sentinel ç³»ç»Ÿå¯ä»¥ç›‘è§†ä»»æ„å¤šä¸ªä¸»æœåŠ¡å™¨ï¼Œä»¥åŠè¿™äº›ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨å°†ä¸‹çº¿ä¸»æœåŠ¡å™¨å±ä¸‹çš„æŸä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚ ç®€å•ä»‹ç»Sentinelçš„ä½œç”¨åï¼Œæˆ‘ä»¬å…ˆè¿›è¡ŒDockerç¯å¢ƒçš„æ­å»ºï¼Œå†ç»“åˆlogæ¥çœ‹Sentinelçš„åŸç†ã€‚ SentinelçŠ¶æ€æŒä¹…åŒ–Sentinelçš„çŠ¶æ€ä¼šè¢«æŒä¹…åŒ–åœ°å†™å…¥sentinelçš„é…ç½®æ–‡ä»¶ä¸­ã€‚æ¯æ¬¡å½“æ”¶åˆ°ä¸€ä¸ªæ–°çš„é…ç½®æ—¶ï¼Œæˆ–è€…æ–°åˆ›å»ºä¸€ä¸ªé…ç½®æ—¶ï¼Œé…ç½®ä¼šè¢«æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ï¼Œå¹¶å¸¦ä¸Šé…ç½®çš„ç‰ˆæœ¬æˆ³ã€‚è¿™æ„å‘³ç€ï¼Œå¯ä»¥å®‰å…¨çš„åœæ­¢å’Œé‡å¯sentinelè¿›ç¨‹ã€‚ Sentinelä½œç”¨ ç›‘æ§masterèŠ‚ç‚¹çŠ¶æ€ masterèŠ‚ç‚¹å¼‚å¸¸ï¼Œè¿›è¡ŒMaster-slaveåˆ‡æ¢ï¼Œå°†ä¸€ä¸ªslaveå‡çº§ä¸ºMasterï¼ŒåŸmasterä¸Šçº¿ï¼Œè‡ªåŠ¨å˜ä¸ºæ–°masterçš„slaveèŠ‚ç‚¹ Master-slaveåˆ‡æ¢åï¼Œmasterã€slaveçš„redis.confæ–‡ä»¶éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œmasterçš„redis.confä¼šå¢åŠ replicaof host porté…ç½® Dockeræ­å»ºï¼ˆ1ä¸»2ä»3å“¨å…µï¼‰åˆæ¬¡æ­å»ºæœ€å¥½å…³é—­æ‰€æœ‰é˜²ç«å¢™ï¼Œæˆ–è€…å¼€å¯å¯¹åº”ç«¯å£ï¼Œä¸‰å°CentOSæœåŠ¡å™¨IPä¸ºï¼š IPåœ°å€ åˆå§‹è§’è‰² 10.211.55.15 ä¸» 10.211.55.17 ä» 10.211.55.19 ä» æ­å»ºRedis(Master-Slave ä¸€ä¸»ä¸¤ä»)é…ç½®æ–‡ä»¶å‡†å¤‡ Master-redis.confé…ç½®æ–‡ä»¶ 1234567requirepass 123456masterauth 123456port 6380protected-mode nodaemonize no #dockerå¿…é¡»ä¸ºnoappendonly yesappendfsync everysec Slave-redis.confé…ç½®æ–‡ä»¶ 12345678replicaof 10.211.55.15 6380requirepass 123456masterauth 123456port 6380protected-mode nodaemonize no #dockerå¿…é¡»ä¸ºnoappendonly yesappendfsync everysec Dockerä¾æ¬¡å¯åŠ¨å®¹å™¨ï¼Œè¿›è¡ŒéªŒè¯12345678910docker run \\-d --network=host \\--name sr3-505 \\--restart=always \\-v /media/psf/Linux/df/redis/sentinel-config/redis3.conf:/etc/redis/redis.conf \\-v /var/df/sentinel/rdata:/data \\--privileged=true \\--sysctl net.core.somaxconn=1024 \\redis:5.0.5 \\redis-server /etc/redis/redis.conf æ­å»ºRedis-Sentinel(ä¸‰å“¨å…µ)sentinel.confæ–‡ä»¶12345678protected-mode noport 26380sentinel myid s1759a8ddfb52e2c2656ac09da601072a6636b88sentinel monitor mymaster 10.211.55.15 6380 2sentinel down-after-milliseconds mymaster 10000sentinel failover-timeout mymaster 10000sentinel parallel-syncs mymaster 1sentinel auth-pass mymaster 123456 é…ç½®æ–‡ä»¶è¯¦è§£ sentinel monitor mymaster 10.211.55.15 6380 2 è¿™ä¸ªé…ç½®æ˜¯sentineléœ€è¦ç›‘æ§çš„master/slaverä¿¡æ¯ï¼Œæ ¼å¼ä¸ºsentinel monitor sentinelç›‘å¬çš„masteråœ°å€ã€‚ç¬¬ä¸€ä¸ªå‚æ•°mymasterå¯ä»¥ä¸ºä»»æ„åå­—ï¼Œä½†æ˜¯é…ç½®åï¼Œsentinel.confä¸­æ‰€æœ‰çš„åå­—éƒ½è¦è·Ÿç€æ¢ï¼Œç¬¬å››ä¸ªå‚æ•°ï¼šsentinelé›†ç¾¤ä¸­è‡³å°‘æœ‰2ä¸ªsentinelåŒæ„æ‰è¡Œï¼Œ ä¸è¾¾æ ‡ï¼Œä¸ä¼šå‘ç”Ÿæ•…éšœè¿ç§»æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦æœ‰2ä¸ªsentinelè®¤ä¸ºmasterä¸‹çº¿ï¼Œå°±è®¤ä¸ºè¯¥masterå®¢è§‚ä¸‹çº¿ï¼Œå¯åŠ¨failoverå¹¶é€‰ä¸¾äº§ç”Ÿæ–°çš„masterã€‚é€šå¸¸æœ€åä¸€ä¸ªå‚æ•°ä¸èƒ½å¤šäºå¯åŠ¨çš„sentinelå®ä¾‹æ•°ã€‚ å…¶ä¸­åº”è¯¥å°äºé›†ç¾¤ä¸­slaveçš„ä¸ªæ•°ï¼Œå½“å¤±æ•ˆçš„èŠ‚ç‚¹æ•°è¶…è¿‡äº†,åˆ™è®¤ä¸ºæ•´ä¸ªä½“ç³»ç»“æ„å¤±æ•ˆã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œ æ— è®ºä½ è®¾ç½®è¦å¤šå°‘ä¸ª Sentinel åŒæ„æ‰èƒ½åˆ¤æ–­ä¸€ä¸ªæœåŠ¡å™¨å¤±æ•ˆï¼Œ ä¸€ä¸ª Sentinel éƒ½éœ€è¦è·å¾—ç³»ç»Ÿä¸­å¤šæ•°ï¼ˆmajorityï¼‰ Sentinel çš„æ”¯æŒï¼Œ æ‰èƒ½å‘èµ·ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œå¹¶é¢„ç•™ä¸€ä¸ªç»™å®šçš„é…ç½®çºªå…ƒ ï¼ˆconfiguration Epoch ï¼Œä¸€ä¸ªé…ç½®çºªå…ƒå°±æ˜¯ä¸€ä¸ªæ–°ä¸»æœåŠ¡å™¨é…ç½®çš„ç‰ˆæœ¬å·ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œ åœ¨åªæœ‰å°‘æ•°ï¼ˆminorityï¼‰ Sentinel è¿›ç¨‹æ­£å¸¸è¿ä½œçš„æƒ…å†µä¸‹ï¼ŒSentinel æ˜¯ä¸èƒ½æ‰§è¡Œè‡ªåŠ¨æ•…éšœè¿ç§»çš„ã€‚ sentinel down-after-milliseconds mymaster 10000 è¡¨ç¤ºmasterè¢«å½“å‰sentinelå®ä¾‹è®¤å®šä¸ºå¤±æ•ˆçš„é—´éš”æ—¶é—´ã€‚ masteråœ¨å¤šé•¿æ—¶é—´å†…ä¸€ç›´æ²¡æœ‰ç»™Sentineè¿”å›æœ‰æ•ˆä¿¡æ¯ï¼Œåˆ™è®¤å®šè¯¥masterä¸»è§‚ä¸‹çº¿ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœå¤šä¹…æ²¡è”ç³»ä¸Šredis-servevrï¼Œè®¤ä¸ºè¿™ä¸ªredis-serverè¿›å…¥åˆ°å¤±æ•ˆï¼ˆSDOWNï¼‰çŠ¶æ€ã€‚ å¦‚æœæœåŠ¡å™¨åœ¨ç»™å®šçš„æ¯«ç§’æ•°ä¹‹å†…ï¼Œ æ²¡æœ‰è¿”å› Sentinel å‘é€çš„ PING å‘½ä»¤çš„å›å¤ï¼Œ æˆ–è€…è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œ é‚£ä¹ˆ Sentinel å°†è¿™ä¸ªæœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆsubjectively downï¼Œç®€ç§° SDOWNï¼‰ã€‚ä¸è¿‡åªæœ‰ä¸€ä¸ª Sentinel å°†æœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿å¹¶ä¸ä¸€å®šä¼šå¼•èµ·æœåŠ¡å™¨çš„è‡ªåŠ¨æ•…éšœè¿ç§»ï¼š åªæœ‰åœ¨è¶³å¤Ÿæ•°é‡çš„ Sentinel éƒ½å°†ä¸€ä¸ªæœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ä¹‹åï¼Œ æœåŠ¡å™¨æ‰ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆobjectively downï¼Œ ç®€ç§° ODOWNï¼‰ï¼Œè¿™æ—¶è‡ªåŠ¨æ•…éšœè¿ç§»æ‰ä¼šæ‰§è¡Œã€‚å°†æœåŠ¡å™¨æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿æ‰€éœ€çš„ Sentinel æ•°é‡ç”±å¯¹ä¸»æœåŠ¡å™¨çš„é…ç½®å†³å®šã€‚ sentinel auth-pass mymaster 123456 è®¾ç½®sentinelè¿æ¥çš„masterå’Œslaveçš„å¯†ç ï¼Œè¿™ä¸ªéœ€è¦å’Œredis.confæ–‡ä»¶ä¸­è®¾ç½®çš„å¯†ç ä¸€æ ·ã€‚ sentinel failover-timeout mymaster 10000 failoverè¿‡æœŸæ—¶é—´ï¼Œå½“failoverå¼€å§‹åï¼Œåœ¨æ­¤æ—¶é—´å†…ä»ç„¶æ²¡æœ‰è§¦å‘ä»»ä½•failoveræ“ä½œï¼Œå½“å‰sentinelå°†ä¼šè®¤ä¸ºæ­¤æ¬¡failoerå¤±è´¥ã€‚æ‰§è¡Œæ•…éšœè¿ç§»è¶…æ—¶æ—¶é—´ï¼Œå³åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å¤§å¤šæ•°çš„sentinel åé¦ˆmasterä¸‹çº¿ï¼Œè¯¥æ•…éšœè¿ç§»è®¡åˆ’åˆ™å¤±æ•ˆ sentinel parallel-syncs mymaster 1 å½“åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œè®¾ç½®å‡ ä¸ªslaveåŒæ—¶è¿›è¡Œåˆ‡æ¢masterï¼Œè¯¥å€¼è¶Šå¤§ï¼Œåˆ™å¯èƒ½å°±æœ‰è¶Šå¤šçš„slaveåœ¨åˆ‡æ¢masteræ—¶ä¸å¯ç”¨ï¼Œå¯ä»¥å°†è¯¥å€¼è®¾ç½®ä¸º1ï¼Œå³ä¸€ä¸ªä¸€ä¸ªæ¥ï¼Œè¿™æ ·åœ¨æŸä¸ªslaveè¿›è¡Œåˆ‡æ¢masteråŒæ­¥æ•°æ®æ—¶ï¼Œå…¶ä½™çš„slaveè¿˜èƒ½æ­£å¸¸å·¥ä½œï¼Œä»¥æ­¤ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªä»æœåŠ¡å™¨å¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚ Dockerå¯åŠ¨å®¹å™¨ 12345678910docker run \\-d --network=host \\--name s3-505 \\--restart=always \\-v /media/psf/Linux/df/redis/sentinel-config/sentinel3.conf:/etc/redis/sentinel.conf \\-v /var/df/sentinel/sdata:/data \\--privileged=true \\--sysctl net.core.somaxconn=1024 \\redis:5.0.5 \\redis-sentinel /etc/redis/sentinel.conf æ•ˆæœsentinel mastersæŸ¥çœ‹ä¸»èŠ‚ç‚¹çŠ¶æ€sentinel slaves mymasteræŸ¥çœ‹ä¸»èŠ‚ç‚¹ä¸‹ä»èŠ‚ç‚¹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°2ä¸ªä»èŠ‚ç‚¹æŸ¥çœ‹Sentinel Log è‡³æ­¤æˆ‘ä»¬å·²ç»åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šå®Œæ•´çš„æ­å»ºäº†Redis-Sentinelç¯å¢ƒ å¸¸ç”¨å‘½ä»¤ç™»é™†åˆ°å¯¹åº”çš„sentinelæœåŠ¡åï¼Œredis-cli -h 10.211.55.15 -p 26380 PING ï¼šè¿”å› PONG ã€‚ SENTINEL masters ï¼šåˆ—å‡ºæ‰€æœ‰è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨ï¼Œä»¥åŠè¿™äº›ä¸»æœåŠ¡å™¨çš„å½“å‰çŠ¶æ€ï¼› SENTINEL slaves &lt;master name&gt; ï¼šåˆ—å‡ºç»™å®šä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œä»¥åŠè¿™äº›ä»æœåŠ¡å™¨çš„å½“å‰çŠ¶æ€ï¼› SENTINEL get-master-addr-by-name &lt;master name&gt; ï¼š è¿”å›ç»™å®šåå­—çš„ä¸»æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£å·ã€‚ å¦‚æœè¿™ä¸ªä¸»æœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œ æˆ–è€…é’ˆå¯¹è¿™ä¸ªä¸»æœåŠ¡å™¨çš„æ•…éšœè½¬ç§»æ“ä½œå·²ç»å®Œæˆï¼Œ é‚£ä¹ˆè¿™ä¸ªå‘½ä»¤è¿”å›æ–°çš„ä¸»æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£å·ï¼› SENTINEL reset &lt;pattern&gt; ï¼š é‡ç½®æ‰€æœ‰åå­—å’Œç»™å®šæ¨¡å¼ pattern ç›¸åŒ¹é…çš„ä¸»æœåŠ¡å™¨ã€‚ pattern å‚æ•°æ˜¯ä¸€ä¸ª Glob é£æ ¼çš„æ¨¡å¼ã€‚ é‡ç½®æ“ä½œæ¸…æ¥šä¸»æœåŠ¡å™¨ç›®å‰çš„æ‰€æœ‰çŠ¶æ€ï¼Œ åŒ…æ‹¬æ­£åœ¨æ‰§è¡Œä¸­çš„æ•…éšœè½¬ç§»ï¼Œ å¹¶ç§»é™¤ç›®å‰å·²ç»å‘ç°å’Œå…³è”çš„ï¼Œ ä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ä»æœåŠ¡å™¨å’Œ Sentinel ï¼› SENTINEL failover &lt;master name&gt; ï¼š å½“ä¸»æœåŠ¡å™¨å¤±æ•ˆæ—¶ï¼Œ åœ¨ä¸è¯¢é—®å…¶ä»– Sentinel æ„è§çš„æƒ…å†µä¸‹ï¼Œ å¼ºåˆ¶å¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»ã€‚ ï¼ˆä¸è¿‡å‘èµ·æ•…éšœè½¬ç§»çš„ Sentinel ä¼šå‘å…¶ä»– Sentinel å‘é€ä¸€ä¸ªæ–°çš„é…ç½®ï¼Œå…¶ä»– Sentinel ä¼šæ ¹æ®è¿™ä¸ªé…ç½®è¿›è¡Œç›¸åº”çš„æ›´æ–°ï¼‰ SENTINEL MONITOR &lt;name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt; è¿™ä¸ªå‘½ä»¤å‘Šè¯‰sentinelå»ç›‘å¬ä¸€ä¸ªæ–°çš„master SENTINEL REMOVE &lt;name&gt; å‘½ä»¤sentinelæ”¾å¼ƒå¯¹æŸä¸ªmasterçš„ç›‘å¬ SENTINEL SET &lt;name&gt; &lt;option&gt; &lt;value&gt; è¿™ä¸ªå‘½ä»¤å¾ˆåƒRedisçš„CONFIG SETå‘½ä»¤ï¼Œç”¨æ¥æ”¹å˜æŒ‡å®šmasterçš„é…ç½®ã€‚æ”¯æŒå¤šä¸ªã€‚ä¾‹å¦‚ä»¥ä¸‹å®ä¾‹ï¼šSENTINEL SET objects-cache-master down-after-milliseconds 1000åªè¦æ˜¯é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨çš„é…ç½®é¡¹ï¼Œéƒ½å¯ä»¥ç”¨SENTINEL SETå‘½ä»¤æ¥è®¾ç½®ã€‚è¿™ä¸ªè¿˜å¯ä»¥ç”¨æ¥è®¾ç½®masterçš„å±æ€§ï¼Œæ¯”å¦‚è¯´quorum(ç¥¨æ•°)ï¼Œè€Œä¸éœ€è¦å…ˆåˆ é™¤masterï¼Œå†é‡æ–°æ·»åŠ masterã€‚ä¾‹å¦‚ï¼šSENTINEL SET objects-cache-master quorum 5 æ‰‹åŠ¨å®¹é”™ç°è±¡é€šè¿‡ä¸Šé¢sentinel logå›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°15èŠ‚ç‚¹çš„sentinelæ˜¾ç¤ºï¼Œä¸»èŠ‚ç‚¹æ˜¯15ï¼Œä»èŠ‚ç‚¹æ˜¯17å’Œ19ï¼Œåœ¨17ï¼Œ19åˆ†åˆ«æœ‰ä¸¤ä¸ªsentinelç›‘æ§æˆ‘ä»¬çš„ä¸»èŠ‚ç‚¹ã€‚ç°åœ¨æˆ‘ä»¬æ‰‹åŠ¨æ¨¡æ‹Ÿçº¿ä¸Šä¸»èŠ‚ç‚¹æŒ‚äº†çš„çŠ¶æ€ã€‚å…³é—­ä¸»èŠ‚ç‚¹ï¼Œsentinel logå¦‚ä¸‹ï¼š logè§£æ123456789101112131415161718192021222324252627// ä¸»è§‚ä¸‹çº¿masterèŠ‚ç‚¹:10.211.55.15 6380# +sdown master mymaster 10.211.55.15 6380,// é¢„ç•™ä¸€ä¸ªæ–°çš„epoch(çºªå…ƒ),ä¹Ÿå°±æ˜¯é…ç½®ç‰ˆæœ¬,ç‰ˆæœ¬å·ä¸º1# +new-epoch 1,// é€‰ä¸¾å‡ºsentinelçš„leaderä¸º89641c594597aabde5b19d58c5724c0b7e7649f0# +vote-for-leader 89641c594597aabde5b19d58c5724c0b7e7649f0 1,// å®¢è§‚ä¸‹çº¿10.211.55.15èŠ‚ç‚¹,æŠ•ç¥¨ç»“æœæ˜¯3,è§„å®šæœ€å°ç¥¨æ•°ä½2# +odown master mymaster 10.211.55.15 6380 #quorum 3/2,// å› ä¸º+vote-for-leader 89641c594597aabde5b19d58c5724c0b7e7649f0 1,å½“é€‰å¤±è´¥ï¼Œé‚£ä¹ˆåœ¨è®¾å®šçš„æ•…éšœè¿ç§»è¶…æ—¶æ—¶é—´ï¼ˆfailover-timout=1500ï¼‰çš„ä¸¤å€ä¹‹åï¼Œé‡æ–°å°è¯•å½“é€‰ã€‚# Next failover delay: I will not start a failover before Wed Oct 9 11:53:56 2019,// é€‰ä¸¾å‡ºçš„sentinel leader è¿›è¡Œæ›´æ–°é…ç½®æ–‡ä»¶# +config-update-from sentinel 89641c594597aabde5b19d58c5724c0b7e7649f0 10.211.55.17 26380 @ mymaster 10.211.55.15 6380,// åˆ‡æ¢masterèŠ‚ç‚¹ä¸º10.211.55.17 6380# +switch-master mymaster 10.211.55.15 6380 10.211.55.17 6380,// è®¾ç½®10.211.55.19 6380/10.211.55.15 6380ä¸ºmaster:10.211.55.17 6380çš„ä»èŠ‚ç‚¹* +slave slave 10.211.55.19:6380 10.211.55.19 6380 @ mymaster 10.211.55.17 6380,* +slave slave 10.211.55.15:6380 10.211.55.15 6380 @ mymaster 10.211.55.17 6380,// ä¸»è§‚ä¸‹çº¿ä»èŠ‚ç‚¹10.211.55.15:6380# +sdown slave 10.211.55.15:6380 10.211.55.15 6380 @ mymaster 10.211.55.17 6380, sentinel.confçš„å˜åŒ–1234567sentinel config-epoch mymaster 1sentinel leader-epoch mymaster 1sentinel known-replica mymaster 10.211.55.15 6380sentinel known-replica mymaster 10.211.55.19 6380sentinel known-sentinel mymaster 10.211.55.19 26380 a757e33ab258e4e6b19880af7019418d5752dc11sentinel known-sentinel mymaster 10.211.55.17 26380 89641c594597aabde5b19d58c5724c0b7e7649f0sentinel current-epoch 1 ä¸‹çº¿èŠ‚ç‚¹é‡æ–°ä¸Šçº¿11:X 09 Oct 2019 12:27:35.600 # -sdown slave 10.211.55.15:6380 10.211.55.15 6380 @ mymaster 10.211.55.17 6380 ç”±logå¯è§ï¼Œsentinelä¼šç§»é™¤è¯¥èŠ‚ç‚¹çš„ä¸‹çº¿çŠ¶æ€ï¼Œå¹¶ä½¿å…¶æˆä¸ºç°masterèŠ‚ç‚¹çš„slaveèŠ‚ç‚¹ã€‚ SpringBootæ•´åˆé…ç½®æ–‡ä»¶1234567891011121314spring: redis: jedis: pool: max-active: 10 max-wait: 10000 max-idle: 10 min-idle: 0 sentinel: master: mymaster nodes: 10.211.55.15:26380 10.211.55.17:26380 10.211.55.19:26380 password: 123456 ssl: false timeout: 10000 Config1234@Value(\"${spring.redis.sentinel.master}\")private String master;@Value(\"${spring.redis.sentinel.nodes}\")private String nodes; 1234String[] cNodes = nodes.split(\" \");Set&lt;String&gt; nodes = new HashSet&lt;&gt;(Arrays.asList(cNodes));RedisSentinelConfiguration redisConfig = new RedisSentinelConfiguration(master,nodes);redisConfig.setPassword(RedisPassword.of(password));","link":"/2019/10/19/RedisSentinel/"},{"title":"Redis(å•æœº)å®‰è£…éƒ¨ç½²ï¼Œä¸SpringBootæ•´åˆ(æœ‰redisé…ç½®è¯¦è§£)","text":"äº†è§£äº†Redisç›¸å…³åŸºç¡€çŸ¥è¯†åï¼Œæœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨Linuxä¸­ç”¨Dockerå¿«é€Ÿæ­å»ºRedisæœåŠ¡ï¼ˆå•æœºï¼‰ï¼Œå¹¶ä¸SpringBootè¿›è¡Œæ•´åˆã€‚ä½¿ç”¨RedisTemplateè¿›è¡Œredisçš„ç›¸å…³æ“ä½œã€‚ é€šè¿‡Dockerå®‰è£…RedisRedisç‰ˆæœ¬5.0.5SpringBootç‰ˆæœ¬2.0.4 å‡†å¤‡é…ç½®æ–‡ä»¶å¦‚æœè¦è‡ªå®šä¹‰å¯åŠ¨dockerçš„Rediså®¹å™¨ï¼Œéœ€è¦å»å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶redis.confè¿›è¡Œæ›´æ”¹,ä»¥ä¸‹æ˜¯dockerä¸‹æ›´æ”¹çš„å•æœºç‰ˆé…ç½®æ–‡ä»¶å†…å®¹ã€‚123456789101112daemonize no #dockerè®¾ç½®ä¸ºyesæ— æ³•å¯åŠ¨#å®‰å…¨æƒ…å†µçš„å‡ ä¸ªç‰¹æ®Šé…ç½®ï¼šrequirepass 123456protected-mode yesbind 0.0.0.0#å…å¯†æƒ…å†µï¼š#bind 0.0.0.0#protected-mode noport 6379appendonly yesappendfsync everysec Dockeréƒ¨ç½²æ‹‰å–å¯¹åº”ç‰ˆæœ¬é•œåƒ1docker pull redis:5.0.5 åˆ›å»ºå®¹å™¨123456789docker run -d -it --privileged=true -v /media/psf/Linux/df/redis/config/redis6.conf:/etc/redis/redis.conf --privileged=true -v /var/df/cluster-redis/data:/data --restart always --name redis5.0.5 --net=host --sysctl net.core.somaxconn=1024 redis-cluster:5.0.5 redis-server /etc/redis/redis.conf æŸ¥çœ‹é•œåƒè¿è¡Œæƒ…å†µ1docker ps é€šè¿‡rdmè¿æ¥å‘½ä»¤æµ‹è¯• Spring Data Redisä¸JedisJedisJedisæ˜¯redisçš„javaå®¢æˆ·ç«¯ï¼Œé€šè¿‡å®ƒå¯ä»¥å¯¹redisè¿›è¡Œæ“ä½œã€‚ ä¸ä¹‹åŠŸèƒ½ç›¸ä¼¼çš„è¿˜åŒ…æ‹¬ï¼šLettuceç­‰ã€‚ Spring Data Rediså®ƒä¾èµ–jedisæˆ–Lettuceï¼Œå®é™…ä¸Šæ˜¯å¯¹jedisè¿™äº›å®¢æˆ·ç«¯çš„å°è£…ï¼Œæä¾›ä¸€å¥—ä¸å®¢æˆ·ç«¯æ— å…³çš„apiä¾›åº”ç”¨ä½¿ç”¨ï¼Œä»è€Œä½ åœ¨ä»ä¸€ä¸ªrediså®¢æˆ·ç«¯åˆ‡æ¢ä¸ºå¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç ã€‚spring-boot-data-redis å†…éƒ¨å®ç°äº†å¯¹Lettuceå’Œjedisä¸¤ä¸ªå®¢æˆ·ç«¯çš„å°è£…ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯Lettuceã€‚ è¿æ¥åŒ…ä½œä¸ºå¤šä¸ªRedisé©±åŠ¨ç¨‹åºï¼ˆLettuceå’ŒJedisï¼‰çš„ä½çº§æŠ½è±¡ã€‚ å¼‚å¸¸ç¿»è¯‘åˆ°Springçš„ä¾¿æºå¼æ•°æ®è®¿é—®å¼‚å¸¸å±‚æ¬¡ç»“æ„Redisçš„é©±åŠ¨ç¨‹åºä¾‹å¤–ã€‚ RedisTemplateï¼Œæä¾›é«˜çº§æŠ½è±¡ï¼Œç”¨äºæ‰§è¡Œå„ç§Redisæ“ä½œï¼Œå¼‚å¸¸è½¬æ¢å’Œåºåˆ—åŒ–æ”¯æŒã€‚ Pubsubæ”¯æŒï¼ˆä¾‹å¦‚æ¶ˆæ¯é©±åŠ¨çš„POJOçš„MessageListenerContainerï¼‰ã€‚ Redis Sentinelå’ŒRedis Clusteræ”¯æŒã€‚ ä½¿ç”¨Lettuceé©±åŠ¨ç¨‹åºçš„Reactive APIã€‚ JDKï¼ŒStringï¼ŒJSONå’ŒSpring Object / XMLæ˜ å°„åºåˆ—åŒ–ç¨‹åºã€‚ åœ¨Redisä¹‹ä¸Šçš„JDK Collectionå®ç°ã€‚ åŸå­è®¡æ•°å™¨æ”¯æŒè¯¾ç¨‹ã€‚ æ’åºå’Œæµæ°´çº¿åŠŸèƒ½ã€‚ ä¸“é—¨æ”¯æŒSORTï¼ŒSORT / GETæ¨¡å¼å’Œè¿”å›çš„æ‰¹é‡å€¼ã€‚ Redis å®ç°äº†Spring 3.1ç¼“å­˜æŠ½è±¡ã€‚ è‡ªåŠ¨å®ç°Repositoryæ¥å£ï¼ŒåŒ…æ‹¬æ”¯æŒè‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•@EnableRedisRepositoriesã€‚ CDIå¯¹å­˜å‚¨åº“çš„æ”¯æŒã€‚ SpringBootæ•´åˆå•æœºç‰ˆredisä½¿ç”¨redisTemplateè¿›è¡Œäº¤äº’ pom.xmlä¾èµ–æ–°ç‰ˆæœ¬ï¼šåœ¨æ–°ç‰ˆæœ¬ä¸­spring-boot-starter-redisç§»é™¤äº†jedisä¾èµ–ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨åˆ°jedisæä¾›çš„jedispoolï¼Œæ‰€ä»¥è¦è¿½åŠ å¼•å…¥jedisåŒ…12345678910&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-redis&lt;/artifactId&gt; &lt;version&gt;2.1.8.RELEASE&lt;/version&gt;&lt;/dependency&gt; æ—§ç‰ˆæœ¬ï¼š12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-redis&lt;/artifactId&gt; &lt;version&gt;2.1.8.RELEASE&lt;/version&gt;&lt;/dependency&gt; æ·»åŠ é…ç½®æ–‡ä»¶1234567891011121314spring: redis: host: 10.211.55.15 port: 6379 password: 123456 database: 0 timeout: 10000 ssl: false jedis: pool: max-active: 10 max-wait: 10000 max-idle: 10 min-idle: 0 åˆ›å»ºRedisConfig1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586@Configurationpublic class RedisConfig { @Value(\"${spring.redis.database}\") private int database; @Value(\"${spring.redis.host}\") private String host; @Value(\"${spring.redis.port}\") private int port; @Value(\"${spring.redis.password}\") private String password; @Value(\"${spring.redis.timeout}\") private int timeout; @Value(\"${spring.redis.jedis.pool.max-active}\") private int maxActive; @Value(\"${spring.redis.jedis.pool.max-idle}\") private int maxIdle; @Value(\"${spring.redis.jedis.pool.min-idle}\") private int minIdle; @Value(\"${spring.redis.jedis.pool.max-wait}\") private long maxWaitMillis; @Value(\"${spring.redis.ssl}\") private boolean ssl; @Bean public RedisConnectionFactory redisConnectionFactory(){ RedisStandaloneConfiguration redisConfig = new RedisStandaloneConfiguration(); redisConfig.setHostName(host); redisConfig.setPort(port); redisConfig.setPassword(RedisPassword.of(password)); redisConfig.setDatabase(database); //è®¾ç½®è¿æ¥æ±  JedisPoolConfig jedisPoolConfig = new JedisPoolConfig(); jedisPoolConfig.setMaxIdle(maxIdle); jedisPoolConfig.setMinIdle(minIdle); jedisPoolConfig.setMaxWaitMillis(maxWaitMillis); // è¿æ¥è€—å°½æ—¶æ˜¯å¦é˜»å¡, falseæŠ¥å¼‚å¸¸,tureé˜»å¡ç›´åˆ°è¶…æ—¶, é»˜è®¤true jedisPoolConfig.setBlockWhenExhausted(true); // æ˜¯å¦å¯ç”¨poolçš„jmxç®¡ç†åŠŸèƒ½, é»˜è®¤true jedisPoolConfig.setJmxEnabled(true); JedisClientConfiguration jedisClientConfiguration; if(ssl){ jedisClientConfiguration = JedisClientConfiguration.builder() .usePooling().poolConfig(jedisPoolConfig) .and().readTimeout(Duration.ofMillis(timeout)) .useSsl().build(); }else{ jedisClientConfiguration = JedisClientConfiguration.builder() .usePooling().poolConfig(jedisPoolConfig).build(); } return new JedisConnectionFactory(redisConfig,jedisClientConfiguration); } @Bean public RedisTemplate&lt;String,String&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory){ RedisTemplate&lt;String,String&gt; redisTemplate = new RedisTemplate&lt;String,String&gt;(); redisTemplate.setConnectionFactory(redisConnectionFactory); RedisSerializer&lt;Object&gt; serializer = getRedisSerializer(); //è®¾ç½®åºåˆ—åŒ–å™¨ redisTemplate.setDefaultSerializer(serializer); redisTemplate.setKeySerializer(new StringRedisSerializer()); redisTemplate.setValueSerializer(serializer); redisTemplate.setHashKeySerializer(new StringRedisSerializer()); redisTemplate.setHashValueSerializer(serializer); //å¼€å¯äº‹åŠ¡ redisTemplate.setEnableTransactionSupport(true); redisTemplate.afterPropertiesSet(); return redisTemplate; } /** * Redisåºåˆ—åŒ–æ–¹å¼ * @return */ private RedisSerializer getRedisSerializer(){ Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class); ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); //è§£å†³LocalDateTimeçš„åºåˆ—åŒ–é”™è¯¯ om.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS); om.registerModule(new JavaTimeModule()); jackson2JsonRedisSerializer.setObjectMapper(om); return jackson2JsonRedisSerializer; }} åˆ›å»ºRedisServiceåœ¨RedisServiceä¸­å°è£…ä¸€äº›å¸¸ç”¨çš„redisæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å‚è€ƒRedisTemplateçš„apiè‡ªè¡Œå°è£…ï¼Œä¸‹é¢ç®€å•ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869@Servicepublic class RedisService { @Autowired private RedisTemplate redisTemplate; /** * å†™å…¥ç¼“å­˜ * * @param key * @param value * @return */ public boolean set(final String key, Object value) { boolean result = false; try { ValueOperations&lt;Serializable, Object&gt; operations = redisTemplate.opsForValue(); operations.set(key, value); result = true; } catch (Exception e) { e.printStackTrace(); } return result; } /** * å†™å…¥ç¼“å­˜è®¾ç½®æ—¶æ•ˆæ—¶é—´ * * @param key * @param value * @return */ public boolean set(final String key, Object value, Long expireTime) { boolean result = false; try { ValueOperations&lt;Serializable, Object&gt; operations = redisTemplate.opsForValue(); operations.set(key, value); redisTemplate.expire(key, expireTime, TimeUnit.SECONDS); result = true; } catch (Exception e) { e.printStackTrace(); } return result; } /** * è¯»å–ç¼“å­˜ * * @param key * @return */ public Object genValue(final String key) { Object result = null; ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue(); result = operations.get(key); return result; } /** * å“ˆå¸Œ æ·»åŠ  * * @param key * @param hashKey * @param value */ public void hmSet(String key, Object hashKey, Object value) { HashOperations&lt;String, Object, Object&gt; hash = redisTemplate.opsForHash(); hash.put(key, hashKey, value); }} RedisTemplateRedisTemplateä¸­å®šä¹‰äº†å¯¹5ç§æ•°æ®ç»“æ„æ¥å¯¹redisè¿›è¡Œæ“ä½œ:12345redisTemplate.opsForValue();//æ“ä½œå­—ç¬¦ä¸²redisTemplate.opsForHash();//æ“ä½œhashredisTemplate.opsForList();//æ“ä½œlistredisTemplate.opsForSet();//æ“setredisTemplate.opsForZSet();//æ“ä½œsortset ä»¥ValueOperationsä¸ºä¾‹,æä¾›å¦‚ä¸‹æ¥å£ Redis5.0é…ç½®è¯¦è§£123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281#æ˜¯å¦åœ¨åå°æ‰§è¡Œï¼Œyesï¼šåå°è¿è¡Œï¼›noï¼šä¸æ˜¯åå°è¿è¡Œdaemonize yes #æ˜¯å¦å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œé»˜è®¤å¼€å¯ã€‚è¦æ˜¯é…ç½®é‡Œæ²¡æœ‰æŒ‡å®šbindå’Œå¯†ç ã€‚å¼€å¯è¯¥å‚æ•°åï¼Œredisåªä¼šæœ¬åœ°è¿›è¡Œè®¿é—®ï¼Œæ‹’ç»å¤–éƒ¨è®¿é—®ã€‚protected-mode yes #redisçš„è¿›ç¨‹æ–‡ä»¶pidfile /var/run/redis/redis-server.pid #redisç›‘å¬çš„ç«¯å£å·ã€‚port 6379 #æ­¤å‚æ•°ç¡®å®šäº†TCPè¿æ¥ä¸­å·²å®Œæˆé˜Ÿåˆ—(å®Œæˆä¸‰æ¬¡æ¡æ‰‹ä¹‹å)çš„é•¿åº¦ï¼Œ å½“ç„¶æ­¤å€¼å¿…é¡»ä¸å¤§äºLinuxç³»ç»Ÿå®šä¹‰çš„/proc/sys/net/core/somaxconnå€¼ï¼Œé»˜è®¤æ˜¯511ï¼Œè€ŒLinuxçš„é»˜è®¤å‚æ•°å€¼æ˜¯128ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡å¤§å¹¶ä¸”å®¢æˆ·ç«¯é€Ÿåº¦ç¼“æ…¢çš„æ—¶å€™ï¼Œå¯ä»¥å°†è¿™äºŒä¸ªå‚æ•°ä¸€èµ·å‚è€ƒè®¾å®šã€‚è¯¥å†…æ ¸å‚æ•°é»˜è®¤å€¼ä¸€èˆ¬æ˜¯128ï¼Œå¯¹äºè´Ÿè½½å¾ˆå¤§çš„æœåŠ¡ç¨‹åºæ¥è¯´å¤§å¤§çš„ä¸å¤Ÿã€‚ä¸€èˆ¬ä¼šå°†å®ƒä¿®æ”¹ä¸º2048æˆ–è€…æ›´å¤§ã€‚åœ¨/etc/sysctl.confä¸­æ·»åŠ :net.core.somaxconn = 2048ï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­æ‰§è¡Œsysctl -pã€‚tcp-backlog 511 #æŒ‡å®š redis åªæ¥æ”¶æ¥è‡ªäºè¯¥ IP åœ°å€çš„è¯·æ±‚ï¼Œå¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œé‚£ä¹ˆå°†å¤„ç†æ‰€æœ‰è¯·æ±‚bind 127.0.0.1 #é…ç½®unix socketæ¥è®©redisæ”¯æŒç›‘å¬æœ¬åœ°è¿æ¥ã€‚# unixsocket /var/run/redis/redis.sock #é…ç½®unix socketä½¿ç”¨æ–‡ä»¶çš„æƒé™# unixsocketperm 700 # æ­¤å‚æ•°ä¸ºè®¾ç½®å®¢æˆ·ç«¯ç©ºé—²è¶…è¿‡timeoutï¼ŒæœåŠ¡ç«¯ä¼šæ–­å¼€è¿æ¥ï¼Œä¸º0åˆ™æœåŠ¡ç«¯ä¸ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œä¸èƒ½å°äº0ã€‚timeout 0 #tcp keepaliveå‚æ•°ã€‚å¦‚æœè®¾ç½®ä¸ä¸º0ï¼Œå°±ä½¿ç”¨é…ç½®tcpçš„SO_KEEPALIVEå€¼ï¼Œä½¿ç”¨keepaliveæœ‰ä¸¤ä¸ªå¥½å¤„:æ£€æµ‹æŒ‚æ‰çš„å¯¹ç«¯ã€‚é™ä½ä¸­é—´è®¾å¤‡å‡ºé—®é¢˜è€Œå¯¼è‡´ç½‘ç»œçœ‹ä¼¼è¿æ¥å´å·²ç»ä¸å¯¹ç«¯ç«¯å£çš„é—®é¢˜ã€‚åœ¨Linuxå†…æ ¸ä¸­ï¼Œè®¾ç½®äº†keepaliveï¼Œredisä¼šå®šæ—¶ç»™å¯¹ç«¯å‘é€ackã€‚æ£€æµ‹åˆ°å¯¹ç«¯å…³é—­éœ€è¦ä¸¤å€çš„è®¾ç½®å€¼ã€‚tcp-keepalive 0 #æŒ‡å®šäº†æœåŠ¡ç«¯æ—¥å¿—çš„çº§åˆ«ã€‚çº§åˆ«åŒ…æ‹¬ï¼šdebugï¼ˆå¾ˆå¤šä¿¡æ¯ï¼Œæ–¹ä¾¿å¼€å‘ã€æµ‹è¯•ï¼‰ï¼Œverboseï¼ˆè®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰debugçº§åˆ«ä¿¡æ¯å¤šï¼‰ï¼Œnoticeï¼ˆé€‚å½“çš„æ—¥å¿—çº§åˆ«ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼Œwarnï¼ˆåªæœ‰éå¸¸é‡è¦çš„ä¿¡æ¯ï¼‰loglevel notice #æŒ‡å®šäº†è®°å½•æ—¥å¿—çš„æ–‡ä»¶ã€‚ç©ºå­—ç¬¦ä¸²çš„è¯ï¼Œæ—¥å¿—ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ã€‚åå°è¿è¡Œçš„redisæ ‡å‡†è¾“å‡ºæ˜¯/dev/nullã€‚logfile /var/log/redis/redis-server.log #æ˜¯å¦æ‰“å¼€è®°å½•syslogåŠŸèƒ½# syslog-enabled no #syslogçš„æ ‡è¯†ç¬¦ã€‚# syslog-ident redis #æ—¥å¿—çš„æ¥æºã€è®¾å¤‡# syslog-facility local0 #æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“æ˜¯DB 0ã€‚å¯ä»¥é€šè¿‡SELECTå‘½ä»¤é€‰æ‹©ä¸€ä¸ªdbdatabases 16 # redisæ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®è¯¥å€¼å®šæœŸå†™å…¥ç£ç›˜ã€‚# æ³¨é‡Šæ‰â€œsaveâ€è¿™ä¸€è¡Œé…ç½®é¡¹å°±å¯ä»¥è®©ä¿å­˜æ•°æ®åº“åŠŸèƒ½å¤±æ•ˆ# 900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰å†…è‡³å°‘1ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰# 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…è‡³å°‘10ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰# 60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰å†…è‡³å°‘10000ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰save 900 1save 300 10save 60 10000 #å½“RDBæŒä¹…åŒ–å‡ºç°é”™è¯¯åï¼Œæ˜¯å¦ä¾ç„¶è¿›è¡Œç»§ç»­è¿›è¡Œå·¥ä½œï¼Œyesï¼šä¸èƒ½è¿›è¡Œå·¥ä½œï¼Œnoï¼šå¯ä»¥ç»§ç»­è¿›è¡Œå·¥ä½œï¼Œå¯ä»¥é€šè¿‡infoä¸­çš„rdb_last_bgsave_statusäº†è§£RDBæŒä¹…åŒ–æ˜¯å¦æœ‰é”™è¯¯stop-writes-on-bgsave-error yes #ä½¿ç”¨å‹ç¼©rdbæ–‡ä»¶ï¼Œrdbæ–‡ä»¶å‹ç¼©ä½¿ç”¨LZFå‹ç¼©ç®—æ³•ï¼Œyesï¼šå‹ç¼©ï¼Œä½†æ˜¯éœ€è¦ä¸€äº›cpuçš„æ¶ˆè€—ã€‚noï¼šä¸å‹ç¼©ï¼Œéœ€è¦æ›´å¤šçš„ç£ç›˜ç©ºé—´rdbcompression yes #æ˜¯å¦æ ¡éªŒrdbæ–‡ä»¶ã€‚ä»rdbæ ¼å¼çš„ç¬¬äº”ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨rdbæ–‡ä»¶çš„æœ«å°¾ä¼šå¸¦ä¸ŠCRC64çš„æ ¡éªŒå’Œã€‚è¿™è·Ÿæœ‰åˆ©äºæ–‡ä»¶çš„å®¹é”™æ€§ï¼Œä½†æ˜¯åœ¨ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæœ‰å¤§æ¦‚10%çš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥å¦‚æœä½ è¿½æ±‚é«˜æ€§èƒ½ï¼Œå¯ä»¥å…³é—­è¯¥é…ç½®ã€‚rdbchecksum yes #rdbæ–‡ä»¶çš„åç§°dbfilename dump.rdb #æ•°æ®ç›®å½•ï¼Œæ•°æ®åº“çš„å†™å…¥ä¼šåœ¨è¿™ä¸ªç›®å½•ã€‚rdbã€aofæ–‡ä»¶ä¹Ÿä¼šå†™åœ¨è¿™ä¸ªç›®å½•dir /var/lib/redis ############### ä¸»ä»å¤åˆ¶ ############### #å¤åˆ¶é€‰é¡¹ï¼Œslaveå¤åˆ¶å¯¹åº”çš„masterã€‚# slaveof &lt;masterip&gt; &lt;masterport&gt; #å¦‚æœmasterè®¾ç½®äº†requirepassï¼Œé‚£ä¹ˆslaveè¦è¿ä¸Šmasterï¼Œéœ€è¦æœ‰masterçš„å¯†ç æ‰è¡Œã€‚masterauthå°±æ˜¯ç”¨æ¥é…ç½®masterçš„å¯†ç ï¼Œè¿™æ ·å¯ä»¥åœ¨è¿ä¸Šmasteråè¿›è¡Œè®¤è¯ã€‚# masterauth &lt;master-password&gt; #å½“ä»åº“åŒä¸»æœºå¤±å»è¿æ¥æˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œï¼Œä»æœºåº“æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼š1) å¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºyes(é»˜è®¤è®¾ç½®)ï¼Œä»åº“ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚2) å¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºnoï¼Œé™¤å»INFOå’ŒSLAVOFå‘½ä»¤ä¹‹å¤–çš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯â€SYNC with master in progressâ€ã€‚slave-serve-stale-data yes #ä½œä¸ºä»æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯åªè¯»çš„ï¼ˆyesï¼‰ï¼Œå¯ä»¥ä¿®æ”¹æˆNOï¼Œç”¨äºå†™ï¼ˆä¸å»ºè®®ï¼‰ã€‚slave-read-only yes #æ˜¯å¦ä½¿ç”¨socketæ–¹å¼å¤åˆ¶æ•°æ®ã€‚ç›®å‰rediså¤åˆ¶æä¾›ä¸¤ç§æ–¹å¼ï¼Œdiskå’Œsocketã€‚å¦‚æœæ–°çš„slaveè¿ä¸Šæ¥æˆ–è€…é‡è¿çš„slaveæ— æ³•éƒ¨åˆ†åŒæ­¥ï¼Œå°±ä¼šæ‰§è¡Œå…¨é‡åŒæ­¥ï¼Œmasterä¼šç”Ÿæˆrdbæ–‡ä»¶ã€‚æœ‰2ç§æ–¹å¼ï¼šdiskæ–¹å¼æ˜¯masteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æŠŠrdbæ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ï¼Œå†æŠŠç£ç›˜ä¸Šçš„rdbæ–‡ä»¶ä¼ é€’ç»™slaveã€‚socketæ˜¯masteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œç›´æ¥æŠŠrdbæ–‡ä»¶ä»¥socketçš„æ–¹å¼å‘ç»™slaveã€‚diskæ–¹å¼çš„æ—¶å€™ï¼Œå½“ä¸€ä¸ªrdbä¿å­˜çš„è¿‡ç¨‹ä¸­ï¼Œå¤šä¸ªslaveéƒ½èƒ½å…±äº«è¿™ä¸ªrdbæ–‡ä»¶ã€‚socketçš„æ–¹å¼å°±çš„ä¸€ä¸ªä¸ªslaveé¡ºåºå¤åˆ¶ã€‚åœ¨ç£ç›˜é€Ÿåº¦ç¼“æ…¢ï¼Œç½‘é€Ÿå¿«çš„æƒ…å†µä¸‹æ¨èç”¨socketæ–¹å¼ã€‚repl-diskless-sync no #disklesså¤åˆ¶çš„å»¶è¿Ÿæ—¶é—´ï¼Œé˜²æ­¢è®¾ç½®ä¸º0ã€‚ä¸€æ—¦å¤åˆ¶å¼€å§‹ï¼ŒèŠ‚ç‚¹ä¸ä¼šå†æ¥æ”¶æ–°slaveçš„å¤åˆ¶è¯·æ±‚ç›´åˆ°ä¸‹ä¸€ä¸ªrdbä¼ è¾“ã€‚æ‰€ä»¥æœ€å¥½ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç­‰æ›´å¤šçš„slaveè¿ä¸Šæ¥ã€‚repl-diskless-sync-delay 5 #slaveæ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”å‘æœåŠ¡å™¨å‘é€pingè¯·æ±‚ã€‚æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡ repl_ping_slave_period æ¥è®¾ç½®ï¼Œé»˜è®¤10ç§’ã€‚# repl-ping-slave-period 10 #å¤åˆ¶è¿æ¥è¶…æ—¶æ—¶é—´ã€‚masterå’Œslaveéƒ½æœ‰è¶…æ—¶æ—¶é—´çš„è®¾ç½®ã€‚masteræ£€æµ‹åˆ°slaveä¸Šæ¬¡å‘é€çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œå³è®¤ä¸ºslaveç¦»çº¿ï¼Œæ¸…é™¤è¯¥slaveä¿¡æ¯ã€‚slaveæ£€æµ‹åˆ°ä¸Šæ¬¡å’Œmasteräº¤äº’çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œåˆ™è®¤ä¸ºmasterç¦»çº¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯repl-timeoutéœ€è¦è®¾ç½®ä¸€ä¸ªæ¯”repl-ping-slave-periodæ›´å¤§çš„å€¼ï¼Œä¸ç„¶ä¼šç»å¸¸æ£€æµ‹åˆ°è¶…æ—¶ã€‚# repl-timeout 60 #æ˜¯å¦ç¦æ­¢å¤åˆ¶tcpé“¾æ¥çš„tcp nodelayå‚æ•°ï¼Œå¯ä¼ é€’yesæˆ–è€…noã€‚é»˜è®¤æ˜¯noï¼Œå³ä½¿ç”¨tcp nodelayã€‚å¦‚æœmasterè®¾ç½®äº†yesæ¥ç¦æ­¢tcp nodelayè®¾ç½®ï¼Œåœ¨æŠŠæ•°æ®å¤åˆ¶ç»™slaveçš„æ—¶å€™ï¼Œä¼šå‡å°‘åŒ…çš„æ•°é‡å’Œæ›´å°çš„ç½‘ç»œå¸¦å®½ã€‚ä½†æ˜¯è¿™ä¹Ÿå¯èƒ½å¸¦æ¥æ•°æ®çš„å»¶è¿Ÿã€‚é»˜è®¤æˆ‘ä»¬æ¨èæ›´å°çš„å»¶è¿Ÿï¼Œä½†æ˜¯åœ¨æ•°æ®é‡ä¼ è¾“å¾ˆå¤§çš„åœºæ™¯ä¸‹ï¼Œå»ºè®®é€‰æ‹©yesã€‚repl-disable-tcp-nodelay no #å¤åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¯å½¢å¤åˆ¶ç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜æœ€æ–°å¤åˆ¶çš„å‘½ä»¤ã€‚è¿™æ ·åœ¨slaveç¦»çº¿çš„æ—¶å€™ï¼Œä¸éœ€è¦å®Œå…¨å¤åˆ¶masterçš„æ•°æ®ï¼Œå¦‚æœå¯ä»¥æ‰§è¡Œéƒ¨åˆ†åŒæ­¥ï¼Œåªéœ€è¦æŠŠç¼“å†²åŒºçš„éƒ¨åˆ†æ•°æ®å¤åˆ¶ç»™slaveï¼Œå°±èƒ½æ¢å¤æ­£å¸¸å¤åˆ¶çŠ¶æ€ã€‚ç¼“å†²åŒºçš„å¤§å°è¶Šå¤§ï¼Œslaveç¦»çº¿çš„æ—¶é—´å¯ä»¥æ›´é•¿ï¼Œå¤åˆ¶ç¼“å†²åŒºåªæœ‰åœ¨æœ‰slaveè¿æ¥çš„æ—¶å€™æ‰åˆ†é…å†…å­˜ã€‚æ²¡æœ‰slaveçš„ä¸€æ®µæ—¶é—´ï¼Œå†…å­˜ä¼šè¢«é‡Šæ”¾å‡ºæ¥ï¼Œé»˜è®¤1mã€‚# repl-backlog-size 5mb #masteræ²¡æœ‰slaveä¸€æ®µæ—¶é—´ä¼šé‡Šæ”¾å¤åˆ¶ç¼“å†²åŒºçš„å†…å­˜ï¼Œrepl-backlog-ttlç”¨æ¥è®¾ç½®è¯¥æ—¶é—´é•¿åº¦ã€‚å•ä½ä¸ºç§’ã€‚# repl-backlog-ttl 3600 #å½“masterä¸å¯ç”¨ï¼ŒSentinelä¼šæ ¹æ®slaveçš„ä¼˜å…ˆçº§é€‰ä¸¾ä¸€ä¸ªmasterã€‚æœ€ä½çš„ä¼˜å…ˆçº§çš„slaveï¼Œå½“é€‰masterã€‚è€Œé…ç½®æˆ0ï¼Œæ°¸è¿œä¸ä¼šè¢«é€‰ä¸¾ã€‚slave-priority 100 #redisæä¾›äº†å¯ä»¥è®©masteråœæ­¢å†™å…¥çš„æ–¹å¼ï¼Œå¦‚æœé…ç½®äº†min-slaves-to-writeï¼Œå¥åº·çš„slaveçš„ä¸ªæ•°å°äºNï¼Œmaterå°±ç¦æ­¢å†™å…¥ã€‚masteræœ€å°‘å¾—æœ‰å¤šå°‘ä¸ªå¥åº·çš„slaveå­˜æ´»æ‰èƒ½æ‰§è¡Œå†™å‘½ä»¤ã€‚è¿™ä¸ªé…ç½®è™½ç„¶ä¸èƒ½ä¿è¯Nä¸ªslaveéƒ½ä¸€å®šèƒ½æ¥æ”¶åˆ°masterçš„å†™æ“ä½œï¼Œä½†æ˜¯èƒ½é¿å…æ²¡æœ‰è¶³å¤Ÿå¥åº·çš„slaveçš„æ—¶å€™ï¼Œmasterä¸èƒ½å†™å…¥æ¥é¿å…æ•°æ®ä¸¢å¤±ã€‚è®¾ç½®ä¸º0æ˜¯å…³é—­è¯¥åŠŸèƒ½ã€‚# min-slaves-to-write 3 #å»¶è¿Ÿå°äºmin-slaves-max-lagç§’çš„slaveæ‰è®¤ä¸ºæ˜¯å¥åº·çš„slaveã€‚# min-slaves-max-lag 10 # è®¾ç½®1æˆ–å¦ä¸€ä¸ªè®¾ç½®ä¸º0ç¦ç”¨è¿™ä¸ªç‰¹æ€§ã€‚# Setting one or the other to 0 disables the feature.# By default min-slaves-to-write is set to 0 (feature disabled) and# min-slaves-max-lag is set to 10. ############### å®‰å…¨ç›¸å…³ ############### #requirepassé…ç½®å¯ä»¥è®©ç”¨æˆ·ä½¿ç”¨AUTHå‘½ä»¤æ¥è®¤è¯å¯†ç ï¼Œæ‰èƒ½ä½¿ç”¨å…¶ä»–å‘½ä»¤ã€‚è¿™è®©rediså¯ä»¥ä½¿ç”¨åœ¨ä¸å—ä¿¡ä»»çš„ç½‘ç»œä¸­ã€‚ä¸ºäº†ä¿æŒå‘åçš„å…¼å®¹æ€§ï¼Œå¯ä»¥æ³¨é‡Šè¯¥å‘½ä»¤ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ç”¨æˆ·ä¹Ÿä¸éœ€è¦è®¤è¯ã€‚ä½¿ç”¨requirepassçš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå› ä¸ºrediså¤ªå¿«äº†ï¼Œæ¯ç§’å¯ä»¥è®¤è¯15wæ¬¡å¯†ç ï¼Œç®€å•çš„å¯†ç å¾ˆå®¹æ˜“è¢«æ”»ç ´ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨ä¸€ä¸ªæ›´å¤æ‚çš„å¯†ç ã€‚æ³¨æ„åªæœ‰å¯†ç æ²¡æœ‰ç”¨æˆ·åã€‚# requirepass foobared #æŠŠå±é™©çš„å‘½ä»¤ç»™ä¿®æ”¹æˆå…¶ä»–åç§°ã€‚æ¯”å¦‚CONFIGå‘½ä»¤å¯ä»¥é‡å‘½åä¸ºä¸€ä¸ªå¾ˆéš¾è¢«çŒœåˆ°çš„å‘½ä»¤ï¼Œè¿™æ ·ç”¨æˆ·ä¸èƒ½ä½¿ç”¨ï¼Œè€Œå†…éƒ¨å·¥å…·è¿˜èƒ½æ¥ç€ä½¿ç”¨ã€‚# rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52 #è®¾ç½®æˆä¸€ä¸ªç©ºçš„å€¼ï¼Œå¯ä»¥ç¦æ­¢ä¸€ä¸ªå‘½ä»¤# rename-command CONFIG &quot;&quot; ############### è¿›ç¨‹é™åˆ¶ç›¸å…³ ############### # è®¾ç½®èƒ½è¿ä¸Šredisçš„æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°é‡ã€‚é»˜è®¤æ˜¯10000ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚ç”±äºredisä¸åŒºåˆ†è¿æ¥æ˜¯å®¢æˆ·ç«¯è¿æ¥è¿˜æ˜¯å†…éƒ¨æ‰“å¼€æ–‡ä»¶æˆ–è€…å’Œslaveè¿æ¥ç­‰ï¼Œæ‰€ä»¥maxclientsæœ€å°å»ºè®®è®¾ç½®åˆ°32ã€‚å¦‚æœè¶…è¿‡äº†maxclientsï¼Œredisä¼šç»™æ–°çš„è¿æ¥å‘é€â€™max number of clients reachedâ€™ï¼Œå¹¶å…³é—­è¿æ¥ã€‚# maxclients 10000 #redisé…ç½®çš„æœ€å¤§å†…å­˜å®¹é‡ã€‚å½“å†…å­˜æ»¡äº†ï¼Œéœ€è¦é…åˆmaxmemory-policyç­–ç•¥è¿›è¡Œå¤„ç†ã€‚æ³¨æ„slaveçš„è¾“å‡ºç¼“å†²åŒºæ˜¯ä¸è®¡ç®—åœ¨maxmemoryå†…çš„ã€‚æ‰€ä»¥ä¸ºäº†é˜²æ­¢ä¸»æœºå†…å­˜ä½¿ç”¨å®Œï¼Œå»ºè®®è®¾ç½®çš„maxmemoryéœ€è¦æ›´å°ä¸€äº›ã€‚# maxmemory &lt;bytes&gt; #å†…å­˜å®¹é‡è¶…è¿‡maxmemoryåçš„å¤„ç†ç­–ç•¥ã€‚#volatile-lruï¼šåˆ©ç”¨LRUç®—æ³•ç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„keyã€‚#volatile-randomï¼šéšæœºç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„keyã€‚#volatile-ttlï¼šç§»é™¤å³å°†è¿‡æœŸçš„keyï¼Œæ ¹æ®æœ€è¿‘è¿‡æœŸæ—¶é—´æ¥åˆ é™¤ï¼ˆè¾…ä»¥TTLï¼‰#allkeys-lruï¼šåˆ©ç”¨LRUç®—æ³•ç§»é™¤ä»»ä½•keyã€‚#allkeys-randomï¼šéšæœºç§»é™¤ä»»ä½•keyã€‚#noevictionï¼šä¸ç§»é™¤ä»»ä½•keyï¼Œåªæ˜¯è¿”å›ä¸€ä¸ªå†™é”™è¯¯ã€‚#ä¸Šé¢çš„è¿™äº›é©±é€ç­–ç•¥ï¼Œå¦‚æœredisæ²¡æœ‰åˆé€‚çš„keyé©±é€ï¼Œå¯¹äºå†™å‘½ä»¤ï¼Œè¿˜æ˜¯ä¼šè¿”å›é”™è¯¯ã€‚rediså°†ä¸å†æ¥æ”¶å†™è¯·æ±‚ï¼Œåªæ¥æ”¶getè¯·æ±‚ã€‚å†™å‘½ä»¤åŒ…æ‹¬ï¼šset setnx setex append incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby getset mset msetnx exec sortã€‚# maxmemory-policy noeviction #lruæ£€æµ‹çš„æ ·æœ¬æ•°ã€‚ä½¿ç”¨lruæˆ–è€…ttlæ·˜æ±°ç®—æ³•ï¼Œä»éœ€è¦æ·˜æ±°çš„åˆ—è¡¨ä¸­éšæœºé€‰æ‹©sampleä¸ªkeyï¼Œé€‰å‡ºé—²ç½®æ—¶é—´æœ€é•¿çš„keyç§»é™¤ã€‚# maxmemory-samples 5 ############### APPEND ONLY æŒä¹…åŒ–æ–¹å¼ ############### #é»˜è®¤redisä½¿ç”¨çš„æ˜¯rdbæ–¹å¼æŒä¹…åŒ–ï¼Œè¿™ç§æ–¹å¼åœ¨è®¸å¤šåº”ç”¨ä¸­å·²ç»è¶³å¤Ÿç”¨äº†ã€‚ä½†æ˜¯rediså¦‚æœä¸­é€”å®•æœºï¼Œä¼šå¯¼è‡´å¯èƒ½æœ‰å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œæ ¹æ®saveæ¥ç­–ç•¥è¿›è¡ŒæŒä¹…åŒ–ï¼ŒAppend Only Fileæ˜¯å¦ä¸€ç§æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„æŒä¹…åŒ–ç‰¹æ€§ã€‚Redisä¼šæŠŠæ¯æ¬¡å†™å…¥çš„æ•°æ®åœ¨æ¥æ”¶åéƒ½å†™å…¥ appendonly.aof æ–‡ä»¶ï¼Œæ¯æ¬¡å¯åŠ¨æ—¶Rediséƒ½ä¼šå…ˆæŠŠè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®è¯»å…¥å†…å­˜é‡Œï¼Œå…ˆå¿½ç•¥RDBæ–‡ä»¶ã€‚appendonly no #aofæ–‡ä»¶åappendfilename &quot;appendonly.aof&quot; #aofæŒä¹…åŒ–ç­–ç•¥çš„é…ç½®#noè¡¨ç¤ºä¸æ‰§è¡Œfsyncï¼Œç”±æ“ä½œç³»ç»Ÿä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜ï¼Œé€Ÿåº¦æœ€å¿«ã€‚#alwaysè¡¨ç¤ºæ¯æ¬¡å†™å…¥éƒ½æ‰§è¡Œfsyncï¼Œä»¥ä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜ã€‚#everysecè¡¨ç¤ºæ¯ç§’æ‰§è¡Œä¸€æ¬¡fsyncï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±è¿™1sæ•°æ®ã€‚appendfsync everysec # åœ¨aofé‡å†™æˆ–è€…å†™å…¥rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œå¤§é‡IOï¼Œæ­¤æ—¶å¯¹äºeverysecå’Œalwaysçš„aofæ¨¡å¼æ¥è¯´ï¼Œæ‰§è¡Œfsyncä¼šé€ æˆé˜»å¡è¿‡é•¿æ—¶é—´ï¼Œno-appendfsync-on-rewriteå­—æ®µè®¾ç½®ä¸ºé»˜è®¤è®¾ç½®ä¸ºnoã€‚å¦‚æœå¯¹å»¶è¿Ÿè¦æ±‚å¾ˆé«˜çš„åº”ç”¨ï¼Œè¿™ä¸ªå­—æ®µå¯ä»¥è®¾ç½®ä¸ºyesï¼Œå¦åˆ™è¿˜æ˜¯è®¾ç½®ä¸ºnoï¼Œè¿™æ ·å¯¹æŒä¹…åŒ–ç‰¹æ€§æ¥è¯´è¿™æ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ã€‚è®¾ç½®ä¸ºyesè¡¨ç¤ºrewriteæœŸé—´å¯¹æ–°å†™æ“ä½œä¸fsync,æš‚æ—¶å­˜åœ¨å†…å­˜ä¸­,ç­‰rewriteå®Œæˆåå†å†™å…¥ï¼Œé»˜è®¤ä¸ºnoï¼Œå»ºè®®yesã€‚Linuxçš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ã€‚å¯èƒ½ä¸¢å¤±30ç§’æ•°æ®ã€‚no-appendfsync-on-rewrite no #aofè‡ªåŠ¨é‡å†™é…ç½®ã€‚å½“ç›®å‰aofæ–‡ä»¶å¤§å°è¶…è¿‡ä¸Šä¸€æ¬¡é‡å†™çš„aofæ–‡ä»¶å¤§å°çš„ç™¾åˆ†ä¹‹å¤šå°‘è¿›è¡Œé‡å†™ï¼Œå³å½“aofæ–‡ä»¶å¢é•¿åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™Redisèƒ½å¤Ÿè°ƒç”¨bgrewriteaofå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œé‡å†™ã€‚å½“å‰AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡æ—¥å¿—é‡å†™å¾—åˆ°AOFæ–‡ä»¶å¤§å°çš„äºŒå€ï¼ˆè®¾ç½®ä¸º100ï¼‰æ—¶ï¼Œè‡ªåŠ¨å¯åŠ¨æ–°çš„æ—¥å¿—é‡å†™è¿‡ç¨‹ã€‚auto-aof-rewrite-percentage 100#è®¾ç½®å…è®¸é‡å†™çš„æœ€å°aofæ–‡ä»¶å¤§å°ï¼Œé¿å…äº†è¾¾åˆ°çº¦å®šç™¾åˆ†æ¯”ä½†å°ºå¯¸ä»ç„¶å¾ˆå°çš„æƒ…å†µè¿˜è¦é‡å†™auto-aof-rewrite-min-size 64mb #aofæ–‡ä»¶å¯èƒ½åœ¨å°¾éƒ¨æ˜¯ä¸å®Œæ•´çš„ï¼Œå½“rediså¯åŠ¨çš„æ—¶å€™ï¼Œaofæ–‡ä»¶çš„æ•°æ®è¢«è½½å…¥å†…å­˜ã€‚é‡å¯å¯èƒ½å‘ç”Ÿåœ¨redisæ‰€åœ¨çš„ä¸»æœºæ“ä½œç³»ç»Ÿå®•æœºåï¼Œå°¤å…¶åœ¨ext4æ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰åŠ ä¸Šdata=orderedé€‰é¡¹ï¼ˆrediså®•æœºæˆ–è€…å¼‚å¸¸ç»ˆæ­¢ä¸ä¼šé€ æˆå°¾éƒ¨ä¸å®Œæ•´ç°è±¡ã€‚ï¼‰å‡ºç°è¿™ç§ç°è±¡ï¼Œå¯ä»¥é€‰æ‹©è®©redisé€€å‡ºï¼Œæˆ–è€…å¯¼å…¥å°½å¯èƒ½å¤šçš„æ•°æ®ã€‚å¦‚æœé€‰æ‹©çš„æ˜¯yesï¼Œå½“æˆªæ–­çš„aofæ–‡ä»¶è¢«å¯¼å…¥çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å‘å¸ƒä¸€ä¸ªlogç»™å®¢æˆ·ç«¯ç„¶åloadã€‚å¦‚æœæ˜¯noï¼Œç”¨æˆ·å¿…é¡»æ‰‹åŠ¨redis-check-aofä¿®å¤AOFæ–‡ä»¶æ‰å¯ä»¥ã€‚aof-load-truncated yes ############### LUA SCRIPTING ############### # å¦‚æœè¾¾åˆ°æœ€å¤§æ—¶é—´é™åˆ¶ï¼ˆæ¯«ç§’ï¼‰ï¼Œredisä¼šè®°ä¸ªlogï¼Œç„¶åè¿”å›errorã€‚å½“ä¸€ä¸ªè„šæœ¬è¶…è¿‡äº†æœ€å¤§æ—¶é™ã€‚åªæœ‰SCRIPT KILLå’ŒSHUTDOWN NOSAVEå¯ä»¥ç”¨ã€‚ç¬¬ä¸€ä¸ªå¯ä»¥æ€æ²¡æœ‰è°ƒwriteå‘½ä»¤çš„ä¸œè¥¿ã€‚è¦æ˜¯å·²ç»è°ƒç”¨äº†writeï¼Œåªèƒ½ç”¨ç¬¬äºŒä¸ªå‘½ä»¤æ€ã€‚lua-time-limit 5000 ############### é›†ç¾¤ç›¸å…³ ############### #é›†ç¾¤å¼€å…³ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯é›†ç¾¤æ¨¡å¼ã€‚# cluster-enabled yes #é›†ç¾¤é…ç½®æ–‡ä»¶çš„åç§°ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼ŒæŒä¹…åŒ–ä¿å­˜é›†ç¾¤çš„ä¿¡æ¯ã€‚è¿™ä¸ªæ–‡ä»¶å¹¶ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æœ‰Redisç”Ÿæˆå¹¶æ›´æ–°ï¼Œæ¯ä¸ªRedisé›†ç¾¤èŠ‚ç‚¹éœ€è¦ä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œè¯·ç¡®ä¿ä¸å®ä¾‹è¿è¡Œçš„ç³»ç»Ÿä¸­é…ç½®æ–‡ä»¶åç§°ä¸å†²çª# cluster-config-file nodes-6379.conf #èŠ‚ç‚¹äº’è¿è¶…æ—¶çš„é˜€å€¼ã€‚é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ¯«ç§’æ•°# cluster-node-timeout 15000 #åœ¨è¿›è¡Œæ•…éšœè½¬ç§»çš„æ—¶å€™ï¼Œå…¨éƒ¨slaveéƒ½ä¼šè¯·æ±‚ç”³è¯·ä¸ºmasterï¼Œä½†æ˜¯æœ‰äº›slaveå¯èƒ½ä¸masteræ–­å¼€è¿æ¥ä¸€æ®µæ—¶é—´äº†ï¼Œå¯¼è‡´æ•°æ®è¿‡äºé™ˆæ—§ï¼Œè¿™æ ·çš„slaveä¸åº”è¯¥è¢«æå‡ä¸ºmasterã€‚è¯¥å‚æ•°å°±æ˜¯ç”¨æ¥åˆ¤æ–­slaveèŠ‚ç‚¹ä¸masteræ–­çº¿çš„æ—¶é—´æ˜¯å¦è¿‡é•¿ã€‚åˆ¤æ–­æ–¹æ³•æ˜¯ï¼š#æ¯”è¾ƒslaveæ–­å¼€è¿æ¥çš„æ—¶é—´å’Œ(node-timeout * slave-validity-factor) + repl-ping-slave-period#å¦‚æœèŠ‚ç‚¹è¶…æ—¶æ—¶é—´ä¸ºä¸‰åç§’, å¹¶ä¸”slave-validity-factorä¸º10,å‡è®¾é»˜è®¤çš„repl-ping-slave-periodæ˜¯10ç§’ï¼Œå³å¦‚æœè¶…è¿‡310ç§’slaveå°†ä¸ä¼šå°è¯•è¿›è¡Œæ•…éšœè½¬ç§»# cluster-slave-validity-factor 10 #masterçš„slaveæ•°é‡å¤§äºè¯¥å€¼ï¼Œslaveæ‰èƒ½è¿ç§»åˆ°å…¶ä»–å­¤ç«‹masterä¸Šï¼Œå¦‚è¿™ä¸ªå‚æ•°è‹¥è¢«è®¾ä¸º2ï¼Œé‚£ä¹ˆåªæœ‰å½“ä¸€ä¸ªä¸»èŠ‚ç‚¹æ‹¥æœ‰2 ä¸ªå¯å·¥ä½œçš„ä»èŠ‚ç‚¹æ—¶ï¼Œå®ƒçš„ä¸€ä¸ªä»èŠ‚ç‚¹ä¼šå°è¯•è¿ç§»ã€‚# cluster-migration-barrier 1 #é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤å…¨éƒ¨çš„slotæœ‰èŠ‚ç‚¹è´Ÿè´£ï¼Œé›†ç¾¤çŠ¶æ€æ‰ä¸ºokï¼Œæ‰èƒ½æä¾›æœåŠ¡ã€‚è®¾ç½®ä¸ºnoï¼Œå¯ä»¥åœ¨slotæ²¡æœ‰å…¨éƒ¨åˆ†é…çš„æ—¶å€™æä¾›æœåŠ¡ã€‚ä¸å»ºè®®æ‰“å¼€è¯¥é…ç½®ï¼Œè¿™æ ·ä¼šé€ æˆåˆ†åŒºçš„æ—¶å€™ï¼Œå°åˆ†åŒºçš„masterä¸€ç›´åœ¨æ¥å—å†™è¯·æ±‚ï¼Œè€Œé€ æˆå¾ˆé•¿æ—¶é—´æ•°æ®ä¸ä¸€è‡´ã€‚# cluster-require-full-coverage yes ############### SLOW LOG æ…¢æŸ¥è¯¢æ—¥å¿— ############### ###slog logæ˜¯ç”¨æ¥è®°å½•redisè¿è¡Œä¸­æ‰§è¡Œæ¯”è¾ƒæ…¢çš„å‘½ä»¤è€—æ—¶ã€‚å½“å‘½ä»¤çš„æ‰§è¡Œè¶…è¿‡äº†æŒ‡å®šæ—¶é—´ï¼Œå°±è®°å½•åœ¨slow logä¸­ï¼Œslog logä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰IOæ“ä½œã€‚#æ‰§è¡Œæ—¶é—´æ¯”slowlog-log-slower-thanå¤§çš„è¯·æ±‚è®°å½•åˆ°slowlogé‡Œé¢ï¼Œå•ä½æ˜¯å¾®ç§’ï¼Œæ‰€ä»¥1000000å°±æ˜¯1ç§’ã€‚æ³¨æ„ï¼Œè´Ÿæ•°æ—¶é—´ä¼šç¦ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè€Œ0åˆ™ä¼šå¼ºåˆ¶è®°å½•æ‰€æœ‰å‘½ä»¤ã€‚slowlog-log-slower-than 10000 #æ…¢æŸ¥è¯¢æ—¥å¿—é•¿åº¦ã€‚å½“ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«å†™è¿›æ—¥å¿—çš„æ—¶å€™ï¼Œæœ€è€çš„é‚£ä¸ªè®°å½•ä¼šè¢«åˆ æ‰ã€‚è¿™ä¸ªé•¿åº¦æ²¡æœ‰é™åˆ¶ã€‚åªè¦æœ‰è¶³å¤Ÿçš„å†…å­˜å°±è¡Œã€‚ä½ å¯ä»¥é€šè¿‡ SLOWLOG RESET æ¥é‡Šæ”¾å†…å­˜ã€‚slowlog-max-len 128 ############### å»¶è¿Ÿç›‘æ§ ################å»¶è¿Ÿç›‘æ§åŠŸèƒ½æ˜¯ç”¨æ¥ç›‘æ§redisä¸­æ‰§è¡Œæ¯”è¾ƒç¼“æ…¢çš„ä¸€äº›æ“ä½œï¼Œç”¨LATENCYæ‰“å°rediså®ä¾‹åœ¨è·‘å‘½ä»¤æ—¶çš„è€—æ—¶å›¾è¡¨ã€‚åªè®°å½•å¤§äºç­‰äºä¸‹è¾¹è®¾ç½®çš„å€¼çš„æ“ä½œã€‚0çš„è¯ï¼Œå°±æ˜¯å…³é—­ç›‘è§†ã€‚é»˜è®¤å»¶è¿Ÿç›‘æ§åŠŸèƒ½æ˜¯å…³é—­çš„ï¼Œå¦‚æœä½ éœ€è¦æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡CONFIG SETå‘½ä»¤åŠ¨æ€è®¾ç½®ã€‚latency-monitor-threshold 0 ############### EVENT NOTIFICATION è®¢é˜…é€šçŸ¥ ################é”®ç©ºé—´é€šçŸ¥ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è®¢é˜…é¢‘é“æˆ–æ¨¡å¼ï¼Œæ¥æ¥æ”¶é‚£äº›ä»¥æŸç§æ–¹å¼æ”¹åŠ¨äº† Redis æ•°æ®é›†çš„äº‹ä»¶ã€‚å› ä¸ºå¼€å¯é”®ç©ºé—´é€šçŸ¥åŠŸèƒ½éœ€è¦æ¶ˆè€—ä¸€äº› CPU ï¼Œæ‰€ä»¥åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œè¯¥åŠŸèƒ½å¤„äºå…³é—­çŠ¶æ€ã€‚#notify-keyspace-events çš„å‚æ•°å¯ä»¥æ˜¯ä»¥ä¸‹å­—ç¬¦çš„ä»»æ„ç»„åˆï¼Œå®ƒæŒ‡å®šäº†æœåŠ¡å™¨è¯¥å‘é€å“ªäº›ç±»å‹çš„é€šçŸ¥ï¼š##K é”®ç©ºé—´é€šçŸ¥ï¼Œæ‰€æœ‰é€šçŸ¥ä»¥ __keyspace@__ ä¸ºå‰ç¼€##E é”®äº‹ä»¶é€šçŸ¥ï¼Œæ‰€æœ‰é€šçŸ¥ä»¥ __keyevent@__ ä¸ºå‰ç¼€##g DEL ã€ EXPIRE ã€ RENAME ç­‰ç±»å‹æ— å…³çš„é€šç”¨å‘½ä»¤çš„é€šçŸ¥##$ å­—ç¬¦ä¸²å‘½ä»¤çš„é€šçŸ¥##l åˆ—è¡¨å‘½ä»¤çš„é€šçŸ¥##s é›†åˆå‘½ä»¤çš„é€šçŸ¥##h å“ˆå¸Œå‘½ä»¤çš„é€šçŸ¥##z æœ‰åºé›†åˆå‘½ä»¤çš„é€šçŸ¥##x è¿‡æœŸäº‹ä»¶ï¼šæ¯å½“æœ‰è¿‡æœŸé”®è¢«åˆ é™¤æ—¶å‘é€##e é©±é€(evict)äº‹ä»¶ï¼šæ¯å½“æœ‰é”®å› ä¸º maxmemory æ”¿ç­–è€Œè¢«åˆ é™¤æ—¶å‘é€##A å‚æ•° g$lshzxe çš„åˆ«å#è¾“å…¥çš„å‚æ•°ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ª K æˆ–è€… Eï¼Œå¦åˆ™çš„è¯ï¼Œä¸ç®¡å…¶ä½™çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸ä¼šæœ‰ä»»ä½• é€šçŸ¥è¢«åˆ†å‘ã€‚è¯¦ç»†ä½¿ç”¨å¯ä»¥å‚è€ƒhttp://redis.io/topics/notifications notify-keyspace-events &quot;&quot; ############### ADVANCED CONFIG é«˜çº§é…ç½® ################æ•°æ®é‡å°äºç­‰äºhash-max-ziplist-entriesçš„ç”¨ziplistï¼Œå¤§äºhash-max-ziplist-entriesç”¨hashhash-max-ziplist-entries 512#valueå¤§å°å°äºç­‰äºhash-max-ziplist-valueçš„ç”¨ziplistï¼Œå¤§äºhash-max-ziplist-valueç”¨hashã€‚hash-max-ziplist-value 64 #æ•°æ®é‡å°äºç­‰äºlist-max-ziplist-entriesç”¨ziplistï¼Œå¤§äºlist-max-ziplist-entriesç”¨listã€‚list-max-ziplist-entries 512#valueå¤§å°å°äºç­‰äºlist-max-ziplist-valueçš„ç”¨ziplistï¼Œå¤§äºlist-max-ziplist-valueç”¨listã€‚list-max-ziplist-value 64 #æ•°æ®é‡å°äºç­‰äºset-max-intset-entriesç”¨inisetï¼Œå¤§äºset-max-intset-entriesç”¨setã€‚set-max-intset-entries 512 #æ•°æ®é‡å°äºç­‰äºzset-max-ziplist-entriesç”¨ziplistï¼Œå¤§äºzset-max-ziplist-entriesç”¨zsetã€‚zset-max-ziplist-entries 128#valueå¤§å°å°äºç­‰äºzset-max-ziplist-valueç”¨ziplistï¼Œå¤§äºzset-max-ziplist-valueç”¨zsetã€‚zset-max-ziplist-value 64 #valueå¤§å°å°äºç­‰äºhll-sparse-max-bytesä½¿ç”¨ç¨€ç–æ•°æ®ç»“æ„ï¼ˆsparseï¼‰ï¼Œå¤§äºhll-sparse-max-bytesä½¿ç”¨ç¨ å¯†çš„æ•°æ®ç»“æ„ï¼ˆdenseï¼‰ã€‚ä¸€ä¸ªæ¯”16000å¤§çš„valueæ˜¯å‡ ä¹æ²¡ç”¨çš„ï¼Œå»ºè®®çš„valueå¤§æ¦‚ä¸º3000ã€‚å¦‚æœå¯¹CPUè¦æ±‚ä¸é«˜ï¼Œå¯¹ç©ºé—´è¦æ±‚è¾ƒé«˜çš„ï¼Œå»ºè®®è®¾ç½®åˆ°10000å·¦å³ã€‚hll-sparse-max-bytes 3000 #Rediså°†åœ¨æ¯100æ¯«ç§’æ—¶ä½¿ç”¨1æ¯«ç§’çš„CPUæ—¶é—´æ¥å¯¹redisçš„hashè¡¨è¿›è¡Œé‡æ–°hashï¼Œå¯ä»¥é™ä½å†…å­˜çš„ä½¿ç”¨ã€‚å½“ä½ çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæœ‰éå¸¸ä¸¥æ ¼çš„å®æ—¶æ€§éœ€è¦ï¼Œä¸èƒ½å¤Ÿæ¥å—Redisæ—¶ä¸æ—¶çš„å¯¹è¯·æ±‚æœ‰2æ¯«ç§’çš„å»¶è¿Ÿçš„è¯ï¼ŒæŠŠè¿™é¡¹é…ç½®ä¸ºnoã€‚å¦‚æœæ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„å®æ—¶æ€§è¦æ±‚ï¼Œå¯ä»¥è®¾ç½®ä¸ºyesï¼Œä»¥ä¾¿èƒ½å¤Ÿå°½å¯èƒ½å¿«çš„é‡Šæ”¾å†…å­˜ã€‚activerehashing yes ##å¯¹å®¢æˆ·ç«¯è¾“å‡ºç¼“å†²è¿›è¡Œé™åˆ¶å¯ä»¥å¼ºè¿«é‚£äº›ä¸ä»æœåŠ¡å™¨è¯»å–æ•°æ®çš„å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œç”¨æ¥å¼ºåˆ¶å…³é—­ä¼ è¾“ç¼“æ…¢çš„å®¢æˆ·ç«¯ã€‚#å¯¹äºnormal clientï¼Œç¬¬ä¸€ä¸ª0è¡¨ç¤ºå–æ¶ˆhard limitï¼Œç¬¬äºŒä¸ª0å’Œç¬¬ä¸‰ä¸ª0è¡¨ç¤ºå–æ¶ˆsoft limitï¼Œnormal clienté»˜è®¤å–æ¶ˆé™åˆ¶ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰å¯»é—®ï¼Œä»–ä»¬æ˜¯ä¸ä¼šæ¥æ”¶æ•°æ®çš„ã€‚client-output-buffer-limit normal 0 0 0#å¯¹äºslave clientå’ŒMONITER clientï¼Œå¦‚æœclient-output-bufferä¸€æ—¦è¶…è¿‡256mbï¼Œåˆæˆ–è€…è¶…è¿‡64mbæŒç»­60ç§’ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿æ¥ã€‚client-output-buffer-limit slave 256mb 64mb 60#å¯¹äºpubsub clientï¼Œå¦‚æœclient-output-bufferä¸€æ—¦è¶…è¿‡32mbï¼Œåˆæˆ–è€…è¶…è¿‡8mbæŒç»­60ç§’ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿æ¥ã€‚client-output-buffer-limit pubsub 32mb 8mb 60 #redisæ‰§è¡Œä»»åŠ¡çš„é¢‘ç‡ä¸º1sé™¤ä»¥hzã€‚hz 10 #åœ¨aofé‡å†™çš„æ—¶å€™ï¼Œå¦‚æœæ‰“å¼€äº†aof-rewrite-incremental-fsyncå¼€å…³ï¼Œç³»ç»Ÿä¼šæ¯32MBæ‰§è¡Œä¸€æ¬¡fsyncã€‚è¿™å¯¹äºæŠŠæ–‡ä»¶å†™å…¥ç£ç›˜æ˜¯æœ‰å¸®åŠ©çš„ï¼Œå¯ä»¥é¿å…è¿‡å¤§çš„å»¶è¿Ÿå³°å€¼ã€‚aof-rewrite-incremental-fsync yes","link":"/2019/06/16/RedisSpringJunior/"},{"title":"Spring Cloud Bus","text":"ä¸»è¦ä»‹ç»Spring Cloud Bus githubä¸Šé…ç½®æ–‡ä»¶ Spring Cloud Bus æ¦‚è¿°Spring Cloud Bus ä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†ï¼ˆRabbitMQ,Kafkaâ€¦â€¦ï¼‰è¿æ¥åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ï¼ˆclientsï¼‰ï¼Œè¿™æ ·å¯ä»¥å¹¿æ’­ä¼ æ’­çŠ¶æ€çš„æ›´æ”¹ï¼ˆæ›´æ–°é…ç½®æ–‡ä»¶æ“ä½œï¼‰æˆ–å…¶ä»–ç®¡ç†æŒ‡ä»¤ã€‚è¾¾åˆ°ä¸‹å›¾æ•ˆæœã€‚ä¾‹å¦‚ä¸Šå›¾ï¼Œæ‰€æœ‰clientéƒ½ä¸æ¶ˆæ¯æ€»çº¿æƒ³è¿ï¼Œå½“configserverçš„/bus/refreshæ¥æ”¶åˆ°è¯·æ±‚ï¼Œä¼šåƒæ¶ˆæ¯æ€»çº¿å‘é€ä¸€ä¸ªé…ç½®æ›´æ–°çš„äº‹ä»¶ï¼Œé€šè¿‡æ¶ˆæ¯æ€»çº¿å¹¿æ’­ï¼Œæ‰€æœ‰çš„clientä¼šå»configServeræ‹‰æœ€æ–°çš„é…ç½®ã€‚ Clientå¦‚ä½•æ›´æ–°é…ç½®â€“&gt;refreshå®¢æˆ·ç«¯å¦‚ä½•å»ä¸»åŠ¨è·å–æ–°çš„é…ç½®ä¿¡æ¯å‘¢ï¼Œspringcloudå·²ç»ç»™æˆ‘ä»¬æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œæ¯ä¸ªå®¢æˆ·ç«¯é€šè¿‡POSTæ–¹æ³•è§¦å‘å„è‡ªçš„/refresh Clientæ·»åŠ ä¾èµ–1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; spring-boot-starter-actuatoræ˜¯ä¸€å¥—ç›‘æ§çš„åŠŸèƒ½ï¼Œå¯ä»¥ç›‘æ§ç¨‹åºåœ¨è¿è¡Œæ—¶çŠ¶æ€ï¼Œå…¶ä¸­å°±åŒ…æ‹¬/refreshçš„åŠŸèƒ½ã€‚ å¼€å¯æ›´æ–°æœºåˆ¶éœ€è¦ç»™åŠ è½½å˜é‡çš„ç±»ä¸Šé¢åŠ è½½@RefreshScopeï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ/refreshçš„æ—¶å€™å°±ä¼šæ›´æ–°æ­¤ç±»ä¸‹é¢çš„å˜é‡å€¼ã€‚ æ‰€æœ‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦çš„ä¾èµ–1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt; &lt;/dependency&gt; ConfigServeré…ç½®æ–‡ä»¶åœ¨configServeré…ç½®æ–‡ä»¶å¢åŠ ï¼š1234567891011121314151617181920212223spring: application: name: Config-Server cloud: config: server: git: uri: https://github.com/****/first-config-repo search-paths: /first username: *** password: *** prefix: /config # è®¿é—®ymlæ—¶å€™http://hostname:port/config/test/devå³å¯ rabbitmq: host: 0.0.0.0 # RabbitMQæœåŠ¡åœ°å€ port: 5672 username: *** password: *** management: endpoints: web: exposure: include: bus-refresh # æš´éœ²/bus/refreshç«¯ç‚¹ å¯ä»¥æŠŠæ‰€æœ‰ç«¯ç‚¹éƒ½æš´éœ²ï¼Œç”¨*å°±å¯ä»¥ï¼Œä½†ymlä¸­çš„*éœ€è¦ç”¨åŒå¼•å·æ‹¬èµ·â€“&gt;&quot;*&quot;,SpringBoot 2.0.xæš´éœ²ç«¯ç‚¹æ–¹å¼ï¼š1234# å¯ç”¨ç«¯ç‚¹ envmanagement.endpoint.env.enabled=true# æš´éœ²ç«¯ç‚¹ env é…ç½®å¤šä¸ª,éš”å¼€management.endpoints.web.exposure.include=env å·²ç»å¼ƒç”¨ï¼šmanagement.security.enabled=false clienté…ç½®æ–‡ä»¶åœ¨bootstrap.ymlä¸­å¢åŠ ï¼š1234567891011121314151617spring: cloud: config: name: test # application profile: dev # profile label: master # gitåˆ†æ”¯ discovery: service-id: EUR-SERVER2 # æŒ‡å®šserverç«¯çš„name,ä¹Ÿå°±æ˜¯serverç«¯spring.application.nameçš„å€¼ enabled: true # å¼€å¯ConfigæœåŠ¡å‘ç°æ”¯æŒ bus: trace: enabled: true # å¼€å¯æ¶ˆæ¯è·Ÿè¸ª rabbitmq: host: 0.0.0.0 port: 5672 username: *** password: *** å…¶ä¸­spring.cloud.config.discovery.*ä¸‹çš„é…ç½®æ˜¯ä¸ºäº†å®ç°é…ç½®ä¸­å¿ƒé«˜å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šconfigServerçš„åœ°å€(æ­¤æ–¹å¼ä¸æ˜¯é«˜å¯ç”¨)ï¼šspring.cloud.config.uri: http://peer2:8882 WebHookå¯ä»¥åœ¨githubä¸Šè®¾ç½®ï¼Œç äº‘ä¹Ÿå¯ä»¥ï¼Œpushåå¯ä»¥å‘é€ä¸€ä¸ªPostè¯·æ±‚ã€‚æœ¬åœ°éªŒè¯å¯ä»¥ç”¨HTTPå·¥å…·è‡ªå·±å‘http://peer1:8881/actuator/bus-refreshï¼ˆå…¶ä¸­actuatoråˆ«å¿˜äº†ï¼Œç»å¸¸å¿˜å†™ï¼‰ éªŒè¯å½“æ›´æ–°githubä¸Šçš„æ–‡ä»¶åï¼Œæ‰‹åŠ¨å‘é€ä¸€ä¸ªpostè¯·æ±‚http://peer1:8881/actuator/bus-refreshï¼Œè¿™æ—¶å€™å†éªŒè¯clientä¸­å¯¹åº”çš„å±æ€§å€¼å°±ä¼šå‘ç°å·²ç»æ›´æ”¹äº†ã€‚","link":"/2019/03/01/SpringCloudBus/"},{"title":"Spring Cloud Eureka","text":"ä¸»è¦ä»‹ç»Spring Cloud Eureka æœåŠ¡å‘ç°ç»„ä»¶æ¦‚è¿° å„ä¸ªæœåŠ¡å¯åŠ¨æ—¶å€™ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡å‘ç°ç»„ä»¶ï¼ˆEureka Serverï¼‰ä¼šè®°å½•è¿™äº›ä¿¡æ¯ã€‚ æœåŠ¡æ¶ˆè´¹ä¹‹å¯ä»¥åˆ°æœåŠ¡å‘ç°ç»„ä»¶ï¼ˆEureka Serverï¼‰çš„æ³¨å†Œè¡¨æŸ¥è¯¢æœåŠ¡æä¾›è€…çš„ä¿¡æ¯ï¼ˆåœ°å€ç­‰â€¦â€¦ï¼‰ï¼Œå¹¶ä½¿ç”¨è¯¥ä¿¡æ¯è°ƒç”¨æä¾›è€…çš„æ¥å£ å„ä¸ªå¾®æœåŠ¡ä½¿ç”¨å¿ƒè·³æœºåˆ¶ä¸æœåŠ¡å‘ç°ç»„ä»¶ï¼ˆEureka Serverï¼‰è¿›è¡Œé€šä¿¡ï¼ŒæœåŠ¡å‘ç°ç»„ä»¶é•¿æ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ°å¿ƒè·³ï¼Œä¼šæ³¨é”€è¯¥æœåŠ¡å®ä¾‹ã€‚ å¾®æœåŠ¡æ›´æ”¹ä¿¡æ¯ï¼ˆIPåœ°å€ç­‰ï¼‰ä¼šé‡æ–°è¿›è¡Œæ³¨å†Œï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¯ç›´æ¥è·å–æœ€æ–°ä¿¡æ¯ã€‚ Spring CloudæœåŠ¡å‘ç°ç»„ä»¶æœ‰ï¼šEurekaï¼ŒZookeeperï¼ŒConsulâ€¦â€¦ Eurekaæ¦‚è¿° Netflixå¼€å‘çš„æœåŠ¡å‘ç°ç»„ä»¶ï¼ŒåŸºäºRESTçš„æœåŠ¡ã€‚åŒ…å«ï¼šServerã€Clientã€‚ Spring Cloudå°†å…¶é›†æˆäºSpring Cloud Netflixä¸­ã€‚ Eureka 2.0ä»¥ä¸Šå·²ç»é—­æºã€‚ EurekaåŸç†æ¦‚è¿° Eureka Serveræä¾›æœåŠ¡å‘ç°èƒ½åŠ›ã€‚ Eureka Clientæ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œä¼šå‘¨æœŸæ€§ï¼ˆé»˜è®¤30sï¼‰å‘Eureka Server å‘é€å¿ƒè·³ã€‚ Eureka Serverä¸€å®šæ—¶é—´ï¼ˆé»˜è®¤90sï¼‰å†…æ²¡æœ‰æ¥æ”¶åˆ°å¿ƒè·³ä¼šæ³¨é”€æ‰è¯¥å®ä¾‹ã€‚ é»˜è®¤æƒ…å†µä¸‹Eureka Serverä¹Ÿæ˜¯ä¸€ä¸ªEureka Clientï¼ˆç”¨äºé«˜å¯ç”¨ï¼‰ï¼Œå¤šä¸ªEureka Serveräº’ç›¸æ³¨å†Œï¼Œä¼šé€šè¿‡å¤åˆ¶çš„æ–¹å¼æ¥åŒæ­¥æ³¨å†Œè¡¨ã€‚ Eureka Clientä¹Ÿä¼šç¼“å­˜æ³¨å†Œè¡¨ä¿¡æ¯ï¼ˆé¿å…Eureka ServeræŒ‚æ‰ï¼Œæ— æ³•è°ƒç”¨æœåŠ¡æä¾›è€…ï¼‰ åˆ›å»ºEureka Serverpom.xml12345&lt;!-- EurekaServer --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;&lt;/dependency&gt; å¯åŠ¨ç±»å¢åŠ @EnableEurekaServeræ³¨è§£ é…ç½®æ–‡ä»¶application.yml123456789101112131415server: port: 8002spring: application: name: Eureka-Servereureka: client: registerWithEureka: true #æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ fetchRegistry: true #é«˜å¯ç”¨è®¾ç½®ï¼Œä½œç”¨ï¼šä»å…¶ä»–EurekaServerä¸Šå¤åˆ¶æ³¨å†Œè¡¨ service-url: defaultZone: http://admin:admin1@peer1:8001/eureka/ #å¯ä»¥é…ç½®å¤šä¸ªåœ°å€ï¼Œç”¨é€—å·åˆ†éš” instance: hostname: peer2 é«˜å¯ç”¨Eureka Serverå› ä¸ºEureka Serveræœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªEureka Clientï¼Œäº’ç›¸æ³¨å†Œï¼Œé…ç½®æ–‡ä»¶è®¾ç½®eureka.client.regsiterWithEureka=true,eureka.client.fetchRegistry=trueå³å¯ã€‚ æ·»åŠ ç”¨æˆ·è®¤è¯å¼•å…¥ä¾èµ–12345&lt;!-- ç™»é™†éªŒè¯ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½®æ–‡ä»¶ Spring Cloud 2.xä»¥å 12345spring: security: user: name: admin password: 123456 Srong CLoud 1.x 123456security: base: enable: true user: name: admin password: 123456 å…³é—­crsféªŒè¯è®¾ç½®å®‰å…¨éªŒè¯åï¼Œç”±äºSpring Cloud 2.xæ˜¯é»˜è®¤å¼€å¯crsféªŒè¯çš„ï¼Œæ‰€ä»¥ä¸€ç‚¹è¦å…³é—­crsfï¼Œå¦åˆ™clientæ˜¯æ— æ³•æ³¨å†Œåˆ°eureka serverçš„ã€‚1234567891011121314151617@Configuration@EnableWebSecuritypublic class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { //è¦†ç›–çˆ¶ç±»çš„ configure(HttpSecurity http) æ–¹æ³•ï¼Œå…³é—­æ‰ csrf //å¦‚æœä¸å…³é—­ï¼ŒæœåŠ¡å°†æ— æ³•æ³¨å†Œåˆ°æ­¤æ³¨å†Œä¸­å¿ƒ //http.csrf().disable();é»˜è®¤æ˜¯formLogin()ï¼Œç™»é™†æ—¶å€™ä¸å¼¹çª— http.csrf() .disable() .authorizeRequests() .anyRequest().authenticated() .and() .httpBasic();//httpBasicç™»é™†æ¨¡å¼ï¼ˆå¼¹å‡ºæ¡†ï¼‰ super.configure(http); }} ç”¨æˆ·è®¤è¯ä¸‹Eureka Clientçš„é…ç½®æ›´æ”¹defaultZoneï¼šerueka.client.service-url.defaultZone: http://{name}:{password}@{host}:{port}/eureka å…¶ä»– eureka.instance.prefer-ip-address=trueè¡¨ç¤ºå°†è‡ªå·±çš„IPæ³¨å†Œåˆ°Eureka Serverï¼Œfalseä¼šå°†å¾®æœåŠ¡æ‰€åœ¨çš„æ“ä½œç³»ç»ŸHOSTNAMEæ³¨å†Œåˆ°Eureka Server eureka.instance.metadate-map.my-metadata=***ï¼ˆkeyï¼Œvalueéšä¾¿å†™ï¼‰,å¯ä»¥è‡ªå®šä¹‰Eureka Serverå…ƒæ•°æ®ï¼Œä¾‹å¦‚â€œmy-metadata=***â€ã€‚ è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå½“Eureka ServeèŠ‚ç‚¹çŸ­æ—¶é—´ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶å€™ï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œï¼Œæ­¤æ—¶ï¼ŒEureka Serverä¼šä¿æŠ¤æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤ï¼Œæ•…éšœæ¢å¤åèŠ‚ç‚¹ä¼šè‡ªåŠ¨é€€å‡ºè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚ å¤šç½‘å¡ç¯å¢ƒä¸‹IPé€‰æ‹©ï¼š 12345678910111213spring: client: inetutils: #å¿½ç•¥docker0ç½‘å¡å’Œæ‰€æœ‰vethå¼€å¤´çš„ç½‘å¡ ignored-interfaces: - docker0 - veth.* #å…è®¸çš„ç½‘ç»œåœ°å€ preferredNetworks: - 192.168 - 10.0 #åªå…è®¸ä½¿ç”¨ç«™ç‚¹æœ¬åœ°çš„åœ°å€ useOnlySiteLocalInterfaces: true å¥åº·æ£€æŸ¥çŠ¶æ€æœ‰ï¼šUPï¼ŒDOWNï¼ŒOUT_OF_SERVICEï¼ŒUNKNOWNæ˜¾ç¤ºé”™è¯¯ï¼Œçœ‹çœ‹å¥åº·æ£€æŸ¥æ˜¯å¦å¼€å¯eureka.client.healthcheck.enabled=true åˆ›å»ºEureka Clientpom.xml12345&lt;!-- Eureka client --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;&lt;/dependency&gt; å¯åŠ¨ç±»å¢åŠ @EnableDiscoveryClientæ³¨è§£ é…ç½®æ–‡ä»¶1234567891011server: port: 9001spring: application: name: Producer eureka: client: serviceUrl: defaultZone: http://admin:123456@peer1:8001/eureka/ å¯åŠ¨Eureka Clientå¯ä»¥çœ‹åˆ°å·²ç»æ³¨å†ŒæˆåŠŸã€‚","link":"/2019/02/05/SpringCloudEureka/"},{"title":"Springæ•´åˆRedisè¿›é˜¶","text":"äº†è§£è¿‡Springæ•´åˆRedisåï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ä½¿ç”¨Redisè¿›è¡Œç¼“å­˜æ“ä½œäº†ã€‚ä½†åœ¨æŸäº›ä¸šåŠ¡ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å‘RedisåŠ è½½ä¸€äº›æ—¢æœ‰æ•°æ®ï¼Œä¾‹å¦‚ï¼šå­¦å‘˜ç­”é¢˜ç«èµ›çš„åˆ†æ•°æ’è¡Œï¼Œé¦–é¡µçš„ä¸€äº›ç¼“å­˜ã€‚è¿™äº›æ•°æ®æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®åˆå§‹åŒ–é˜¶æ®µåŠ è½½å®Œæ¯•ã€‚åœ¨é¡¹ç›®è¿è¡Œé˜¶æ®µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨SpringCacheè¿›è¡Œæ¥å£çš„æ•°æ®ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥æ”¹å–„å› ä¸ºå¹¶å‘å¯¼è‡´çš„ç¼“æ…¢ï¼ˆæ•°æ®åº“IOï¼‰ï¼Œå¯ä»¥æˆå€çš„æå‡QPSã€‚åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é¡¹ç›®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨Redisè¿›è¡Œé›†ç¾¤ç¯å¢ƒçš„sessionå…±äº«ã€‚ æœ¬æ–‡ä¾æ¬¡ä»‹ç»äº†ï¼Œé¡¹ç›®åˆå§‹åŒ–é˜¶æ®µåŠ è½½Redisæ•°æ®çš„æ–¹å¼ï¼ŒSpringCacheä¸Redisçš„æ•´åˆï¼Œä»¥åŠSpringSessionä¸Redisçš„æ•´åˆã€‚ SpringBooté¡¹ç›®åˆå§‹åŒ–åŠ è½½Redisæ•°æ®(æ¨è)ç¬¬ä¸€ç§æ–¹å¼ï¼šå®ç°InitializingBeanæ¥å£å¤å†™afterPropertiesSetæ–¹æ³•ï¼š123456789@Overridepublic void afterPropertiesSet() throws Exception { List&lt;Student&gt; list = this.findStudents(); if(StringUtils.isNotNull(list)){ list.stream() .filter(s -&gt; StringUtils.isNotNull(s.getTestDatetime())) .forEach(s -&gt; redisService.hmSet(\"stus\",\"stu[\"+s.getStudentId()+\"]\", s)); }} ç¬¬äºŒç§æ–¹å¼ï¼šå®ç°ApplicationRunneræ¥å£å¤å†™runæ–¹æ³•ï¼š123456789@Overridepublic void run(ApplicationArguments args) throws Exception { List&lt;Student&gt; list = this.findStudents(); if(StringUtils.isNotNull(list)){ list.stream() .filter(s -&gt; StringUtils.isNotNull(s.getTestDatetime())) .forEach(s -&gt; redisService.hmSet(\"stus\",\"stu[\"+s.getStudentId()+\"]\", s)); }} ä¸¤ç§æ–¹æ³•åŒºåˆ« å®ç°InitializingBeanæ¥å£æ–¹å¼ï¼ŒInitializingBeanæ¥å£ä¸ºbeanæä¾›äº†åˆå§‹åŒ–æ–¹æ³•çš„æ–¹å¼ï¼Œå®ƒåªåŒ…æ‹¬afterPropertiesSet()æ–¹æ³•ã€‚åœ¨springåˆå§‹åŒ–beançš„æ—¶å€™ï¼Œå¦‚æœbeanå®ç°äº†InitializingBeanæ¥å£ï¼Œ â€‹ åœ¨å¯¹è±¡çš„æ‰€æœ‰å±æ€§è¢«åˆå§‹åŒ–åä¹‹åæ‰ä¼šè°ƒç”¨afterPropertiesSet()æ–¹æ³•ã€‚è€Œä¸”è¿™æ—¶å€™ç”¨æˆ·æ˜¯è¿›ä¸æ¥çš„ï¼Œåªæœ‰åˆå§‹åŒ–ç»“æŸåæ‰ä¼šæ”¾å…¥è¯·æ±‚ã€‚æ¨èè¿™ç§æ–¹å¼ã€‚ å®ç°ApplicationRunneræ¥å£æ–¹å¼ï¼Œå¤å†™runæ–¹æ³•ä»…åœ¨SpringApplication.run(â€¦)å®Œæˆä¹‹åè°ƒç”¨ã€‚è¿™æ—¶å€™æœåŠ¡å·²ç»å¯¹å¤–å¼€æ”¾ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®ï¼Œå½“redisé¢„çƒ­æ—¶é—´å¾ˆé•¿çš„æ—¶å€™ä¼šé€ æˆç”¨æˆ·è·å–æ•°æ®å‡ºé”™çš„æƒ…å†µï¼Œæ‰€ä»¥ä¸æ¨èã€‚ SpringCacheä¸RedisSpringCacheé›†æˆredisçš„è¿è¡ŒåŸç†Springç¼“å­˜æŠ½è±¡æ¨¡å—é€šè¿‡CacheManageræ¥åˆ›å»ºã€ç®¡ç†å®é™…ç¼“å­˜ç»„ä»¶ï¼Œå½“SpringBootåº”ç”¨ç¨‹åºå¼•å…¥spring-boot-starter-data-redisä¾èµ–åå—ï¼Œå®¹å™¨ä¸­å°†æ³¨å†Œçš„æ˜¯CacheManagerå®ä¾‹RedisCacheManagerå¯¹è±¡ï¼ŒRedisCacheManageræ¥è´Ÿè´£åˆ›å»ºRedisCacheä½œä¸ºç¼“å­˜ç®¡ç†ç»„ä»¶ï¼Œç”±RedisCacheæ“ä½œredisæœåŠ¡å™¨å®ç°ç¼“å­˜æ•°æ®æ“ä½œã€‚å®é™…æµ‹è¯•å‘ç°é»˜è®¤æ³¨å…¥çš„RedisCacheManageræ“ä½œç¼“å­˜ç”¨çš„æ˜¯RedisTemplate&lt;Object, Object&gt;ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰cacheManagerï¼Œæ›¿æ¢æ‰é»˜è®¤çš„åºåˆ—åŒ–å™¨ã€‚ pom.xml1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;&lt;/dependency&gt; RedisConfigè‡ªå®šä¹‰cacheManagerï¼Œé…ç½®åºåˆ—åŒ–æ–¹å¼123456789101112131415161718192021222324252627@Beanpublic CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory, RedisTemplate redisTemplate) { return new RedisCacheManager( RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory), // é»˜è®¤ç­–ç•¥ï¼Œæœªé…ç½®çš„ key ä¼šä½¿ç”¨è¿™ä¸ª this.getRedisCacheConfigurationWithTtl(600), // æŒ‡å®š key ç­–ç•¥ this.getRedisCacheConfigurationMap() );}private Map&lt;String, RedisCacheConfiguration&gt; getRedisCacheConfigurationMap() { Map&lt;String, RedisCacheConfiguration&gt; redisCacheConfigurationMap = new HashMap&lt;&gt;(); //å•ç‹¬è®¾ç½®æŸäº›ç¼“å­˜keyçš„ttlæ—¶é—´ redisCacheConfigurationMap.put(\"UserInfoList\", this.getRedisCacheConfigurationWithTtl(122200)); return redisCacheConfigurationMap;}private RedisCacheConfiguration getRedisCacheConfigurationWithTtl(Integer seconds) { RedisSerializer&lt;Object&gt; serializer = getRedisSerializer(); RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig(); redisCacheConfiguration = redisCacheConfiguration .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer())) .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(serializer)) .entryTtl(Duration.ofSeconds(seconds)); return redisCacheConfiguration;} è‡ªå®šä¹‰keyç”Ÿæˆè§„åˆ™1234567891011121314151617181920/** * Cacheç¼“å­˜keyç”Ÿæˆè§„åˆ™ * @return */@Beanpublic KeyGenerator simpleKeyGenerator() { return (o, method, objects) -&gt; { StringBuilder stringBuilder = new StringBuilder(); stringBuilder.append(o.getClass().getSimpleName()); stringBuilder.append(\".\"); stringBuilder.append(method.getName()); stringBuilder.append(\"[\"); for (Object obj : objects) { stringBuilder.append(obj.toString()); } stringBuilder.append(\"]\"); return stringBuilder.toString(); };} å¼€å¯ç¼“å­˜ åœ¨configç±»æ·»åŠ @EnableCachingæ³¨è§£ã€‚ åœ¨éœ€è¦ç¼“å­˜çš„serviceImplå®ç°æ–¹æ³•æ·»åŠ æ³¨è§£ã€‚ 12345@Override@Cacheable(value = \"studentObject\",keyGenerator = \"simpleKeyGenerator\")public Student findStudentById(String id) { return getById(id);} æ•ˆæœç¬¬ä¸€æ¬¡ä»mysqlä¸­å–æ•°æ®ï¼Œç¬¬äºŒæ¬¡ä»¥ååœ¨keyç”Ÿæ•ˆå†…éƒ½ä¼šä»redisä¸­å–æ•°æ®ï¼Œå¤§å¤§å‡å°‘äº†æ•°æ®åº“çš„IOè´Ÿæ‹…ã€‚ å…³äºç¼“å­˜é¡¹ç›®ä¸­å…³äºæ•°æ®åº“çš„ç¼“å­˜æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä¾‹å¦‚MybatisPlusçš„ç¼“å­˜ï¼ŒEhCacheï¼Œå’ŒSpringCacheã€‚SpringCache+Rediså¯ä»¥ç›´æ¥ç¼“å­˜ä¸€ä¸ªServiceçš„æ•°æ®å‰¯æœ¬ï¼ŒæŸäº›ä¸šåŠ¡åœºæ™¯æ›´æœ‰æ•ˆç‡å†™ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å°†Redisåšä¸ºMysqlçš„äºŒçº§ç¼“å­˜ä½¿ç”¨ã€‚ Rediså®ç°åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒsessionå…±äº«pom.xml1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.session&lt;/groupId&gt; &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;&lt;/dependency&gt; æ·»åŠ æ³¨è§£åœ¨configBeanä¸­æ·»åŠ @EnableRedisHttpSession(maxInactiveIntervalInSeconds = 50)æ³¨è§£ï¼Œè¯¥æ³¨è§£è¿˜å¯ä»¥é…ç½®å…¶ä»–å‚æ•°ï¼š maxInactiveIntervalInSeconds:è¿‡æœŸæ—¶é—´ redisNamespace:å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸ºspring:session redisFlushMode:ç¼“å­˜æ–¹å¼ï¼Œé»˜è®¤ä¸ºON_SAVE cleanupCron:sessionç¼“å­˜å®šæœŸæ¸…é™¤ä»»åŠ¡ï¼Œé»˜è®¤static final String DEFAULT_CLEANUP_CRON = &quot;0 * * * * *&quot;; è‡ªå®šä¹‰SpringSessionåºåˆ—åŒ–æ–¹å¼123456789101112131415161718192021222324 /** * Redis Session åºåˆ—åŒ–æ–¹å¼ * @return */@Bean(\"springSessionDefaultRedisSerializer\")public RedisSerializer&lt;Object&gt; defaultRedisSerializer() { return getRedisSerializer();}/** * Redisåºåˆ—åŒ–æ–¹å¼ * @return */private RedisSerializer&lt;Object&gt; getRedisSerializer(){ Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class); ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); //è§£å†³LocalDateTimeçš„åºåˆ—åŒ–é”™è¯¯ om.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS); om.registerModule(new JavaTimeModule()); jackson2JsonRedisSerializer.setObjectMapper(om); return jackson2JsonRedisSerializer;} æµ‹è¯•æ¥å£1234567891011121314151617181920@RestController()@RequestMapping(\"/session\")public class SessionController { @RequestMapping(value = \"/setSession\", method = RequestMethod.GET) public Map&lt;String, Object&gt; setSession (HttpServletRequest request){ Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(); request.getSession().setAttribute(\"request Url\", request.getRequestURL()); map.put(\"request Url\", request.getRequestURL()); return map; } @RequestMapping(value = \"/getSession\", method = RequestMethod.GET) public Object getSession (HttpServletRequest request){ Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(); map.put(\"sessionIdUrl\",request.getSession().getAttribute(\"request Url\")); map.put(\"sessionId\", request.getSession().getId()); return map; }} ç»“æœ SetSession Redis GetSession","link":"/2019/06/17/RedisSpringMiddle/"}],"tags":[{"name":"Java","slug":"Java","link":"/tags/Java/"},{"name":"Spring Boot","slug":"Spring-Boot","link":"/tags/Spring-Boot/"},{"name":"Docker","slug":"Docker","link":"/tags/Docker/"},{"name":"å¤‡å¿˜","slug":"å¤‡å¿˜","link":"/tags/å¤‡å¿˜/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"Mac","slug":"Mac","link":"/tags/Mac/"},{"name":"IDEA","slug":"IDEA","link":"/tags/IDEA/"},{"name":"Spring Cloud","slug":"Spring-Cloud","link":"/tags/Spring-Cloud/"},{"name":"Redis","slug":"Redis","link":"/tags/Redis/"}],"categories":[{"name":"Spring Boot","slug":"Spring-Boot","link":"/categories/Spring-Boot/"},{"name":"Docker","slug":"Docker","link":"/categories/Docker/"},{"name":"Hexo","slug":"Hexo","link":"/categories/Hexo/"},{"name":"MacOSç›¸å…³","slug":"MacOSç›¸å…³","link":"/categories/MacOSç›¸å…³/"},{"name":"Java","slug":"Java","link":"/categories/Java/"},{"name":"Redis","slug":"Redis","link":"/categories/Redis/"},{"name":"Spring Cloud","slug":"Spring-Cloud","link":"/categories/Spring-Cloud/"},{"name":"Spring è¯»ä¹¦ç¬”è®°","slug":"Java/Spring-è¯»ä¹¦ç¬”è®°","link":"/categories/Java/Spring-è¯»ä¹¦ç¬”è®°/"}]}